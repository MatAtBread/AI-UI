## Dynamic Content

In the previous example, we created a new tag type called "App":

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tag contains some other tags: */
      return [
        h2("Hello World"),
        div("Dunno")
      ]
    }
  });
```

A design goal of AI-UI is to make declarative HTML dynamic, without creating a spaghetti network of events, dependencies or deep references into the DOM, and do it using standard Javascript constructs.

To achieve this, when specifying children, you can specify JavaScript [async iterables](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator) that generate values that could be children (Nodes, Elements and primitives).

The easiest way to do this is with an async generator. Let's add a function that updates the time every second:

```javascript
/* A simple async "sleep" function */
function sleep(seconds) {
  return new Promise(resolve => setTimeout(resolve, seconds * 1000))
}

/* The async generator that yields the time once a second */
async function *clock() {
  while (true) {
    yield new Date().toString();
    await sleep(1);
  }
}
```

...and replace "Dunno" with the time:

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tag contains some other tags: */
      return [
        h2("Hello World"),
        div(clock())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content.html)


When the async generator yields, it will update the content in place in the DOM. In this case, that means telling us the time every second.

Async Iterables (and therefore async generators) are brilliantly flexible. Your data could have come from a ReadableStream, a WebSocket, or with a little work events generated by other elements (AI-UI does this work for you - see [Link elements dynamically](./when.md)).

Any content in your DOM can now be declared statically in your "markup", and generated dynamically.

Let's try a slightly more complicated example:

```javascript
async function *clock() {
  while (true) {
    const now = new Date();
    // Yield a DOM fragment, consisting of two spans and some text:
    yield [
      span({ style: { color: 'black' }},now.toTimeString()), 
      " on ", 
      span({ style: { color: 'magenta' }},now.toDateString())
    ];
    await sleep(1);
  }
}

const App = div.extended({
    constructed() {
      /* When constructed, this "div" tag contains some other tags: */
      return [
        h2("Hello World"),
        div("This time is now: ",clock())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content-2.html)

In this example the generator yields a set of DOM elements that are _all_ replaced every second.

In additon to async generators, you can pass Promises (basically a generator that only goes off once, or you can look at an async iterable as a Promise that can resolve multiple times). Quite a few Web APIs return Promises, notably [fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

Let's update the App to display a new Chuck Morris joke every few seconds. First, we'll get just one from the web

```javascript
  /* A function that uses `fetch` to get a Chuck Noris joke. You could write this without async/await easily */
  async function chuckJoke() {
    const response = await fetch('https://api.chucknorris.io/jokes/random');
    const fromJson = await response.json();
    return fromJson.value;
  }

```
...and update our dynamic div's content:

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tag contains some other tags: */
      return [
        h2("Hello World"),
        div(chuckJoke())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content-3.html)

AI-UI will create the DOM synchronously, and when the Promise resolves, update it in situ with a "joke" about Chuck Norris.

A child node, either passed to a tag creating function (like `div` or `App` above) or returned by a `constructed()` member of an `extended(...)` tag, can be:

* a DOM Node
* a collection of DOM Nodes, like an array, a NodeList or HTMLCollection
* a primitve with a `toString()` method (numbers, strings, booleans, etc) 
* a Promise or async iterable that resolves or yields any of the above

You can, if you wish, also [augment the standard DOM API](./augment-dom-api.md) so that most standard DOM APIs that accept DOM Nodes (such as [Element.append](https://developer.mozilla.org/en-US/docs/Web/API/Element/append)) can also accept any of the above in addition to just DOM Nodes.

In order to tell a series of jokes, we can just wrap the Promise in an async generator:

```javascript
  async function *chuckJoke() {
    while (true) {
      /* In this example, we use Promises, rather than await, just to illustrate the alternative
      JavaScript syntax */
      yield fetch('https://api.chucknorris.io/jokes/random')
        .then(response => response.json())
        .then(fromJson => fromJson.value);
      await sleep(5);
    }
  }

```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content-4.html)


____

| < Prev | ^ |  Next > |
|:-------|:-:|--------:|
| [Your first web page](./your-first-web-page.md) | [Index](./index.md) | [Dynamic attributes](./dynamic-attributes.md) |

