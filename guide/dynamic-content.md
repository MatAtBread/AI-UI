## Dynamic Content

In the previous example, we created a new tag type called "App":

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tags contains some other tags: */
      return [
        h2("Hello World"),
        div("Dunno")
      ]
    }
  });
```

A design goal of AI-UI is to make declarative HTML dynamic, without creating a spaghetti network of events, dependencies or deep references into the DOM, and do it using standard Javascript constructs.

To achieve this, when specifying children, you can specify a JavaSscript [async iterable](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/AsyncIterator) that generates any other child.

The easiest way to do this is with an async generator. Let's add a function that updates the time every second:

```javascript
/* A simple async "sleep" function */
function sleep(seconds) {
  return new Promise(resolve => setTimeout(resolve, seconds * 1000))
}

/* The async generator that yields the time once a second */
async function *clock() {
  while (true) {
    yield new Date().toString();
    await sleep(1);
  }
}
```

...and replace "Dunno" with the time:

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tags contains some other tags: */
      return [
        h2("Hello World"),
        div(clock())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content.html)


When the async generator yields, it will update the content in place in the DOM. In this case, that means telling us the time every second.

Async Iterables (and therefore async generators) are brilliantly flexible. Your data could have come from a ReadableStream, a WebSocket, or with a little work events generated by other elements (AI-UI does this work for you - see [Link elements dynamically](./when.md)).

Any content in your DOM can now be declared statically in your "markup", and generated dynamically.

Let's try a slightly more complicated example:

```javascript
async function *clock() {
  while (true) {
    const now = new Date();
    // Yield a DOM fragment, consisting of two spans and some text:
    yield [
      span({ style: { color: 'black' }},now.toTimeString()), 
      " on ", 
      span({ style: { color: 'magenta' }},now.toDateString())
    ];
    await sleep(1);
  }
}

const App = div.extended({
    constructed() {
      /* When constructed, this "div" tags contains some other tags: */
      return [
        h2("Hello World"),
        div("This time is now: ",clock())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content-2.html)

In this example the generator yields a set of DOM elements that are all updated every second.

In additon to async generators, you can pass Promises (basically a generator that only goes off once, or you can look at an async iterable as a Promise that can resolve multiple times). Quite a few Web APIs return Promises, notably [fetch](https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)

Let's update the App to display a new Chuck Morris joke every few seconds:

```javascript
  /* A function that uses `fetch` to get a Chuck Noris joke. You could write this without async/await easily */
  async function chuckJoke() {
    const response = await fetch('https://api.chucknorris.io/jokes/random');
    const fromJson = await response.json();
    return fromJson.value;
  }

```
...and update our dynamic div's content:

```javascript
  const App = div.extended({
    constructed() {
      /* When constructed, this "div" tags contains some other tags: */
      return [
        h2("Hello World"),
        div(chuckJoke())
      ]
    }
  });
```
[Example (right click and open in new tab)](https://raw.githack.com/MatAtBread/AI-UI/main/guide/examples/dynamic-content-3.html)

AIUI will create the DOM synchronously, and when the Promise resolves, update it in situ with a "joke" abour Chuck Norris.

A child node in AIUI can be a DOM Node, a collection of DOM Nodes (eg an array, a NodeList or HTMLCollection), a primitve with a `toString()` method (numbers, strings, booleans, etc) or a Promise or async iterable that produces any of the above.
