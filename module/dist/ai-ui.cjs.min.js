(()=>{"use strict";var e={d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Iterators:()=>r,enableOnRemovedFromDOM:()=>te,getElementIdMap:()=>re,tag:()=>Q,when:()=>_});var r={};e.r(r),e.d(r,{asyncExtras:()=>f,asyncIterator:()=>u,broadcastIterator:()=>m,defineIterableProperty:()=>p,generatorHelpers:()=>g,isAsyncIter:()=>l,isAsyncIterable:()=>i,isAsyncIterator:()=>c,iterableHelpers:()=>w,merge:()=>v,pushIterator:()=>h});const n="*"==globalThis.DEBUG||1==globalThis.DEBUG||globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1,o=e=>{};function a(){let e=o,t=o;const r=new Promise(((...r)=>[e,t]=r));if(r.resolve=e,r.reject=t,n){const e=(new Error).stack;r.catch((t=>t instanceof Error||t?.value instanceof Error?console.log("Deferred",t,e):void 0))}return r}function s(e){return null!=e&&"function"==typeof e.then}function c(e){return"function"==typeof e?.next}function i(e){return e&&e[Symbol.asyncIterator]&&"function"==typeof e[Symbol.asyncIterator]}function l(e){return i(e)||c(e)}function u(e){if(i(e))return e[Symbol.asyncIterator]();if(c(e))return e;throw new Error("Not as async provider")}function d(e){return function(...t){return w(e.call(this,...t))}}const f={map:d(O),filter:d(E),unique:d(S),throttle:d(P),debounce:d(D),waitFor:d(N),count:d(M),retain:d(A),multi:d(k),broadcast:d(T),initially:d(I),consume:C,merge(...e){return v(this,...e)}};function y(e=(()=>{})){let t=[],r=[];const n={[Symbol.asyncIterator]:()=>n,next(){if(r.length)return Promise.resolve({done:!1,value:r.shift()});const e=a();return e.catch((e=>{})),t.push(e),e},return(){const n={done:!0,value:void 0};if(t){try{e()}catch(e){}for(;t.length;)t.shift().resolve(n);r=t=null}return Promise.resolve(n)},throw(...n){const o={done:!0,value:n[0]};if(t){try{e()}catch(e){}for(;t.length;)t.shift().reject(o);r=t=null}return Promise.reject(o)},push:e=>!!t&&(t.length?t.shift().resolve({done:!1,value:e}):r.push(e),!0)};return n}function h(e=(()=>{}),t=!1){let r=0,n=y((()=>{if(r-=1,0===r&&!t){try{e()}catch(e){}n=null}}));return Object.assign(Object.create(f),{[Symbol.asyncIterator]:()=>(r+=1,n),push:e=>!(!t&&0===r)&&n.push(e),close(e){e?n.throw?.(e):n.return?.(),n=null}})}function m(e=(()=>{})){let t=new Set;return Object.assign(Object.create(f),{[Symbol.asyncIterator](){const r=y((()=>{if(t.delete(r),0===t.size){try{e()}catch(e){}t=null}}));return t.add(r),w(r)},push(e){if(!t?.size)return!1;for(const r of t.values())r.push(e);return!0},close(e){for(const r of t.values())e?r.throw?.(e):r.return?.();t=null}})}function p(e,t,r){let n=()=>{n=()=>t;const e=m(),t=e[Symbol.asyncIterator]();return a[Symbol.asyncIterator]={value:e[Symbol.asyncIterator],enumerable:!1,writable:!1},s=e.push,Object.keys(q).map((e=>a[e]={value:t[e],enumerable:!1,writable:!1})),Object.defineProperties(c,a),t};const o=e=>function(...t){return n(),c[e].call(this,...t)},a={[Symbol.asyncIterator]:{enumerable:!1,writable:!0,value:n}};Object.keys(q).map((e=>a[e]={enumerable:!1,writable:!0,value:o(e)}));let s=e=>(n(),s(e)),c=b(r,a);return Object.defineProperty(e,t,{get:()=>c,set(e){c=b(e,a),s(e?.valueOf())},enumerable:!0}),e}function b(e,t){if(null==e)return Object.create(null,{...t,valueOf:{value:()=>e},toJSON:{value:()=>e}});switch(typeof e){case"object":return Symbol.asyncIterator in e?e:(n&&console.warn('Iterable properties of type "object" will be spread to prevent re-initialisation.',e),Object.defineProperties({...e},t));case"bigint":case"boolean":case"number":case"string":return Object.defineProperties(Object(e),{...t,toJSON:{value:()=>e.valueOf()}})}throw new TypeError('Iterable properties cannot be of type "'+typeof e+'"')}const v=(...e)=>{const t=e.map((e=>Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e)),r=t.map(((e,t)=>e.next().then((e=>({idx:t,result:e}))))),n=[],o=new Promise((()=>{}));let a=r.length;const s={[Symbol.asyncIterator]:()=>s,next:()=>a?Promise.race(r).then((({idx:e,result:c})=>c.done?(a--,r[e]=o,n[e]=c.value,s.next()):(r[e]=t[e].next().then((t=>({idx:e,result:t}))).catch((t=>({idx:e,result:t}))),c))).catch((e=>s.throw?.(e)??Promise.reject({done:!0,value:new Error("Iterator merge exception")}))):Promise.reject({done:!0,value:new Error("Iterator merge complete")}),async return(){const e=new Error("Merge terminated");for(let a=0;a<t.length;a++)r[a]!==o&&(r[a]=o,n[a]=await(t[a].return?.({done:!0,value:e}).then((e=>e.value),(e=>e))));return{done:!0,value:n}},async throw(e){for(let a=0;a<t.length;a++)r[a]!==o&&(r[a]=o,n[a]=await(t[a].throw?.(e).then((e=>e.value),(e=>e))));return{done:!0,value:n}}};return w(s)};function w(e){var t;return i(t=e)&&Object.keys(f).every((e=>e in t&&t[e]===f[e]))||Object.assign(e,f),e}function g(e){return function(...t){return w(e(...t))}}async function*O(...e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.();try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);for(const t of e)yield t(r.value)}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}async function*E(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.();try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);await e(r.value)&&(yield r.value)}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}const j=Symbol("noUniqueValue");async function*S(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.(),n=j;try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);(e&&n!==j?await e(r.value,n):r.value!=n)&&(yield r.value),n=r.value}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}async function*I(e){yield e;for await(const e of this)yield e}async function*P(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.(),n=0;try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);const o=Date.now();n<o&&(n=o+e,yield r.value)}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}const x=new Promise((()=>{}));async function*D(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.(),n=x,o=-1;try{for(;;){const r=await Promise.race([t.next(),n]);if("done"in r&&r.done)return t.return?.(r.value);"debounced"in r&&r.debounced?r.debounced===o&&(yield r.value):(clearTimeout(o),n=new Promise((t=>{o=setTimeout((()=>{t({debounced:o,value:r.value})}),e)})))}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}async function*N(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.();try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);await new Promise((t=>e(t))),yield r.value}}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}async function*M(e){const t=this[Symbol.asyncIterator]();let r=()=>t.return?.(),n=0;try{for await(const t of this){const r={...t,[e]:n++};yield r}t.return?.()}catch(e){r=()=>t.throw?t.throw(e):t.return?.()}finally{r()}}function A(){const e=this[Symbol.asyncIterator]();let t;return{[Symbol.asyncIterator](){return this},next(){const r=e.next();return r.then((e=>t=e)),r},return:t=>e.return?.(t)??Promise.resolve({done:!0,value:t}),throw:(...t)=>e.throw?.(t)??Promise.resolve({done:!0,value:t[0]}),get value(){return t.value},get done(){return Boolean(t.done)}}}function k(){const e=this[Symbol.asyncIterator]();let t=a();function r(e){t.reject({done:!0,value:e})}return e.next().then((function n(o){t.resolve(o),o.done||(t=a(),e.next().then(n).catch(r))})).catch(r),{[Symbol.asyncIterator](){return this},next:()=>t,return:t=>e.return?.(t)??Promise.resolve({done:!0,value:t}),throw:(...t)=>e.throw?.(t)??Promise.resolve({done:!0,value:t[0]})}}function T(){const e=this[Symbol.asyncIterator](),t=m((()=>e.return?.()));return function r(){e.next().then((e=>{e.done||(t.push(e.value),r())})).catch((e=>t.close(e)))}(),{[Symbol.asyncIterator]:()=>t[Symbol.asyncIterator]()}}async function C(e){let t;for await(const r of this)t=e?.(r);await t}const q={map:O,filter:E,unique:S,throttle:P,debounce:D,waitFor:N,count:M,retain:A,multi:k,broadcast:T,initially:I,consume:C,merge:v},B=new Map;function F(e){const t=B.get(e.type);if(t)for(const r of t)try{const{push:n,container:o,selector:a}=r;if(document.body.contains(o)){if(e.target instanceof Node)if(a){const t=o.querySelectorAll(a);for(const r of t)(e.target===r||r.contains(e.target))&&o.contains(r)&&n.push(e)}else(e.target===o||o.contains(e.target))&&n.push(e)}else{const e="Container `#"+o.id+">"+(a||"")+"` removed from DOM. Removing subscription";t.delete(r),n[Symbol.asyncIterator]().return?.(new Error(e))}}catch(e){console.warn("docEventHandler",e)}}function L(e){return Boolean(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function $(e){const t=e.split(":");return 1===t.length?L(t[0])?[t[0],"change"]:[null,t[0]]:2===t.length&&L(t[1])&&!L(t[0])?[t[1],t[0]]:void 0}function R(e,t){const[r,n]=$(t)??function(e){throw new Error(e)}("Invalid WhenSelector: "+t);B.has(n)||(document.addEventListener(n,F,{passive:!0,capture:!0}),B.set(n,new Set));const o=h((()=>B.get(n)?.delete(a))),a={push:o,container:e,selector:r||null};return B.get(n).add(a),o}async function*W(){await new Promise((()=>{})),yield}function H(e){return Object.assign(w((function(t){return f.map.call(e,t)})),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function U(e){if(!e)throw new Error("Falsy async source will never be ready\n\n"+JSON.stringify(e));return"string"==typeof e&&"@"!==e[0]&&Boolean($(e))}function _(e,...t){if(!t||0===t.length)return H(R(e,"change"));const r=t.filter((e=>"string"!=typeof e||"@"!==e[0])).map((t=>"string"==typeof t?R(e,t):t instanceof Element?R(t,"change"):s(t)?async function*(e){yield e}(t):t));if(t.includes("@start")){const n={[Symbol.asyncIterator]:()=>n,next:()=>new Promise((e=>requestAnimationFrame((()=>{n.next=()=>Promise.resolve({done:!0,value:void 0}),e({done:!1,value:{}})}))))};r.push(n)}if(t.includes("@ready")){function o(t){return Boolean("string"==typeof t&&!e.querySelector(t))}const a=t.filter(U).map((e=>$(e)?.[0])).filter(o),c={[Symbol.asyncIterator]:()=>c,async next(){var t;await Promise.all([z(e,a),(t=e,document.body.contains(t)?Promise.resolve():new Promise((e=>new MutationObserver(((r,n)=>{for(const o of r)if(o.addedNodes?.length&&document.body.contains(t))return n.disconnect(),void e()})).observe(document.body,{subtree:!0,childList:!0}))))]);const n=(r.length>1?v(...r):1===r.length?r[0]:W())[Symbol.asyncIterator]();return c.next=n.next.bind(n),c.return=n.return?.bind(n),c.throw=n.throw?.bind(n),{done:!1,value:{}}}};return H(c)}return H(r.length>1?v(...r):1===r.length?r[0]:W())}function z(e,t){if(!t.length)return Promise.resolve();const r=new Promise((r=>new MutationObserver(((n,o)=>{for(const a of n)if(a.addedNodes?.length&&!(t=t.filter((t=>!e.querySelector(t)))).length)return o.disconnect(),void r()})).observe(e,{subtree:!0,childList:!0})));if(n){const e=(new Error).stack?.replace(/^Error/,"Missing selectors after 5 seconds:"),n=setTimeout((()=>{console.warn(e,t)}),5e3);r.finally((()=>clearTimeout(n)))}return r}const G=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],J={get ids(){return re(this)},set ids(e){throw new Error("Cannot set ids on "+this.valueOf())},when:function(...e){return _(this,...e)}},Y=document.createElement("STYLE");function V(e){return"string"==typeof e||"number"==typeof e||"function"==typeof e||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||null==e||Array.isArray(e)||s(e)||l(e)||"function"==typeof e[Symbol.iterator]}Y.id="--ai-ui-extended-tag-styles";const K=Symbol("callStack"),Q=function(e,t,r){const[o,a,c]="string"==typeof e||null===e?[e,t,r]:Array.isArray(e)?[null,e,t]:[null,G,e],d=Object.create(null,Object.getOwnPropertyDescriptors(J));function f(...e){const t=[];return function e(r){if(null!=r){if(s(r)){let e=[Z()];return t.push(e[0]),void r.then((t=>{const r=f(t),n=e;n[0].parentElement&&(y(n[0].parentElement,n[0])(r),n.forEach((e=>e.parentElement?.removeChild(e)))),e=r}),(t=>{console.warn(t),y(e[0])(ee({error:t}))}))}if(r instanceof Node)t.push(r);else if(l(r)){const e=n?"\n"+(new Error).stack?.replace(/^Error: /,"Insertion :"):"",o=i(r)?r[Symbol.asyncIterator]():r,a=Z();t.push(a);let s=[a];const c=e=>{o.return?.(e);const t=(Array.isArray(s)?s:[s]).filter((e=>Boolean(e)));t[0].parentNode?(s=y(t[0].parentNode,t[0])(ee({error:e})),t.forEach((e=>e.parentNode?.removeChild(e)))):console.warn("Can't report error",e,s)},l=t=>{if(!t.done){const r=(Array.isArray(s)?s:[s]).filter((e=>e.ownerDocument?.body.contains(e)));if(!r.length||!r[0].parentNode)return void c(new Error("Element(s) no longer exist in document"+e));s=y(r[0].parentNode,r[0])(m(t.value)??Z()),r.forEach((e=>e.parentNode?.removeChild(e))),o.next().then(l).catch(c)}};o.next().then(l).catch(c)}else if("object"==typeof r&&r?.[Symbol.iterator])for(const t of r)e(t);else t.push(document.createTextNode(r.toString()))}}(e),t}function y(e,t){return void 0===t&&(t=null),function(r){const n=f(r);if(t)if(t instanceof Element)Element.prototype.before.call(t,...n);else{const r=t.parentElement;if(!r)throw new Error("Parent is null");r!==e&&console.warn("Container mismatch??");for(let e=0;e<n.length;e++)r.insertBefore(n[e],t)}else Element.prototype.append.call(e,...n);return n}}function h(e,t){if(null!=t&&"object"==typeof t&&t!==e)for(const[r,o]of Object.entries(Object.getOwnPropertyDescriptors(t)))try{if("value"in o){const a=o.value;a&&l(a)?Object.defineProperty(e,r,o):a&&"object"==typeof a&&!s(a)?r in e?a instanceof Node?(n&&console.log("Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or as a child",r,a),e[r]=a):e[r]!==a&&(Array.isArray(e[r])&&e[r].length!==a.length?a.constructor===Object||a.constructor===Array?h(e[r]=new a.constructor,a):e[r]=a:h(e[r],a)):Object.defineProperty(e,r,o):void 0!==t[r]&&(e[r]=t[r])}else Object.defineProperty(e,r,o)}catch(e){throw console.warn("deepAssign",r,t[r],e),e}}function m(e){const t=e?.valueOf();return Array.isArray(t)?t.map(m):t}function b(e,t){K in t||function t(r,o){if(null==o||"object"!=typeof o)return;const a=Object.entries(Object.getOwnPropertyDescriptors(o));a.sort(((e,t)=>{const n=Object.getOwnPropertyDescriptor(r,e[0]);if(n){if("value"in n)return-1;if("set"in n)return 1;if("get"in n)return.5}return 0}));for(const[c,i]of a)try{if("value"in i){const a=i.value;if(l(a)){const n=u(a),o=a=>{if(e.ownerDocument.contains(e)){if(!a.done){const e=m(a.value);if("object"==typeof e&&null!==e){const n=Object.getOwnPropertyDescriptor(r,c);"style"!==c&&n?.set?r[c]=e:t(r[c],e)}else void 0!==e&&(r[c]=e);n.next().then(o).catch(s)}}else n.return?.(new Error("Element no longer exists in document (update "+c+")"))},s=t=>{n.return?.(t),console.warn("Dynamic attribute error",t,c,r,e),y(e)(ee({error:t}))};n.next().then(o).catch(s)}l(a)||(a&&"object"==typeof a&&!s(a)?a instanceof Node?(n&&console.log("Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or as a child",c,a),r[c]=a):!(c in r)||r[c]===a||Array.isArray(r[c])&&r[c].length!==a.length?a.constructor===Object||a.constructor===Array?(r[c]=new a.constructor,t(r[c],a)):r[c]=a:Object.getOwnPropertyDescriptor(r,c)?.set?r[c]=a:t(r[c],a):void 0!==o[c]&&(r[c]=o[c]))}else Object.defineProperty(r,c,i)}catch(e){throw console.warn("assignProps",c,o[c],e),e}}(e,t)}function v(e){const t="function"!=typeof e?t=>e:e,r={};let o=t(r);o.styles&&(Y.appendChild(document.createTextNode(o.styles+"\n")),document.head.contains(Y)||document.head.appendChild(Y));const a=Object.assign(((e,...r)=>{const n=V(e),o=[],s={[K]:(n?o:e[K])??o},c=n?this(s,e,...r):this(s,...r);c.constructor=a;const i=t({});if(s[K].push(i),h(c,i.prototype),h(c,i.override),h(c,i.declare),i.iterable&&Object.keys(i.iterable).forEach((e=>{p(c,e,i.iterable[e])})),s[K]===o){n||b(c,e);for(const e of o){const t=e?.constructed?.call(c);V(t)&&y(c)(t)}for(const e of o)e.iterable&&Object.keys(e.iterable).forEach((e=>c[e]=c[e].valueOf()))}return c}),{super:this,overrides:t,extended:v,valueOf:()=>{const e=[...Object.keys(o.declare||{})];return`${a.name}: {${e.join(", ")}}\n ↪ ${this.valueOf()}`}}),s={};!function e(t){t?.super&&e(t.super);const n=t.overrides?.(r);n&&(h(s,n?.prototype),h(s,n?.override),h(s,n?.declare))}(this),h(s,o.prototype),h(s,o.override),h(s,o.declare),Object.defineProperties(a,Object.getOwnPropertyDescriptors(s));const c=s&&"className"in s&&"string"==typeof s.className?s.className:"?",i=n?" @"+((new Error).stack?.split("\n")[2]?.match(/\((.*)\)/)?.[1]??"?"):"";return Object.defineProperty(a,"name",{value:"<ai-"+c.replace(/\s+/g,"-")+i+">"}),a}Object.defineProperty(d,"attributes",{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(e){b(this,e)}}),c&&h(d,c),o||(Q.appender=y,Q.nodes=f);const w={};return a.forEach((function(e){if(w[e])return w[e];const t=(r,...n)=>{let a=document;if(V(r)&&(n.unshift(r),r={prototype:{}}),!V(r)){r.debugger&&delete r.debugger,r.document&&(a=r.document,delete r.document);const s=o?a.createElementNS(o,e.toLowerCase()):a.createElement(e);return s.constructor=t,h(s,d),b(s,r),y(s)(n),s}},r=Object.assign(t,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:v,valueOf:()=>`TagCreator: <${o||""}${o?"::":""}${e}>`});return Object.defineProperty(t,"name",{value:"<"+e+">"}),w[e]=r})),w},{"ai-ui-container":X}=Q("",["ai-ui-container"]),Z=X.extended({styles:`\n  ai-ui-container.promise {\n    display: ${n?"inline":"none"};\n    color: #888;\n    font-size: 0.75em;\n  }\n  ai-ui-container.promise:after {\n    content: "⋯";\n  }`,override:{className:"promise"},constructed:()=>X({style:{display:"none"}},n?new Error("Constructed").stack?.replace(/^Error: /,""):void 0)}),ee=X.extended({styles:"\n  ai-ui-container.error {\n    display: block;\n    color: #b33;\n    white-space: pre;\n  }",override:{className:"error"},declare:{error:void 0},constructed(){return this.error?this.error instanceof Error?this.error.stack:"value"in this.error&&this.error.value instanceof Error?this.error.value.stack:this.error.toString():"Error"}});let te=function(){te=function(){},new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&e.removedNodes.forEach((e=>e&&e instanceof Element&&[...e.getElementsByTagName("*"),e].filter((e=>!e.ownerDocument.contains(e))).forEach((e=>{"onRemovedFromDOM"in e&&"function"==typeof e.onRemovedFromDOM&&e.onRemovedFromDOM()}))))}))})).observe(document.body,{subtree:!0,childList:!0})};function re(e,t){return e=e||document,t=t||{},e.querySelectorAll&&e.querySelectorAll("[id]").forEach((function(e){e.id&&(t[e.id]?n&&console.info("Shadowed multiple element IDs",e.id,e,t[e.id]):t[e.id]=e)})),t}exports.Iterators=t.Iterators,exports.enableOnRemovedFromDOM=t.enableOnRemovedFromDOM,exports.getElementIdMap=t.getElementIdMap,exports.tag=t.tag,exports.when=t.when,Object.defineProperty(exports,"__esModule",{value:!0})})();