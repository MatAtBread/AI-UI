"use strict";var he=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var Ge=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var n in t)he(e,n,{get:t[n],enumerable:!0})},Qe=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ve(t))!Ge.call(e,o)&&o!==n&&he(e,o,{get:()=>t[o],enumerable:!(i=$e(t,o))||i.enumerable});return e};var qe=e=>Qe(he({},"__esModule",{value:!0}),e);var bt={};ke(bt,{Iterators:()=>Ae,UniqueID:()=>ye,tag:()=>Fe,when:()=>be});module.exports=qe(bt);var O=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Z=5e3,v={log(...e){O&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){O&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){O&&console.info("(AI-UI) INFO:",...e)}};var Ne=e=>{};function Te(){let e=Ne,t=Ne,n=new Promise((...i)=>[e,t]=i);if(n.resolve=e,n.reject=t,O){let i=new Error().stack;n.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",i):void 0)}return n}function le(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return le(e)&&"then"in e&&typeof e.then=="function"}var Ae={};ke(Ae,{Ignore:()=>N,Iterability:()=>re,asyncExtras:()=>ce,asyncIterator:()=>ve,augmentGlobalAsyncGenerators:()=>ot,combine:()=>je,debounceQueueIteratableIterator:()=>Me,defineIterableProperty:()=>xe,filterMap:()=>_,generatorHelpers:()=>Ye,isAsyncIter:()=>G,isAsyncIterable:()=>de,isAsyncIterator:()=>ae,iterableHelpers:()=>Q,merge:()=>ue,queueIteratableIterator:()=>Ee});var re=Symbol("Iterability");function ae(e){return le(e)&&"next"in e&&typeof e?.next=="function"}function de(e){return le(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return de(e)||ae(e)}function ve(e){if(ae(e))return e;if(de(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var ce={filterMap(e,t=N){return _(this,e,t)},map:Je,filter:ze,unique:et,waitFor:nt,multi:rt,initially:tt,consume:Be,merge(...e){return ue(this,...e)},combine(e){return je(Object.assign({_this:this},e))}},Ie=[...Object.getOwnPropertySymbols(ce),...Object.keys(ce)];function pe(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let i of n)Object.defineProperty(e,i,{...Object.getOwnPropertyDescriptor(t,i),enumerable:!1});return e}var K=Symbol("pending"),V=Symbol("items");function Re(e=()=>{}){let t={[K]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[K])return Promise.resolve({done:!0,value:void 0});let n=Te();return n.catch(i=>{}),t[K].unshift(n),n},return(n){let i={done:!0,value:void 0};if(t[K]){try{e()}catch{}for(;t[K].length;)t[K].pop().resolve(i);t[V]=t[K]=null}return Promise.resolve(i)},throw(...n){let i={done:!0,value:n[0]};if(t[K]){try{e()}catch{}for(;t[K].length;)t[K].pop().reject(i);t[V]=t[K]=null}return Promise.reject(i)},get length(){return t[V]?t[V].length:-1},push(n){return t[K]?(t[K].length?t[K].pop().resolve({done:!1,value:n}):t[V]?t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var fe=Symbol("inflight");function Xe(e=()=>{}){let t=Re(e);return t[fe]=new Set,t.push=function(n){if(!t[K])return!1;if(t[fe].has(n))return!0;if(t[K].length){t[fe].add(n);let i=t[K].pop();i.finally(()=>t[fe].delete(n)),i.resolve({done:!1,value:n})}else t[V]?t[V].find(i=>i.value===n)||t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ee=Re,Me=Xe,ne=Symbol("_proxiedAsyncIterator");function xe(e,t,n){let i=()=>{i=()=>U;let m=Me(),x=m.multi(),U=x[Symbol.asyncIterator]();return y[Symbol.asyncIterator]=x[Symbol.asyncIterator],p=m.push,Ie.forEach(w=>y[w]=U[w]),ne in r||pe(r,y),U};function o(m){return{[m]:function(...x){return i(),r[m].apply(this,x)}}[m]}let y={[Symbol.asyncIterator]:i};Ie.forEach(m=>y[m]=o(m)),typeof n=="object"&&n&&re in n&&n[re]==="shallow"&&(y[re]=n[re]);let p=m=>(i(),p(m)),r=d(n,y),s;return Object.defineProperty(e,t,{get(){return r},set(m){if(m!==r)if(de(m)){if(s===m)return;s=m;let x=O?new Error:void 0;O&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Be.call(m,U=>{if(m!==s)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});p(U?.valueOf())}).catch(U=>v.info(U)).finally(()=>m===s&&(s=void 0));return}else s&&O&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=d(m,y);p(m?.valueOf())},enumerable:!0}),e;function d(m,x){if(m==null)return pe(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),x);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return pe(Object(m),Object.assign(x,{toJSON(){return m.valueOf()}}));case"object":return q(m,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function S(m){return le(m)&&ne in m}function R(m,x){let U=x.split(".").slice(1);for(let w=0;w<U.length&&(m=m?.[U[w]])!==void 0;w++);return m}function q(m,x){let U,w;return new Proxy(m,se());function se(L=""){return{has(C,E){return E===ne||E===Symbol.toPrimitive||E in C||E in x},set(C,E,$,j){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${L}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(C,E,j)!==$&&p({[ne]:{a:m,path:L}}),Reflect.set(C,E,$,j)},deleteProperty(C,E){return Reflect.deleteProperty(C,E)?(p({[ne]:{a:m,path:L}}),!0):!1},get(C,E,$){if(Object.hasOwn(x,E))return L.length?(U??(U=_(x,a=>S(a)?a[ne]:{a,path:null})),_(U,(a,b)=>{let c=R(a.a,L);return b!==c||a.path===null||a.path.startsWith(L)?c:N},N,R(m,L))[E]):(w??(w=_(x,j=>S(j)?j[ne].a:j)),w[E]);if(E==="valueOf")return()=>R(m,L);if(E===Symbol.toPrimitive)return function(j){return Reflect.has(C,E)?Reflect.get(C,E,C).call(C,j):j==="string"?C.toString():j==="number"?Number(C):C.valueOf()};if(typeof E=="string"&&(!(E in C)||Object.hasOwn(C,E))&&!(re in C&&C[re]==="shallow")){let j=Reflect.get(C,E,$);return typeof j=="function"||G(j)?j:new Proxy(Object(j),se(L+"."+E))}return Reflect.get(C,E,$)}}}}}var J=new Promise(()=>{}),ue=(...e)=>{let t=new Array(e.length),n=new Array(e.length),i=()=>{i=()=>{};for(let r=0;r<e.length;r++){let s=e[r];n[r]=(t[r]=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s).next().then(d=>({idx:r,result:d}))}},o=[],y=n.length,p={[Symbol.asyncIterator](){return p},next(){return i(),y?Promise.race(n).then(({idx:r,result:s})=>s.done?(y--,n[r]=J,o[r]=s.value,p.next()):(n[r]=t[r]?t[r].next().then(d=>({idx:r,result:d})).catch(d=>({idx:r,result:{done:!0,value:d}})):Promise.resolve({idx:r,result:{done:!0,value:void 0}}),s)).catch(r=>p.throw?.(r)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:o})},async return(r){for(let s=0;s<t.length;s++)n[s]!==J&&(n[s]=J,o[s]=await t[s]?.return?.({done:!0,value:r}).then(d=>d.value,d=>d));return{done:!0,value:o}},async throw(r){for(let s=0;s<t.length;s++)n[s]!==J&&(n[s]=J,o[s]=await t[s]?.throw?.(r).then(d=>d.value,d=>d));return{done:!0,value:o}}};return Q(p)},je=(e,t={})=>{let n={},i,o=[],y=0,p={[Symbol.asyncIterator](){return p},next(){return i===void 0&&(i=Object.entries(e).map(([r,s],d)=>(y+=1,o[d]=s[Symbol.asyncIterator](),o[d].next().then(S=>({si:o,idx:d,k:r,ir:S}))))),function r(){return Promise.race(i).then(({idx:s,k:d,ir:S})=>S.done?(i[s]=J,y-=1,y?r():{done:!0,value:void 0}):(n[d]=S.value,i[s]=o[s].next().then(R=>({idx:s,k:d,ir:R})),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?r():{done:!1,value:n}))}()},return(r){return i.forEach((s,d)=>{s!==J&&o[d].return?.(r)}),Promise.resolve({done:!0,value:r})},throw(r){return i.forEach((s,d)=>{s!==J&&o[d].throw?.(r)}),Promise.reject({done:!0,value:r})}};return Q(p)};function _e(e){return de(e)&&Ie.every(t=>t in e&&e[t]===ce[t])}function Q(e){return _e(e)||pe(e,ce),e}function Ye(e){return function(...t){let n=e(...t);return Q(n)}}async function Be(e){let t;for await(let n of this)t=e?.(n);await t}var N=Symbol("Ignore");function Ze(e,t,n){if(X(e))return e.then(t,n);try{return t(e)}catch(i){return n(i)}}function _(e,t,n=N,i=N){let o;function y(r){return o=p=null,i=N,{done:!0,value:r?.value}}let p={[Symbol.asyncIterator](){return p},next(...r){if(n!==N){let s=Promise.resolve({done:!1,value:n});return n=N,s}return new Promise(function s(d,S){o||(o=e[Symbol.asyncIterator]()),o.next(...r).then(R=>R.done?(i=N,d(R)):Ze(t(R.value,i),q=>q===N?s(d,S):d({done:!1,value:i=q}),q=>{i=N,o.throw?o.throw(q):o.return?.(q),S({done:!0,value:q})}),R=>{i=N,S({done:!0,value:R})}).catch(R=>{i=N,o.throw?o.throw(R):o.return?.(R),S({done:!0,value:R})})})},throw(r){return Promise.resolve(o?.throw?o.throw(r):o?.return?.(r)).then(y)},return(r){return Promise.resolve(o?.return?.(r)).then(y)}};return Q(p)}function Je(e){return _(this,e)}function ze(e){return _(this,async t=>await e(t)?t:N)}function et(e){return e?_(this,async(t,n)=>n===N||await e(t,n)?t:N):_(this,(t,n)=>t===n?N:t)}function tt(e){return _(this,t=>t,e)}function nt(e){return _(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function rt(){let e=this,t=0,n,i;function o(r){r&&n.resolve(r),r?.done?n=null:(n=Te(),i.next().then(o).catch(s=>{n.reject({done:!0,value:s}),n=null}))}function y(r){return i=p=n=null,{done:!0,value:r?.value}}let p={[Symbol.asyncIterator](){return t+=1,p},next(){return i||(i=e[Symbol.asyncIterator](),o()),n},throw(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(i?.throw?i.throw(r):i?.return?.(r)).then(y)},return(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(i?.return?.(r)).then(y)}};return Q(p)}function ot(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var z=new WeakMap;function st(e){setTimeout(()=>at.call(this,e),1)}function at(e){z.has(this)||z.set(this,new Map);let t=z.get(this).get(e.type);if(t)for(let n of t)try{let{push:i,terminate:o,containerRef:y,selector:p,includeChildren:r}=n,s=y.deref();if(!s||!s.isConnected){let d="Container `#"+s?.id+">"+(p||"")+"` removed from DOM. Removing subscription";t.delete(n),o(new Error(d))}else if(e.target instanceof Node)if(p){let d=s.querySelectorAll(p);for(let S of d)(r?S.contains(e.target):e.target===S)&&s.contains(S)&&i(e)}else(r?s.contains(e.target):e.target===s)&&i(e)}catch(i){v.warn("docEventHandler",i)}}function Pe(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function He(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Oe(e){let t=e.split(":");if(t.length===1)return Pe(t[0])?[He(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Pe(t[1])&&!Pe(t[0]))return[He(t[1]),t[0]]}function it(e){throw new Error(e)}function Se(e,t){let[{includeChildren:n,selector:i},o]=Oe(t)??it("Invalid WhenSelector: "+t);z.has(e.ownerDocument)||z.set(e.ownerDocument,new Map),z.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,st,{passive:!0,capture:!0}),z.get(e.ownerDocument).set(o,new Set));let y=z.get(e.ownerDocument).get(o),p=Ee(()=>y.delete(r)),r={push:p.push,terminate(s){p.return?.(s)},containerRef:new WeakRef(e),includeChildren:n,selector:i};return Ke(e,i?[i]:void 0).then(s=>y.add(r)),p.multi()}async function*lt(){return void 0}function Ce(e){function t(n){return e.map(n)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function ct(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Oe(e)}async function*dt(e){yield e}function be(e,...t){if(!t||t.length===0)return Ce(Se(e,"change"));let n=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?Se(e,o):o instanceof Element?Se(o,"change"):X(o)?dt(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(o)}if(t.includes("@ready")){let o=t.filter(ct).map(d=>Oe(d)?.[0]),y=d=>typeof d=="string"&&!e.querySelector(d),p=o.map(d=>d?.selector).filter(y),r,s={[Symbol.asyncIterator](){return s},throw(d){return r?.throw?r.throw(d):Promise.resolve({done:!0,value:d})},return(d){return r?.return?r.return(d):Promise.resolve({done:!0,value:d})},next(){return r?r.next():Ke(e,p).then(()=>(r=(n.length>1?ue(...n):n.length===1?n[0]:void 0)?.[Symbol.asyncIterator](),r?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Ce(Q(s))}let i=n.length>1?ue(...n):n.length===1?n[0]:lt();return Ce(Q(i))}function Ke(e,t){function n(){if(e.isConnected)return Promise.resolve();let o=new Promise((y,p)=>new MutationObserver((r,s)=>{r.some(d=>d.addedNodes?.length)&&e.isConnected&&(s.disconnect(),y()),r.some(d=>[...d.removedNodes].some(S=>S===e||S.contains(e)))&&(s.disconnect(),p(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(O){let y=new Error().stack?.replace(/^Error/,`Element not mounted after ${Z/1e3} seconds:`),p=setTimeout(()=>{v.warn(y+`
`+e.outerHTML)},Z);o.finally(()=>clearTimeout(p))}return o}function i(o){if(o=o.filter(p=>!e.querySelector(p)),!o.length)return Promise.resolve();let y=new Promise(p=>new MutationObserver((r,s)=>{r.some(d=>d.addedNodes?.length)&&o.every(d=>e.querySelector(d))&&(s.disconnect(),p())}).observe(e,{subtree:!0,childList:!0}));if(O){let p=new Error().stack?.replace(/^Error/,`Missing selectors after ${Z/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(p+o+`
`)},Z);y.finally(()=>clearTimeout(r))}return y}return t?.length?n().then(()=>i(t)):n()}var ie=Symbol("callStack");var ye=Symbol("Unique ID"),me=Symbol("trackNodes"),ut=Symbol("tracAttributes"),We=Symbol("onRemovalFromDOM"),Y=O?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},yt=0,ft=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function oe(){throw new Error("<elt>.ids is a read-only map of Elements")}var Ue=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function Le(e){return e in Ue?Ue[e]:e}function ge(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var Fe=function(e,t,n){let[i,o,y]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,ft,e],p=y?.commonProperties,r=y?.document??globalThis.document,s=pt(r);function d(a){return r.createComment(a?a.toString():O&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function S({error:a}){return r.createComment(a instanceof Error?a.toString():`Error:
`+JSON.stringify(a,null,2))}let R="--ai-ui-extended-tag-styles";document.getElementById(R)||r.head.appendChild(Object.assign(r.createElement("STYLE"),{id:R}));let q=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...a){return be(this,...a)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(a){if(G(a)){let b=ae(a)?a:a[Symbol.asyncIterator](),c=()=>b.next().then(({done:l,value:h})=>{L(this,h),l||c()},l=>v.warn(l));c()}else L(this,a)}},ids:{configurable:!0,enumerable:!0,set:oe,get(){let a=new Proxy(()=>{},{apply(b,c,l){try{return c.constructor.definition.ids[l[0].id](...l)}catch(h){throw new Error(`<elt>.ids.${l?.[0]?.id} is not a tag-creating function`,{cause:h})}},construct:oe,defineProperty:oe,deleteProperty:oe,set:oe,setPrototypeOf:oe,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(b,c){if(this.get(b,c,null))return Reflect.getOwnPropertyDescriptor(b,Le(c))},has(b,c){return!!this.get(b,c,null)},ownKeys:b=>{let c=[...this.querySelectorAll("[id]")].map(h=>h.id),l=[...new Set(c)];return O&&c.length!==l.length&&v.log("Element contains multiple, shadowed decendant ids",l),l},get:(b,c,l)=>{if(typeof c=="string"){let h=Le(c);if(h in b){let P=b[h].deref();if(P&&P.id===c&&this.contains(P))return P;delete b[h]}let f;if(O){let P=this.querySelectorAll("#"+CSS.escape(c));P.length>1&&(q.has(c)||(q.add(c),v.log(`Element contains multiple, shadowed decendants with ID "${c}"`))),f=P[0]}else f=this.querySelector("#"+CSS.escape(c))??void 0;return f&&Reflect.set(b,h,new WeakRef(f),b),f}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:oe,get(){return a}}),a}}});y?.enableOnRemovedFromDOM&&Object.defineProperty(m,"onRemovedFromDOM",{configurable:!0,enumerable:!1,set:function(a){s.onRemoval([this],We,a)},get:function(){s.getRemovalHandler(this,We)}}),p&&w(m,p);function*x(...a){function b(c){return c==null||c===N}for(let c of a)if(!b(c)){if(X(c)){let l=d();c.then(h=>{l.replaceWith(...x(h)),l=void 0}),yield l;continue}if(c instanceof Node){yield c;continue}if(c&&typeof c=="object"&&Symbol.iterator in c&&!(Symbol.asyncIterator in c)&&c[Symbol.iterator]){for(let l of c)yield*x(l);continue}if(G(c)){let l=O?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",h=ae(c)?c:c[Symbol.asyncIterator](),f=!0,P=(T=!1)=>{if(!h||!u.nodes)return!0;if(T||u.nodes.every(I=>s.has(I))){u.nodes?.forEach(D=>s.add(D));let I="Element(s) have been removed from the document: "+u.nodes.map(Y).join(`
`)+l;return u.nodes=null,h.return?.(new Error(I)),h=null,!0}return!1},ee=c.valueOf(),u={nodes:ee===c?[]:[...x(ee)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};u.nodes.length||(u.nodes=[d()]),s.onRemoval(u.nodes,me,P);let g=O?(()=>{let T=Date.now()+Z,I=new Error("Created by").stack,D=()=>{f&&T&&T<Date.now()&&(D=()=>{},v.warn(`Async element not mounted after ${Z/1e3} seconds. If it is never mounted, it will leak.`,I,u.nodes?.map(Y)))};return D})():null;(function T(){h.next().then(I=>{if(!I.done){if(!u.nodes){h?.throw?.(new Error("Already ternimated"));return}let D=u.nodes.filter(A=>A.isConnected),k=f?u.nodes:D;if(f&&D.length&&(f=!1),!P(!k.length)){g?.(),s.onRemoval(u.nodes,me),u.nodes=[...x(se(I.value))],u.nodes.length||(u.nodes=[d()]),s.onRemoval(u.nodes,me,P);for(let A=0;A<k.length;A++)A===0?k[0].replaceWith(...u.nodes):u.nodes.includes(k[A])||k[A].remove(),s.add(k[A]);T()}}}).catch(I=>{let D=u.nodes?.filter(k=>!!k?.parentNode);u.nodes?.forEach(k=>s.add(k)),D?.length?(D[0].replaceWith(S({error:I})),D.slice(1).forEach(k=>k?.remove())):v.warn("Can't report error",I,u.nodes?.map(Y)),u.nodes&&s.onRemoval(u.nodes,me),u.nodes=null,h.return?.(I),h=null})})(),u.nodes&&(yield*u);continue}yield r.createTextNode(c.toString())}}i||Object.assign(Fe,{nodes:x,UniqueID:ye});let U=Object.getPrototypeOf({});function w(a,b,c){if(!(b==null||typeof b!="object"||b===a))for(let[l,h]of Object.entries(Object.getOwnPropertyDescriptors(b)))try{if("value"in h){let f=h.value;f&&G(f)?Object.defineProperty(a,l,h):f&&typeof f=="object"&&!X(f)?l in a?f instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${l}' value: ${Y(f)} destination: ${a instanceof Node?Y(a):a}`),a[l]=f):a[l]!==f&&(Array.isArray(a[l])&&a[l].length!==f.length?f.constructor===Object||f.constructor===Array?w(a[l]=new f.constructor,f):a[l]=f:w(a[l],f)):(c&&(Object.getPrototypeOf(f)===U||!Object.getPrototypeOf(f)?w(h.value={},f):Array.isArray(f)?w(h.value=[],f):v.warn(`Declared propety '${l}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,a,f)),Object.defineProperty(a,l,h)):b[l]!==void 0&&(a[l]=b[l])}else Object.defineProperty(a,l,h)}catch(f){throw v.warn("deepAssign",l,b[l],f),f}}function se(a){let b=a?.valueOf();return Array.isArray(b)?Array.prototype.map.call(b,se):b}function L(a,b){ie in b||function c(l,h){if(h==null||typeof h!="object")return;let f=Object.entries(Object.getOwnPropertyDescriptors(h));Array.isArray(h)||f.sort(u=>{let g=Object.getOwnPropertyDescriptor(l,u[0]);if(g){if("value"in g)return-1;if("set"in g||"get"in g)return 1}return 0});for(let[u,g]of f)try{if("value"in g){let T=g.value;G(T)?P(T,u):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?P(I,u):ee(I,u):h[u]!==void 0&&(l[u]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?ee(T,u):h[u]!==void 0&&(l[u]=h[u]))}else Object.defineProperty(l,u,g)}catch(T){throw v.warn("assignProps",u,h[u],T),T}function P(u,g){let T=ve(u),I=!0,D=Date.now()+Z,k=O&&new Error("Created by").stack,A=M=>{if(!M.done){let B=se(M.value);if(typeof B=="object"&&B!==null){let H=Object.getOwnPropertyDescriptor(l,g);g==="style"||!H?.set?c(l[g],B):l[g]=B}else B!==void 0&&(l[g]=B);let W=a.isConnected;if(s.has(a)||!I&&!W){v.info(`Element does not exist in document when setting async attribute '${g}' to:
${Y(a)}`),T.return?.();return}W&&(I=!1),I&&D&&D<Date.now()&&(D=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${g}' not mounted after ${Z/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Y(a)}
${k}`)),T.next().then(A).catch(F)}},F=M=>{T.return?.(M),M&&(v.warn("Dynamic attribute terminartion",M,g,l,k,Y(a)),a.appendChild(S({error:M})))},te=u.valueOf();te!==void 0&&te!==u&&!G(te)?A({done:!1,value:te}):T.next().then(A).catch(F),s.onRemoval([a],ut,F)}function ee(u,g){if(u instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${g}' value: ${Y(u)} destination: ${a instanceof Node?Y(a):a}`),l[g]=u;else if(!(g in l)||l[g]===u||Array.isArray(l[g])&&l[g].length!==u.length)if(u.constructor===Object||u.constructor===Array){let T=new u.constructor;c(T,u),l[g]=T}else l[g]=u;else Object.getOwnPropertyDescriptor(l,g)?.set?l[g]=u:c(l[g],u)}}(a,b)}function C(a){for(let b=a.constructor;b;b=b.super)if(b===this)return!0;return!1}function E(a){let b=typeof a!="function"?g=>Object.assign({},a,g):a,c=Date.now().toString(36)+(yt++).toString(36)+Math.random().toString(36).slice(2),l=b({[ye]:c});l.styles&&document.getElementById(R)?.appendChild(r.createTextNode(l.styles+`
`));let f=Object.assign((g,...T)=>{let I=ge(g),D=[],k={[ie]:(I?D:g[ie])??D},A=I?this(k,g,...T):this(k,...T);A.constructor=f;let F=b({[ye]:c});if(k[ie].push(F),O){let M=(B,W)=>{for(let H=B;H;H=H.super)if(H.definition?.declare&&W in H.definition.declare)return!0;return!1};if(F.declare){let B=Object.keys(F.declare).filter(W=>W in A||M(this,W));B.length&&v.log(`Declared keys '${B}' in ${f.name} already exist in base '${this.valueOf()}'`)}if(F.override){let B=Object.keys(F.override).filter(W=>!(W in A)&&!(p&&W in p)&&!M(this,W));B.length&&v.log(`Overridden keys '${B}' in ${f.name} do not exist in base '${this.valueOf()}'`)}}w(A,F.declare,!0),w(A,F.override);let te=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(M=>{M in A?(v.log(`Ignoring attempt to re-define iterable property "${M}" as it could already have consumers`),te.add(M)):xe(A,M,F.iterable[M])}),k[ie]===D){I||L(A,g);for(let W of D){let H=W?.constructed?.call(A);ge(H)&&A.append(...x(H))}let M={},B=!1;for(let W of D)if(W.iterable)for(let H of Object.keys(W.iterable)){let we=!I&&H in g;if(te.has(H)&&we||!(we&&(!X(g[H])||!G(g[H])))){let De=A[H]?.valueOf();De!==void 0&&(M[H]=De,B=!0)}}B&&Object.assign(A,M)}return A},{super:this,definition:Object.assign(l,{[ye]:c}),extended:E,valueOf:()=>{let g=[...Object.keys(l.declare||{}),...Object.keys(l.iterable||{})];return`${f.name}: {${g.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(f,Symbol.hasInstance,{value:C,writable:!0,configurable:!0});let P={};(function g(T){T?.super&&g(T.super);let I=T.definition;I&&(w(P,I?.override),w(P,I?.declare))})(this),w(P,l.override),w(P,l.declare),Object.defineProperties(f,Object.getOwnPropertyDescriptors(P));let ee=P&&"className"in P&&typeof P.className=="string"?P.className:c,u=O?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(f,"name",{value:"<ai-"+ee.replace(/\s+/g,"-")+u+">"}),O){let g=Object.keys(l).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));g.length&&v.log(`${f.name} defines extraneous keys '${g}', which are unknown`)}return f}let $={createElement(a,b,...c){return a===$.createElement?x(...c):typeof a=="function"?a(b,c):typeof a=="string"&&a in $?$[a](b,c):a instanceof Node?a:S({error:new Error("Illegal type in createElement:"+a)})}};function j(a){if($[a])return $[a];let b=(l,...h)=>{if(ge(l)&&(h.unshift(l),l={}),!ge(l)){if(l.debugger){debugger;delete l.debugger}let f=i?r.createElementNS(i,a.toLowerCase()):r.createElement(a);return f.constructor=b,w(f,m),L(f,l),f.append(...x(...h)),f}},c=Object.assign(b,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${i||""}${i?"::":""}${a}>`}});return Object.defineProperty(b,Symbol.hasInstance,{value:C,writable:!0,configurable:!0}),Object.defineProperty(b,"name",{value:"<"+a+">"}),$[a]=c}return o.forEach(j),$};function pt(e){let t=new WeakSet,n=new WeakMap;function i(o){for(let y of o)if(!y.isConnected){t.add(y),i(y.childNodes);let p=n.get(y);if(p){n.delete(y);for(let[r,s]of p?.entries())try{s.call(y)}catch{v.info("Ignored exception handling node removal",r,s,Y(y))}}}}return new MutationObserver(o=>{o.forEach(function(y){y.type==="childList"&&y.removedNodes.length&&i(y.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(o){return t.has(o)},add(o){return t.add(o)},getRemovalHandler(o,y){return n.get(o)?.get(y)},onRemoval(o,y,p){p?o.forEach(r=>{let s=n.get(r)??new Map;n.set(r,s),s.set(y,p)}):o.forEach(r=>{let s=n.get(r);s&&(s.delete(y),s.size||n.delete(r))})}}}
