"use strict";var he=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ve=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var r in t)he(e,r,{get:t[r],enumerable:!0})},Ge=(e,t,r,a)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of $e(t))!Ve.call(e,o)&&o!==r&&he(e,o,{get:()=>t[o],enumerable:!(a=Fe(t,o))||a.enumerable});return e};var Qe=e=>Ge(he({},"__esModule",{value:!0}),e);var ft={};ke(ft,{Iterators:()=>Pe,UniqueID:()=>fe,tag:()=>Le,when:()=>me});module.exports=Qe(ft);var S=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){S&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){S&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){S&&console.info("(AI-UI) INFO:",...e)}};var Ne=e=>{};function Te(){let e=Ne,t=Ne,r=new Promise((...a)=>[e,t]=a);if(r.resolve=e,r.reject=t,S){let a=new Error().stack;r.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",a):void 0)}return r}function ce(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return ce(e)&&"then"in e&&typeof e.then=="function"}var Pe={};ke(Pe,{Ignore:()=>D,Iterability:()=>oe,asyncExtras:()=>de,asyncIterator:()=>ve,augmentGlobalAsyncGenerators:()=>rt,combine:()=>je,debounceQueueIteratableIterator:()=>Re,defineIterableProperty:()=>xe,filterMap:()=>_,generatorHelpers:()=>_e,isAsyncIter:()=>G,isAsyncIterable:()=>ue,isAsyncIterator:()=>ie,iterableHelpers:()=>Q,merge:()=>ye,queueIteratableIterator:()=>Ee});var oe=Symbol("Iterability");function ie(e){return ce(e)&&"next"in e&&typeof e?.next=="function"}function ue(e){return ce(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return ue(e)||ie(e)}function ve(e){if(ie(e))return e;if(ue(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var de={filterMap(e,t=D){return _(this,e,t)},map:Ze,filter:Je,unique:ze,waitFor:tt,multi:nt,initially:et,consume:Be,merge(...e){return ye(this,...e)},combine(e){return je(Object.assign({_this:this},e))}},Ie=[...Object.getOwnPropertySymbols(de),...Object.keys(de)];function be(e,t){let r=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let a of r)Object.defineProperty(e,a,{...Object.getOwnPropertyDescriptor(t,a),enumerable:!1});return e}var B=Symbol("pending"),V=Symbol("items");function Me(e=()=>{}){let t={[B]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[B])return Promise.resolve({done:!0,value:void 0});let r=Te();return r.catch(a=>{}),t[B].unshift(r),r},return(r){let a={done:!0,value:void 0};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().resolve(a);t[V]=t[B]=null}return Promise.resolve(a)},throw(...r){let a={done:!0,value:r[0]};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().reject(a);t[V]=t[B]=null}return Promise.reject(a)},get length(){return t[V]?t[V].length:-1},push(r){return t[B]?(t[B].length?t[B].pop().resolve({done:!1,value:r}):t[V]?t[V].push({done:!1,value:r}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var pe=Symbol("inflight");function qe(e=()=>{}){let t=Me(e);return t[pe]=new Set,t.push=function(r){if(!t[B])return!1;if(t[pe].has(r))return!0;if(t[B].length){t[pe].add(r);let a=t[B].pop();a.finally(()=>t[pe].delete(r)),a.resolve({done:!1,value:r})}else t[V]?t[V].find(a=>a.value===r)||t[V].push({done:!1,value:r}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ee=Me,Re=qe,re=Symbol("_proxiedAsyncIterator");function xe(e,t,r){let a=()=>{a=()=>H;let m=Re(),x=m.multi(),H=x[Symbol.asyncIterator]();return h[Symbol.asyncIterator]=x[Symbol.asyncIterator],u=m.push,Ie.forEach(w=>h[w]=H[w]),re in n||be(n,h),H};function o(m){return{[m]:function(...x){return a(),n[m].apply(this,x)}}[m]}let h={[Symbol.asyncIterator]:a};Ie.forEach(m=>h[m]=o(m)),typeof r=="object"&&r&&oe in r&&r[oe]==="shallow"&&(h[oe]=r[oe]);let u=m=>(a(),u(m)),n=d(r,h),i;return Object.defineProperty(e,t,{get(){return n},set(m){if(m!==n)if(ue(m)){if(i===m)return;i=m;let x=S?new Error:void 0;S&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Be.call(m,H=>{if(m!==i)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});u(H?.valueOf())}).catch(H=>v.info(H)).finally(()=>m===i&&(i=void 0));return}else i&&S&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),n=d(m,h);u(m?.valueOf())},enumerable:!0}),e;function d(m,x){if(m==null)return be(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),x);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return be(Object(m),Object.assign(x,{toJSON(){return m.valueOf()}}));case"object":return q(m,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function C(m){return ce(m)&&re in m}function k(m,x){let H=x.split(".").slice(1);for(let w=0;w<H.length&&(m=m?.[H[w]])!==void 0;w++);return m}function q(m,x){let H,w;return new Proxy(m,ae());function ae(W=""){return{has(O,E){return E===re||E===Symbol.toPrimitive||E in O||E in x},set(O,E,L,R){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${W}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(O,E,R)!==L&&u({[re]:{a:m,path:W}}),Reflect.set(O,E,L,R)},deleteProperty(O,E){return Reflect.deleteProperty(O,E)?(u({[re]:{a:m,path:W}}),!0):!1},get(O,E,L){if(Object.hasOwn(x,E))return W.length?(H??(H=_(x,s=>C(s)?s[re]:{a:s,path:null})),_(H,(s,p)=>{let c=k(s.a,W);return p!==c||s.path===null||s.path.startsWith(W)?c:D},D,k(m,W))[E]):(w??(w=_(x,R=>C(R)?R[re].a:R)),w[E]);if(E==="valueOf")return()=>k(m,W);if(E===Symbol.toPrimitive)return function(R){return Reflect.has(O,E)?Reflect.get(O,E,O).call(O,R):R==="string"?O.toString():R==="number"?Number(O):O.valueOf()};if(typeof E=="string"&&(!(E in O)||Object.hasOwn(O,E))&&!(oe in O&&O[oe]==="shallow")){let R=Reflect.get(O,E,L);return typeof R=="function"||G(R)?R:new Proxy(Object(R),ae(W+"."+E))}return Reflect.get(O,E,L)}}}}}var J=new Promise(()=>{}),ye=(...e)=>{let t=new Array(e.length),r=new Array(e.length),a=()=>{a=()=>{};for(let n=0;n<e.length;n++){let i=e[n];r[n]=(t[n]=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i).next().then(d=>({idx:n,result:d}))}},o=[],h=r.length,u={[Symbol.asyncIterator](){return u},next(){return a(),h?Promise.race(r).then(({idx:n,result:i})=>i.done?(h--,r[n]=J,o[n]=i.value,u.next()):(r[n]=t[n]?t[n].next().then(d=>({idx:n,result:d})).catch(d=>({idx:n,result:{done:!0,value:d}})):Promise.resolve({idx:n,result:{done:!0,value:void 0}}),i)).catch(n=>u.throw?.(n)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:o})},async return(n){for(let i=0;i<t.length;i++)r[i]!==J&&(r[i]=J,o[i]=await t[i]?.return?.({done:!0,value:n}).then(d=>d.value,d=>d));return{done:!0,value:o}},async throw(n){for(let i=0;i<t.length;i++)r[i]!==J&&(r[i]=J,o[i]=await t[i]?.throw?.(n).then(d=>d.value,d=>d));return{done:!0,value:o}}};return Q(u)},je=(e,t={})=>{let r={},a,o=[],h=0,u={[Symbol.asyncIterator](){return u},next(){return a===void 0&&(a=Object.entries(e).map(([n,i],d)=>(h+=1,o[d]=i[Symbol.asyncIterator](),o[d].next().then(C=>({si:o,idx:d,k:n,ir:C}))))),function n(){return Promise.race(a).then(({idx:i,k:d,ir:C})=>C.done?(a[i]=J,h-=1,h?n():{done:!0,value:void 0}):(r[d]=C.value,a[i]=o[i].next().then(k=>({idx:i,k:d,ir:k})),t.ignorePartial&&Object.keys(r).length<Object.keys(e).length?n():{done:!1,value:r}))}()},return(n){return a.forEach((i,d)=>{i!==J&&o[d].return?.(n)}),Promise.resolve({done:!0,value:n})},throw(n){return a.forEach((i,d)=>{i!==J&&o[d].throw?.(n)}),Promise.reject({done:!0,value:n})}};return Q(u)};function Xe(e){return ue(e)&&Ie.every(t=>t in e&&e[t]===de[t])}function Q(e){return Xe(e)||be(e,de),e}function _e(e){return function(...t){let r=e(...t);return Q(r)}}async function Be(e){let t;for await(let r of this)t=e?.(r);await t}var D=Symbol("Ignore");function Ye(e,t,r){if(X(e))return e.then(t,r);try{return t(e)}catch(a){return r(a)}}function _(e,t,r=D,a=D){let o;function h(n){return o=u=null,a=D,{done:!0,value:n?.value}}let u={[Symbol.asyncIterator](){return u},next(...n){if(r!==D){let i=Promise.resolve({done:!1,value:r});return r=D,i}return new Promise(function i(d,C){o||(o=e[Symbol.asyncIterator]()),o.next(...n).then(k=>k.done?(a=D,d(k)):Ye(t(k.value,a),q=>q===D?i(d,C):d({done:!1,value:a=q}),q=>{a=D,o.throw?o.throw(q):o.return?.(q),C({done:!0,value:q})}),k=>{a=D,C({done:!0,value:k})}).catch(k=>{a=D,o.throw?o.throw(k):o.return?.(k),C({done:!0,value:k})})})},throw(n){return Promise.resolve(o?.throw?o.throw(n):o?.return?.(n)).then(h)},return(n){return Promise.resolve(o?.return?.(n)).then(h)}};return Q(u)}function Ze(e){return _(this,e)}function Je(e){return _(this,async t=>await e(t)?t:D)}function ze(e){return e?_(this,async(t,r)=>r===D||await e(t,r)?t:D):_(this,(t,r)=>t===r?D:t)}function et(e){return _(this,t=>t,e)}function tt(e){return _(this,t=>new Promise(r=>(e(()=>r(t)),t)))}function nt(){let e=this,t=0,r,a;function o(n){n&&r.resolve(n),n?.done?r=null:(r=Te(),a.next().then(o).catch(i=>{r.reject({done:!0,value:i}),r=null}))}function h(n){return a=u=r=null,{done:!0,value:n?.value}}let u={[Symbol.asyncIterator](){return t+=1,u},next(){return a||(a=e[Symbol.asyncIterator](),o()),r},throw(n){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:n}):Promise.resolve(a?.throw?a.throw(n):a?.return?.(n)).then(h)},return(n){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:n}):Promise.resolve(a?.return?.(n)).then(h)}};return Q(u)}function rt(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var z=new WeakMap;function ot(e){setTimeout(()=>st.call(this,e),1)}function st(e){z.has(this)||z.set(this,new Map);let t=z.get(this).get(e.type);if(t)for(let r of t)try{let{push:a,terminate:o,containerRef:h,selector:u,includeChildren:n}=r,i=h.deref();if(!i||!i.isConnected){let d="Container `#"+i?.id+">"+(u||"")+"` removed from DOM. Removing subscription";t.delete(r),o(new Error(d))}else if(e.target instanceof Node)if(u){let d=i.querySelectorAll(u);for(let C of d)(n?C.contains(e.target):e.target===C)&&i.contains(C)&&a(e)}else(n?i.contains(e.target):e.target===i)&&a(e)}catch(a){v.warn("docEventHandler",a)}}function Ae(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function He(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Se(e){let t=e.split(":");if(t.length===1)return Ae(t[0])?[He(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Ae(t[1])&&!Ae(t[0]))return[He(t[1]),t[0]]}function at(e){throw new Error(e)}function Ce(e,t){let[{includeChildren:r,selector:a},o]=Se(t)??at("Invalid WhenSelector: "+t);z.has(e.ownerDocument)||z.set(e.ownerDocument,new Map),z.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,ot,{passive:!0,capture:!0}),z.get(e.ownerDocument).set(o,new Set));let h=z.get(e.ownerDocument).get(o),u=Ee(()=>h.delete(n)),n={push:u.push,terminate(i){u.return?.(i)},containerRef:new WeakRef(e),includeChildren:r,selector:a};return Ke(e,a?[a]:void 0).then(i=>h.add(n)),u.multi()}async function*it(){return v.log("doneImmediately"),void 0}function Oe(e){function t(r){return e.map(r)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function lt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Se(e)}async function*ct(e){yield e}function me(e,...t){if(!t||t.length===0)return Oe(Ce(e,"change"));let r=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?Ce(e,o):o instanceof Element?Ce(o,"change"):X(o)?ct(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};r.push(o)}if(t.includes("@ready")){let o=t.filter(lt).map(d=>Se(d)?.[0]),h=d=>typeof d=="string"&&!e.querySelector(d),u=o.map(d=>d?.selector).filter(h),n,i={[Symbol.asyncIterator](){return i},throw(d){return n?.throw?n.throw(d):Promise.resolve({done:!0,value:d})},return(d){return n?.return?n.return(d):Promise.resolve({done:!0,value:d})},next(){return n?n.next():Ke(e,u).then(()=>(n=(r.length>1?ye(...r):r.length===1?r[0]:void 0)?.[Symbol.asyncIterator](),n?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Oe(Q(i))}let a=r.length>1?ye(...r):r.length===1?r[0]:it();return Oe(Q(a))}function Ke(e,t){function r(){if(e.isConnected)return Promise.resolve();let o=new Promise((h,u)=>new MutationObserver((n,i)=>{n.some(d=>d.addedNodes?.length)&&e.isConnected&&(i.disconnect(),h()),n.some(d=>[...d.removedNodes].some(C=>C===e||C.contains(e)))&&(i.disconnect(),u(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(S){let h=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),u=setTimeout(()=>{v.warn(h+`
`+e.outerHTML)},Y);o.finally(()=>clearTimeout(u))}return o}function a(o){if(o=o.filter(u=>!e.querySelector(u)),!o.length)return Promise.resolve();let h=new Promise(u=>new MutationObserver((n,i)=>{n.some(d=>d.addedNodes?.length)&&o.every(d=>e.querySelector(d))&&(i.disconnect(),u())}).observe(e,{subtree:!0,childList:!0}));if(S){let u=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",n=setTimeout(()=>{v.warn(u+o+`
`)},Y);h.finally(()=>clearTimeout(n))}return h}return t?.length?r().then(()=>a(t)):r()}var le=Symbol("callStack");var fe=Symbol("Unique ID"),Z=S?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},dt=0,ut=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function se(){throw new Error("<elt>.ids is a read-only map of Elements")}var Ue=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function We(e){return e in Ue?Ue[e]:e}function ge(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var Le=function(e,t,r){let[a,o,h]=typeof e=="string"||e===null?[e,t,r]:Array.isArray(e)?[null,e,t]:[null,ut,e],u=h?.commonProperties,n=h?.document??globalThis.document,i=yt(n,"removedNodes",h?.enableOnRemovedFromDOM);function d(s){return n.createComment(s?s.toString():S&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function C({error:s}){return n.createComment(s instanceof Error?s.toString():`Error:
`+JSON.stringify(s,null,2))}let k=n.createElement("STYLE");k.id="--ai-ui-extended-tag-styles-"+Date.now(),n.head.appendChild(k);let q=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...s){return me(this,...s)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(s){if(G(s)){let p=ie(s)?s:s[Symbol.asyncIterator](),c=()=>p.next().then(({done:l,value:g})=>{W(this,g),l||c()},l=>v.warn(l));c()}else W(this,s)}},ids:{configurable:!0,enumerable:!0,set:se,get(){let s=new Proxy(()=>{},{apply(p,c,l){try{return c.constructor.definition.ids[l[0].id](...l)}catch(g){throw new Error(`<elt>.ids.${l?.[0]?.id} is not a tag-creating function`,{cause:g})}},construct:se,defineProperty:se,deleteProperty:se,set:se,setPrototypeOf:se,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,c){if(this.get(p,c,null))return Reflect.getOwnPropertyDescriptor(p,We(c))},has(p,c){return!!this.get(p,c,null)},ownKeys:p=>{let c=[...this.querySelectorAll("[id]")].map(g=>g.id),l=[...new Set(c)];return S&&c.length!==l.length&&v.log("Element contains multiple, shadowed decendant ids",l),l},get:(p,c,l)=>{if(typeof c=="string"){let g=We(c);if(g in p){let P=p[g].deref();if(P&&P.id===c&&this.contains(P))return P;delete p[g]}let y;if(S){let P=this.querySelectorAll("#"+CSS.escape(c));P.length>1&&(q.has(c)||(q.add(c),v.log(`Element contains multiple, shadowed decendants with ID "${c}"`))),y=P[0]}else y=this.querySelector("#"+CSS.escape(c))??void 0;return y&&Reflect.set(p,g,new WeakRef(y),p),y}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:se,get(){return s}}),s}}});u&&w(m,u);function*x(...s){function p(c){return c==null||c===D}for(let c of s)if(!p(c)){if(X(c)){let l=d();c.then(g=>{l.replaceWith(...x(g)),l=void 0}),yield l;continue}if(c instanceof Node){yield c;continue}if(c&&typeof c=="object"&&Symbol.iterator in c&&!(Symbol.asyncIterator in c)&&c[Symbol.iterator]){for(let l of c)yield*x(l);continue}if(G(c)){let l=S?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",g=ie(c)?c:c[Symbol.asyncIterator](),y=!0,P=(T=!1)=>{if(!g||!f.nodes)return!0;if(T||f.nodes.every(I=>i.has(I))){let I="Element(s) have been removed from the document: "+f.nodes.map(Z).join(`
`)+l;return f.nodes=null,g.return?.(new Error(I)),g=null,!0}return!1},ee=c.valueOf(),f={nodes:ee===c||p(c)?[d()]:[...x(ee)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};i.removed(f.nodes,P);let b=S?(()=>{let T=Date.now()+Y,I=new Error("Created by").stack,N=()=>{y&&T&&T<Date.now()&&(N=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,I,f.nodes?.map(Z)))};return N})():null;(function T(){g.next().then(I=>{if(!I.done){if(!f.nodes){g?.throw?.(new Error("Already ternimated"));return}let N=f.nodes.filter(A=>A.isConnected),j=y?f.nodes:N;if(y&&N.length&&(y=!1),!P(!j.length)){b?.(),i.removed(f.nodes),f.nodes=[...x(ae(I.value))],i.removed(f.nodes,P),j[0].replaceWith(...f.nodes);for(let A=1;A<j.length;A++)f.nodes.includes(j[A])||j[A].remove();T()}}}).catch(I=>{let N=f.nodes?.filter(j=>!!j?.parentNode);N?.length?(N[0].replaceWith(C({error:I})),N.slice(1).forEach(j=>j?.remove())):v.warn("Can't report error",I,f.nodes?.map(Z)),i.removed(f.nodes??[]),f.nodes=null,g.return?.(I),g=null})})(),f.nodes&&(yield*f);continue}yield n.createTextNode(c.toString())}}a||Object.assign(Le,{nodes:x,UniqueID:fe});let H=Object.getPrototypeOf({});function w(s,p,c){if(!(p==null||typeof p!="object"||p===s))for(let[l,g]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in g){let y=g.value;y&&G(y)?Object.defineProperty(s,l,g):y&&typeof y=="object"&&!X(y)?l in s?y instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${l}' value: ${Z(y)} destination: ${s instanceof Node?Z(s):s}`),s[l]=y):s[l]!==y&&(Array.isArray(s[l])&&s[l].length!==y.length?y.constructor===Object||y.constructor===Array?w(s[l]=new y.constructor,y):s[l]=y:w(s[l],y)):(c&&(Object.getPrototypeOf(y)===H||!Object.getPrototypeOf(y)?w(g.value={},y):Array.isArray(y)?w(g.value=[],y):v.warn(`Declared propety '${l}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,s,y)),Object.defineProperty(s,l,g)):p[l]!==void 0&&(s[l]=p[l])}else Object.defineProperty(s,l,g)}catch(y){throw v.warn("deepAssign",l,p[l],y),y}}function ae(s){let p=s?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,ae):p}function W(s,p){le in p||function c(l,g){if(g==null||typeof g!="object")return;let y=Object.entries(Object.getOwnPropertyDescriptors(g));Array.isArray(g)||y.sort(f=>{let b=Object.getOwnPropertyDescriptor(l,f[0]);if(b){if("value"in b)return-1;if("set"in b||"get"in b)return 1}return 0});for(let[f,b]of y)try{if("value"in b){let T=b.value;G(T)?P(T,f):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?P(I,f):ee(I,f):g[f]!==void 0&&(l[f]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?ee(T,f):g[f]!==void 0&&(l[f]=g[f]))}else Object.defineProperty(l,f,b)}catch(T){throw v.warn("assignProps",f,g[f],T),T}function P(f,b){let T=ve(f),I=!0,N=Date.now()+Y,j=S&&new Error("Created by").stack,A=ne=>{if(!ne.done){let M=ae(ne.value);if(typeof M=="object"&&M!==null){let K=Object.getOwnPropertyDescriptor(l,b);b==="style"||!K?.set?c(l[b],M):l[b]=M}else M!==void 0&&(l[b]=M);let $=s.isConnected;if(i.has(s)||!I&&!$){v.info(`Element does not exist in document when setting async attribute '${b}' to:
${Z(s)}`),T.return?.();return}$&&(I=!1),I&&N&&N<Date.now()&&(N=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${b}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Z(s)}
${j}`)),T.next().then(A).catch(F)}},F=ne=>{v.warn("Dynamic attribute error",ne,b,l,j,Z(s)),T.return?.(ne),s.appendChild(C({error:ne}))},te=f.valueOf();te!==void 0&&te!==f&&!G(te)?A({done:!1,value:te}):T.next().then(A).catch(F)}function ee(f,b){if(f instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${b}' value: ${Z(f)} destination: ${s instanceof Node?Z(s):s}`),l[b]=f;else if(!(b in l)||l[b]===f||Array.isArray(l[b])&&l[b].length!==f.length)if(f.constructor===Object||f.constructor===Array){let T=new f.constructor;c(T,f),l[b]=T}else l[b]=f;else Object.getOwnPropertyDescriptor(l,b)?.set?l[b]=f:c(l[b],f)}}(s,p)}function O(s){for(let p=s.constructor;p;p=p.super)if(p===this)return!0;return!1}function E(s){let p=typeof s!="function"?b=>Object.assign({},s,b):s,c=Date.now().toString(36)+(dt++).toString(36)+Math.random().toString(36).slice(2),l=p({[fe]:c});l.styles&&k.appendChild(n.createTextNode(l.styles+`
`));let y=Object.assign((b,...T)=>{let I=ge(b),N=[],j={[le]:(I?N:b[le])??N},A=I?this(j,b,...T):this(j,...T);A.constructor=y;let F=p({[fe]:c});if(j[le].push(F),S){let M=function($,K){for(let U=$;U;U=U.super)if(U.definition?.declare&&K in U.definition.declare)return!0;return!1};var ne=M;if(F.declare){let $=Object.keys(F.declare).filter(K=>K in A||M(this,K));$.length&&v.log(`Declared keys '${$}' in ${y.name} already exist in base '${this.valueOf()}'`)}if(F.override){let $=Object.keys(F.override).filter(K=>!(K in A)&&!(u&&K in u)&&!M(this,K));$.length&&v.log(`Overridden keys '${$}' in ${y.name} do not exist in base '${this.valueOf()}'`)}}w(A,F.declare,!0),w(A,F.override);let te=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(M=>{M in A?(v.log(`Ignoring attempt to re-define iterable property "${M}" as it could already have consumers`),te.add(M)):xe(A,M,F.iterable[M])}),j[le]===N){I||W(A,b);for(let K of N){let U=K?.constructed?.call(A);ge(U)&&A.append(...x(U))}let M={},$=!1;for(let K of N)if(K.iterable)for(let U of Object.keys(K.iterable)){let we=!I&&U in b;if(te.has(U)&&we||!(we&&(!X(b[U])||!G(b[U])))){let De=A[U]?.valueOf();De!==void 0&&(M[U]=De,$=!0)}}$&&Object.assign(A,M)}return A},{super:this,definition:Object.assign(l,{[fe]:c}),extended:E,valueOf:()=>{let b=[...Object.keys(l.declare||{}),...Object.keys(l.iterable||{})];return`${y.name}: {${b.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(y,Symbol.hasInstance,{value:O,writable:!0,configurable:!0});let P={};(function b(T){T?.super&&b(T.super);let I=T.definition;I&&(w(P,I?.override),w(P,I?.declare))})(this),w(P,l.override),w(P,l.declare),Object.defineProperties(y,Object.getOwnPropertyDescriptors(P));let ee=P&&"className"in P&&typeof P.className=="string"?P.className:c,f=S?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(y,"name",{value:"<ai-"+ee.replace(/\s+/g,"-")+f+">"}),S){let b=Object.keys(l).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));b.length&&v.log(`${y.name} defines extraneous keys '${b}', which are unknown`)}return y}let L={createElement(s,p,...c){return s===L.createElement?x(...c):typeof s=="function"?s(p,c):typeof s=="string"&&s in L?L[s](p,c):s instanceof Node?s:C({error:new Error("Illegal type in createElement:"+s)})}};function R(s){if(L[s])return L[s];let p=(l,...g)=>{if(ge(l)&&(g.unshift(l),l={}),!ge(l)){if(l.debugger){debugger;delete l.debugger}let y=a?n.createElementNS(a,s.toLowerCase()):n.createElement(s);return y.constructor=p,w(y,m),W(y,l),y.append(...x(...g)),y}},c=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${a||""}${a?"::":""}${s}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:O,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+s+">"}),L[s]=c}return o.forEach(R),L};function yt(e,t,r){let a=new WeakSet,o=new WeakMap;function h(u){for(let n of u)if(t==="addedNodes"===n.isConnected){h(n.childNodes),a.add(n);let i=o.get(n);i&&(o.delete(n),i()),r&&"onRemovedFromDOM"in n&&typeof n.onRemovedFromDOM=="function"&&n.onRemovedFromDOM()}}return new MutationObserver(u=>{u.forEach(function(n){n.type==="childList"&&n[t].length&&h(n[t])})}).observe(e,{subtree:!0,childList:!0}),{has(u){return a.has(u)},removed(u,n){n?u.forEach(i=>o.set(i,n)):u.forEach(i=>o.delete(i))}}}
