var Ue=Object.defineProperty;var We=(e,t)=>{for(var r in t)Ue(e,r,{get:t[r],enumerable:!0})};var S=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){S&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){S&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){S&&console.info("(AI-UI) INFO:",...e)}};var we=e=>{};function ge(){let e=we,t=we,r=new Promise((...l)=>[e,t]=l);if(r.resolve=e,r.reject=t,S){let l=new Error().stack;r.catch(s=>s instanceof Error||s?.value instanceof Error?v.log("Deferred rejection",s,"allocated at ",l):void 0)}return r}function ce(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return ce(e)&&"then"in e&&typeof e.then=="function"}var Re={};We(Re,{Ignore:()=>D,Iterability:()=>oe,asyncExtras:()=>de,asyncIterator:()=>Te,augmentGlobalAsyncGenerators:()=>Ze,combine:()=>Ne,debounceQueueIteratableIterator:()=>ke,defineIterableProperty:()=>ve,filterMap:()=>_,generatorHelpers:()=>$e,isAsyncIter:()=>G,isAsyncIterable:()=>ue,isAsyncIterator:()=>ie,iterableHelpers:()=>Q,merge:()=>ye,queueIteratableIterator:()=>Ie});var oe=Symbol("Iterability");function ie(e){return ce(e)&&"next"in e&&typeof e?.next=="function"}function ue(e){return ce(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return ue(e)||ie(e)}function Te(e){if(ie(e))return e;if(ue(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var de={filterMap(e,t=D){return _(this,e,t)},map:Ge,filter:Qe,unique:qe,waitFor:_e,multi:Ye,initially:Xe,consume:Me,merge(...e){return ye(this,...e)},combine(e){return Ne(Object.assign({_this:this},e))}},he=[...Object.getOwnPropertySymbols(de),...Object.keys(de)];function pe(e,t){let r=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let l of r)Object.defineProperty(e,l,{...Object.getOwnPropertyDescriptor(t,l),enumerable:!1});return e}var B=Symbol("pending"),V=Symbol("items");function De(e=()=>{}){let t={[B]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[B])return Promise.resolve({done:!0,value:void 0});let r=ge();return r.catch(l=>{}),t[B].unshift(r),r},return(r){let l={done:!0,value:void 0};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().resolve(l);t[V]=t[B]=null}return Promise.resolve(l)},throw(...r){let l={done:!0,value:r[0]};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().reject(l);t[V]=t[B]=null}return Promise.reject(l)},get length(){return t[V]?t[V].length:-1},push(r){return t[B]?(t[B].length?t[B].pop().resolve({done:!1,value:r}):t[V]?t[V].push({done:!1,value:r}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var fe=Symbol("inflight");function Le(e=()=>{}){let t=De(e);return t[fe]=new Set,t.push=function(r){if(!t[B])return!1;if(t[fe].has(r))return!0;if(t[B].length){t[fe].add(r);let l=t[B].pop();l.finally(()=>t[fe].delete(r)),l.resolve({done:!1,value:r})}else t[V]?t[V].find(l=>l.value===r)||t[V].push({done:!1,value:r}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ie=De,ke=Le,re=Symbol("_proxiedAsyncIterator");function ve(e,t,r){let l=()=>{l=()=>H;let m=ke(),x=m.multi(),H=x[Symbol.asyncIterator]();return h[Symbol.asyncIterator]=x[Symbol.asyncIterator],u=m.push,he.forEach(w=>h[w]=H[w]),re in n||pe(n,h),H};function s(m){return{[m]:function(...x){return l(),n[m].apply(this,x)}}[m]}let h={[Symbol.asyncIterator]:l};he.forEach(m=>h[m]=s(m)),typeof r=="object"&&r&&oe in r&&r[oe]==="shallow"&&(h[oe]=r[oe]);let u=m=>(l(),u(m)),n=d(r,h),a;return Object.defineProperty(e,t,{get(){return n},set(m){if(m!==n)if(ue(m)){if(a===m)return;a=m;let x=S?new Error:void 0;S&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Me.call(m,H=>{if(m!==a)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});u(H?.valueOf())}).catch(H=>v.info(H)).finally(()=>m===a&&(a=void 0));return}else a&&S&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),n=d(m,h);u(m?.valueOf())},enumerable:!0}),e;function d(m,x){if(m==null)return pe(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),x);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return pe(Object(m),Object.assign(x,{toJSON(){return m.valueOf()}}));case"object":return q(m,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function C(m){return ce(m)&&re in m}function k(m,x){let H=x.split(".").slice(1);for(let w=0;w<H.length&&(m=m?.[H[w]])!==void 0;w++);return m}function q(m,x){let H,w;return new Proxy(m,ae());function ae(W=""){return{has(O,E){return E===re||E===Symbol.toPrimitive||E in O||E in x},set(O,E,L,R){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${W}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(O,E,R)!==L&&u({[re]:{a:m,path:W}}),Reflect.set(O,E,L,R)},deleteProperty(O,E){return Reflect.deleteProperty(O,E)?(u({[re]:{a:m,path:W}}),!0):!1},get(O,E,L){if(Object.hasOwn(x,E))return W.length?(H??(H=_(x,o=>C(o)?o[re]:{a:o,path:null})),_(H,(o,p)=>{let c=k(o.a,W);return p!==c||o.path===null||o.path.startsWith(W)?c:D},D,k(m,W))[E]):(w??(w=_(x,R=>C(R)?R[re].a:R)),w[E]);if(E==="valueOf")return()=>k(m,W);if(E===Symbol.toPrimitive)return function(R){return Reflect.has(O,E)?Reflect.get(O,E,O).call(O,R):R==="string"?O.toString():R==="number"?Number(O):O.valueOf()};if(typeof E=="string"&&(!(E in O)||Object.hasOwn(O,E))&&!(oe in O&&O[oe]==="shallow")){let R=Reflect.get(O,E,L);return typeof R=="function"||G(R)?R:new Proxy(Object(R),ae(W+"."+E))}return Reflect.get(O,E,L)}}}}}var J=new Promise(()=>{}),ye=(...e)=>{let t=new Array(e.length),r=new Array(e.length),l=()=>{l=()=>{};for(let n=0;n<e.length;n++){let a=e[n];r[n]=(t[n]=Symbol.asyncIterator in a?a[Symbol.asyncIterator]():a).next().then(d=>({idx:n,result:d}))}},s=[],h=r.length,u={[Symbol.asyncIterator](){return u},next(){return l(),h?Promise.race(r).then(({idx:n,result:a})=>a.done?(h--,r[n]=J,s[n]=a.value,u.next()):(r[n]=t[n]?t[n].next().then(d=>({idx:n,result:d})).catch(d=>({idx:n,result:{done:!0,value:d}})):Promise.resolve({idx:n,result:{done:!0,value:void 0}}),a)).catch(n=>u.throw?.(n)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:s})},async return(n){for(let a=0;a<t.length;a++)r[a]!==J&&(r[a]=J,s[a]=await t[a]?.return?.({done:!0,value:n}).then(d=>d.value,d=>d));return{done:!0,value:s}},async throw(n){for(let a=0;a<t.length;a++)r[a]!==J&&(r[a]=J,s[a]=await t[a]?.throw?.(n).then(d=>d.value,d=>d));return{done:!0,value:s}}};return Q(u)},Ne=(e,t={})=>{let r={},l,s=[],h=0,u={[Symbol.asyncIterator](){return u},next(){return l===void 0&&(l=Object.entries(e).map(([n,a],d)=>(h+=1,s[d]=a[Symbol.asyncIterator](),s[d].next().then(C=>({si:s,idx:d,k:n,ir:C}))))),function n(){return Promise.race(l).then(({idx:a,k:d,ir:C})=>C.done?(l[a]=J,h-=1,h?n():{done:!0,value:void 0}):(r[d]=C.value,l[a]=s[a].next().then(k=>({idx:a,k:d,ir:k})),t.ignorePartial&&Object.keys(r).length<Object.keys(e).length?n():{done:!1,value:r}))}()},return(n){return l.forEach((a,d)=>{a!==J&&s[d].return?.(n)}),Promise.resolve({done:!0,value:n})},throw(n){return l.forEach((a,d)=>{a!==J&&s[d].throw?.(n)}),Promise.reject({done:!0,value:n})}};return Q(u)};function Fe(e){return ue(e)&&he.every(t=>t in e&&e[t]===de[t])}function Q(e){return Fe(e)||pe(e,de),e}function $e(e){return function(...t){let r=e(...t);return Q(r)}}async function Me(e){let t;for await(let r of this)t=e?.(r);await t}var D=Symbol("Ignore");function Ve(e,t,r){if(X(e))return e.then(t,r);try{return t(e)}catch(l){return r(l)}}function _(e,t,r=D,l=D){let s;function h(n){return s=u=null,l=D,{done:!0,value:n?.value}}let u={[Symbol.asyncIterator](){return u},next(...n){if(r!==D){let a=Promise.resolve({done:!1,value:r});return r=D,a}return new Promise(function a(d,C){s||(s=e[Symbol.asyncIterator]()),s.next(...n).then(k=>k.done?(l=D,d(k)):Ve(t(k.value,l),q=>q===D?a(d,C):d({done:!1,value:l=q}),q=>{l=D,s.throw?s.throw(q):s.return?.(q),C({done:!0,value:q})}),k=>{l=D,C({done:!0,value:k})}).catch(k=>{l=D,s.throw?s.throw(k):s.return?.(k),C({done:!0,value:k})})})},throw(n){return Promise.resolve(s?.throw?s.throw(n):s?.return?.(n)).then(h)},return(n){return Promise.resolve(s?.return?.(n)).then(h)}};return Q(u)}function Ge(e){return _(this,e)}function Qe(e){return _(this,async t=>await e(t)?t:D)}function qe(e){return e?_(this,async(t,r)=>r===D||await e(t,r)?t:D):_(this,(t,r)=>t===r?D:t)}function Xe(e){return _(this,t=>t,e)}function _e(e){return _(this,t=>new Promise(r=>(e(()=>r(t)),t)))}function Ye(){let e=this,t=0,r,l;function s(n){n&&r.resolve(n),n?.done?r=null:(r=ge(),l.next().then(s).catch(a=>{r.reject({done:!0,value:a}),r=null}))}function h(n){return l=u=r=null,{done:!0,value:n?.value}}let u={[Symbol.asyncIterator](){return t+=1,u},next(){return l||(l=e[Symbol.asyncIterator](),s()),r},throw(n){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:n}):Promise.resolve(l?.throw?l.throw(n):l?.return?.(n)).then(h)},return(n){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:n}):Promise.resolve(l?.return?.(n)).then(h)}};return Q(u)}function Ze(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var z=new WeakMap;function Je(e){setTimeout(()=>ze.call(this,e),1)}function ze(e){z.has(this)||z.set(this,new Map);let t=z.get(this).get(e.type);if(t)for(let r of t)try{let{push:l,terminate:s,containerRef:h,selector:u,includeChildren:n}=r,a=h.deref();if(!a||!a.isConnected){let d="Container `#"+a?.id+">"+(u||"")+"` removed from DOM. Removing subscription";t.delete(r),s(new Error(d))}else if(e.target instanceof Node)if(u){let d=a.querySelectorAll(u);for(let C of d)(n?C.contains(e.target):e.target===C)&&a.contains(C)&&l(e)}else(n?a.contains(e.target):e.target===a)&&l(e)}catch(l){v.warn("docEventHandler",l)}}function Ee(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function je(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Ae(e){let t=e.split(":");if(t.length===1)return Ee(t[0])?[je(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Ee(t[1])&&!Ee(t[0]))return[je(t[1]),t[0]]}function et(e){throw new Error(e)}function xe(e,t){let[{includeChildren:r,selector:l},s]=Ae(t)??et("Invalid WhenSelector: "+t);z.has(e.ownerDocument)||z.set(e.ownerDocument,new Map),z.get(e.ownerDocument).has(s)||(e.ownerDocument.addEventListener(s,Je,{passive:!0,capture:!0}),z.get(e.ownerDocument).set(s,new Set));let h=z.get(e.ownerDocument).get(s),u=Ie(()=>h.delete(n)),n={push:u.push,terminate(a){u.return?.(a)},containerRef:new WeakRef(e),includeChildren:r,selector:l};return Be(e,l?[l]:void 0).then(a=>h.add(n)),u.multi()}async function*tt(){return v.log("doneImmediately"),void 0}function Pe(e){function t(r){return e.map(r)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function nt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Ae(e)}async function*rt(e){yield e}function Ce(e,...t){if(!t||t.length===0)return Pe(xe(e,"change"));let r=t.filter(s=>typeof s!="string"||s[0]!=="@").map(s=>typeof s=="string"?xe(e,s):s instanceof Element?xe(s,"change"):X(s)?rt(s):s);if(t.includes("@start")){let s={[Symbol.asyncIterator]:()=>s,next(){return s.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};r.push(s)}if(t.includes("@ready")){let s=t.filter(nt).map(d=>Ae(d)?.[0]),h=d=>typeof d=="string"&&!e.querySelector(d),u=s.map(d=>d?.selector).filter(h),n,a={[Symbol.asyncIterator](){return a},throw(d){return n?.throw?n.throw(d):Promise.resolve({done:!0,value:d})},return(d){return n?.return?n.return(d):Promise.resolve({done:!0,value:d})},next(){return n?n.next():Be(e,u).then(()=>(n=(r.length>1?ye(...r):r.length===1?r[0]:void 0)?.[Symbol.asyncIterator](),n?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Pe(Q(a))}let l=r.length>1?ye(...r):r.length===1?r[0]:tt();return Pe(Q(l))}function Be(e,t){function r(){if(e.isConnected)return Promise.resolve();let s=new Promise((h,u)=>new MutationObserver((n,a)=>{n.some(d=>d.addedNodes?.length)&&e.isConnected&&(a.disconnect(),h()),n.some(d=>[...d.removedNodes].some(C=>C===e||C.contains(e)))&&(a.disconnect(),u(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(S){let h=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),u=setTimeout(()=>{v.warn(h+`
`+e.outerHTML)},Y);s.finally(()=>clearTimeout(u))}return s}function l(s){if(s=s.filter(u=>!e.querySelector(u)),!s.length)return Promise.resolve();let h=new Promise(u=>new MutationObserver((n,a)=>{n.some(d=>d.addedNodes?.length)&&s.every(d=>e.querySelector(d))&&(a.disconnect(),u())}).observe(e,{subtree:!0,childList:!0}));if(S){let u=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",n=setTimeout(()=>{v.warn(u+s+`
`)},Y);h.finally(()=>clearTimeout(n))}return h}return t?.length?r().then(()=>l(t)):r()}var le=Symbol("callStack");var be=Symbol("Unique ID"),Z=S?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},ot=0,st=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function se(){throw new Error("<elt>.ids is a read-only map of Elements")}var He=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function Ke(e){return e in He?He[e]:e}function me(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var at=function(e,t,r){let[l,s,h]=typeof e=="string"||e===null?[e,t,r]:Array.isArray(e)?[null,e,t]:[null,st,e],u=h?.commonProperties,n=h?.document??globalThis.document,a=it(n,"removedNodes",h?.enableOnRemovedFromDOM);function d(o){return n.createComment(o?o.toString():S&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function C({error:o}){return n.createComment(o instanceof Error?o.toString():`Error:
`+JSON.stringify(o,null,2))}let k=n.createElement("STYLE");k.id="--ai-ui-extended-tag-styles-"+Date.now(),n.head.appendChild(k);let q=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...o){return Ce(this,...o)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(o){if(G(o)){let p=ie(o)?o:o[Symbol.asyncIterator](),c=()=>p.next().then(({done:i,value:g})=>{W(this,g),i||c()},i=>v.warn(i));c()}else W(this,o)}},ids:{configurable:!0,enumerable:!0,set:se,get(){let o=new Proxy(()=>{},{apply(p,c,i){try{return c.constructor.definition.ids[i[0].id](...i)}catch(g){throw new Error(`<elt>.ids.${i?.[0]?.id} is not a tag-creating function`,{cause:g})}},construct:se,defineProperty:se,deleteProperty:se,set:se,setPrototypeOf:se,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,c){if(this.get(p,c,null))return Reflect.getOwnPropertyDescriptor(p,Ke(c))},has(p,c){return!!this.get(p,c,null)},ownKeys:p=>{let c=[...this.querySelectorAll("[id]")].map(g=>g.id),i=[...new Set(c)];return S&&c.length!==i.length&&v.log("Element contains multiple, shadowed decendant ids",i),i},get:(p,c,i)=>{if(typeof c=="string"){let g=Ke(c);if(g in p){let P=p[g].deref();if(P&&P.id===c&&this.contains(P))return P;delete p[g]}let y;if(S){let P=this.querySelectorAll("#"+CSS.escape(c));P.length>1&&(q.has(c)||(q.add(c),v.log(`Element contains multiple, shadowed decendants with ID "${c}"`))),y=P[0]}else y=this.querySelector("#"+CSS.escape(c))??void 0;return y&&Reflect.set(p,g,new WeakRef(y),p),y}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:se,get(){return o}}),o}}});u&&w(m,u);function*x(...o){function p(c){return c==null||c===D}for(let c of o)if(!p(c)){if(X(c)){let i=d();c.then(g=>{i.replaceWith(...x(g)),i=void 0}),yield i;continue}if(c instanceof Node){yield c;continue}if(c&&typeof c=="object"&&Symbol.iterator in c&&!(Symbol.asyncIterator in c)&&c[Symbol.iterator]){for(let i of c)yield*x(i);continue}if(G(c)){let i=S?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",g=ie(c)?c:c[Symbol.asyncIterator](),y=!0,P=(T=!1)=>{if(!g||!f.nodes)return!0;if(T||f.nodes.every(I=>a.has(I))){let I="Element(s) have been removed from the document: "+f.nodes.map(Z).join(`
`)+i;return f.nodes=null,g.return?.(new Error(I)),g=null,!0}return!1},ee=c.valueOf(),f={nodes:ee===c||p(c)?[d()]:[...x(ee)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};a.removed(f.nodes,P);let b=S?(()=>{let T=Date.now()+Y,I=new Error("Created by").stack,N=()=>{y&&T&&T<Date.now()&&(N=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,I,f.nodes?.map(Z)))};return N})():null;(function T(){g.next().then(I=>{if(!I.done){if(!f.nodes){g?.throw?.(new Error("Already ternimated"));return}let N=f.nodes.filter(A=>A.isConnected),j=y?f.nodes:N;if(y&&N.length&&(y=!1),!P(!j.length)){b?.(),a.removed(f.nodes),f.nodes=[...x(ae(I.value))],a.removed(f.nodes,P),j[0].replaceWith(...f.nodes);for(let A=1;A<j.length;A++)f.nodes.includes(j[A])||j[A].remove();T()}}}).catch(I=>{let N=f.nodes?.filter(j=>!!j?.parentNode);N?.length?(N[0].replaceWith(C({error:I})),N.slice(1).forEach(j=>j?.remove())):v.warn("Can't report error",I,f.nodes?.map(Z)),a.removed(f.nodes??[]),f.nodes=null,g.return?.(I),g=null})})(),f.nodes&&(yield*f);continue}yield n.createTextNode(c.toString())}}l||Object.assign(at,{nodes:x,UniqueID:be});let H=Object.getPrototypeOf({});function w(o,p,c){if(!(p==null||typeof p!="object"||p===o))for(let[i,g]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in g){let y=g.value;y&&G(y)?Object.defineProperty(o,i,g):y&&typeof y=="object"&&!X(y)?i in o?y instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${i}' value: ${Z(y)} destination: ${o instanceof Node?Z(o):o}`),o[i]=y):o[i]!==y&&(Array.isArray(o[i])&&o[i].length!==y.length?y.constructor===Object||y.constructor===Array?w(o[i]=new y.constructor,y):o[i]=y:w(o[i],y)):(c&&(Object.getPrototypeOf(y)===H||!Object.getPrototypeOf(y)?w(g.value={},y):Array.isArray(y)?w(g.value=[],y):v.warn(`Declared propety '${i}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,o,y)),Object.defineProperty(o,i,g)):p[i]!==void 0&&(o[i]=p[i])}else Object.defineProperty(o,i,g)}catch(y){throw v.warn("deepAssign",i,p[i],y),y}}function ae(o){let p=o?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,ae):p}function W(o,p){le in p||function c(i,g){if(g==null||typeof g!="object")return;let y=Object.entries(Object.getOwnPropertyDescriptors(g));Array.isArray(g)||y.sort(f=>{let b=Object.getOwnPropertyDescriptor(i,f[0]);if(b){if("value"in b)return-1;if("set"in b||"get"in b)return 1}return 0});for(let[f,b]of y)try{if("value"in b){let T=b.value;G(T)?P(T,f):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?P(I,f):ee(I,f):g[f]!==void 0&&(i[f]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?ee(T,f):g[f]!==void 0&&(i[f]=g[f]))}else Object.defineProperty(i,f,b)}catch(T){throw v.warn("assignProps",f,g[f],T),T}function P(f,b){let T=Te(f),I=!0,N=Date.now()+Y,j=S&&new Error("Created by").stack,A=ne=>{if(!ne.done){let M=ae(ne.value);if(typeof M=="object"&&M!==null){let K=Object.getOwnPropertyDescriptor(i,b);b==="style"||!K?.set?c(i[b],M):i[b]=M}else M!==void 0&&(i[b]=M);let $=o.isConnected;if(a.has(o)||!I&&!$){v.info(`Element does not exist in document when setting async attribute '${b}' to:
${Z(o)}`),T.return?.();return}$&&(I=!1),I&&N&&N<Date.now()&&(N=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${b}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Z(o)}
${j}`)),T.next().then(A).catch(F)}},F=ne=>{v.warn("Dynamic attribute error",ne,b,i,j,Z(o)),T.return?.(ne),o.appendChild(C({error:ne}))},te=f.valueOf();te!==void 0&&te!==f&&!G(te)?A({done:!1,value:te}):T.next().then(A).catch(F)}function ee(f,b){if(f instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${b}' value: ${Z(f)} destination: ${o instanceof Node?Z(o):o}`),i[b]=f;else if(!(b in i)||i[b]===f||Array.isArray(i[b])&&i[b].length!==f.length)if(f.constructor===Object||f.constructor===Array){let T=new f.constructor;c(T,f),i[b]=T}else i[b]=f;else Object.getOwnPropertyDescriptor(i,b)?.set?i[b]=f:c(i[b],f)}}(o,p)}function O(o){for(let p=o.constructor;p;p=p.super)if(p===this)return!0;return!1}function E(o){let p=typeof o!="function"?b=>Object.assign({},o,b):o,c=Date.now().toString(36)+(ot++).toString(36)+Math.random().toString(36).slice(2),i=p({[be]:c});i.styles&&k.appendChild(n.createTextNode(i.styles+`
`));let y=Object.assign((b,...T)=>{let I=me(b),N=[],j={[le]:(I?N:b[le])??N},A=I?this(j,b,...T):this(j,...T);A.constructor=y;let F=p({[be]:c});if(j[le].push(F),S){let M=function($,K){for(let U=$;U;U=U.super)if(U.definition?.declare&&K in U.definition.declare)return!0;return!1};var ne=M;if(F.declare){let $=Object.keys(F.declare).filter(K=>K in A||M(this,K));$.length&&v.log(`Declared keys '${$}' in ${y.name} already exist in base '${this.valueOf()}'`)}if(F.override){let $=Object.keys(F.override).filter(K=>!(K in A)&&!(u&&K in u)&&!M(this,K));$.length&&v.log(`Overridden keys '${$}' in ${y.name} do not exist in base '${this.valueOf()}'`)}}w(A,F.declare,!0),w(A,F.override);let te=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(M=>{M in A?(v.log(`Ignoring attempt to re-define iterable property "${M}" as it could already have consumers`),te.add(M)):ve(A,M,F.iterable[M])}),j[le]===N){I||W(A,b);for(let K of N){let U=K?.constructed?.call(A);me(U)&&A.append(...x(U))}let M={},$=!1;for(let K of N)if(K.iterable)for(let U of Object.keys(K.iterable)){let Oe=!I&&U in b;if(te.has(U)&&Oe||!(Oe&&(!X(b[U])||!G(b[U])))){let Se=A[U]?.valueOf();Se!==void 0&&(M[U]=Se,$=!0)}}$&&Object.assign(A,M)}return A},{super:this,definition:Object.assign(i,{[be]:c}),extended:E,valueOf:()=>{let b=[...Object.keys(i.declare||{}),...Object.keys(i.iterable||{})];return`${y.name}: {${b.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(y,Symbol.hasInstance,{value:O,writable:!0,configurable:!0});let P={};(function b(T){T?.super&&b(T.super);let I=T.definition;I&&(w(P,I?.override),w(P,I?.declare))})(this),w(P,i.override),w(P,i.declare),Object.defineProperties(y,Object.getOwnPropertyDescriptors(P));let ee=P&&"className"in P&&typeof P.className=="string"?P.className:c,f=S?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(y,"name",{value:"<ai-"+ee.replace(/\s+/g,"-")+f+">"}),S){let b=Object.keys(i).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));b.length&&v.log(`${y.name} defines extraneous keys '${b}', which are unknown`)}return y}let L={createElement(o,p,...c){return o===L.createElement?x(...c):typeof o=="function"?o(p,c):typeof o=="string"&&o in L?L[o](p,c):o instanceof Node?o:C({error:new Error("Illegal type in createElement:"+o)})}};function R(o){if(L[o])return L[o];let p=(i,...g)=>{if(me(i)&&(g.unshift(i),i={}),!me(i)){if(i.debugger){debugger;delete i.debugger}let y=l?n.createElementNS(l,o.toLowerCase()):n.createElement(o);return y.constructor=p,w(y,m),W(y,i),y.append(...x(...g)),y}},c=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${l||""}${l?"::":""}${o}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:O,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+o+">"}),L[o]=c}return s.forEach(R),L};function it(e,t,r){let l=new WeakSet,s=new WeakMap;function h(u){for(let n of u)if(t==="addedNodes"===n.isConnected){h(n.childNodes),l.add(n);let a=s.get(n);a&&(s.delete(n),a()),r&&"onRemovedFromDOM"in n&&typeof n.onRemovedFromDOM=="function"&&n.onRemovedFromDOM()}}return new MutationObserver(u=>{u.forEach(function(n){n.type==="childList"&&n[t].length&&h(n[t])})}).observe(e,{subtree:!0,childList:!0}),{has(u){return l.has(u)},removed(u,n){n?u.forEach(a=>s.set(a,n)):u.forEach(a=>s.delete(a))}}}export{Re as Iterators,be as UniqueID,at as tag,Ce as when};
