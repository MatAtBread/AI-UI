var Ve=Object.defineProperty;var _e=(e,t)=>{for(var n in t)Ve(e,n,{get:t[n],enumerable:!0})};var O=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){O&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){O&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){O&&console.info("(AI-UI) INFO:",...e)}};var Ge=Symbol("deferredPromiseID"),we=e=>{},Qe=1;function ge(){let e=we,t=we,n=new Promise((...l)=>[e,t]=l);if(n.resolve=e,n.reject=t,O){n[Ge]=Qe++;let l=new Error().stack;n.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",l):void 0)}return n}function ie(e){return e&&typeof e=="object"||typeof e=="function"}function V(e){return ie(e)&&"then"in e&&typeof e.then=="function"}var Be={};_e(Be,{Ignore:()=>N,Iterability:()=>te,asyncExtras:()=>le,asyncIterator:()=>ce,augmentGlobalAsyncGenerators:()=>st,combine:()=>Me,debounceQueueIteratableIterator:()=>Re,defineIterableProperty:()=>Te,filterMap:()=>X,generatorHelpers:()=>Ye,isAsyncIter:()=>G,iterableHelpers:()=>Q,merge:()=>de,once:()=>Ze,queueIteratableIterator:()=>Ie});var te=Symbol("Iterability");function ke(e){return ie(e)&&"next"in e&&typeof e?.next=="function"}function ye(e){return ie(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return ye(e)||ke(e)}function ce(e){if(ke(e))return e;if(ye(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var le={filterMap(e,t=N){return X(this,e,t)},map:ze,filter:et,unique:tt,waitFor:rt,multi:ot,initially:nt,consume:je,merge(...e){return de(this,...e)},combine(e,t={}){let n=Object.assign({_this:this},e);return Me(n,t)}},he=[...Object.getOwnPropertySymbols(le),...Object.keys(le)],De=Symbol("IteratorCallSite");function fe(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let l of n)Object.defineProperty(e,l,{...Object.getOwnPropertyDescriptor(t,l),enumerable:!1});return O&&(De in e||Object.defineProperty(e,De,{value:new Error().stack})),e}var H=Symbol("pending"),_=Symbol("items");function Ne(e=()=>{}){let t={[H]:[],[_]:[],[Symbol.asyncIterator](){return t},next(){if(t[_]?.length)return Promise.resolve(t[_].shift());if(!t[H])return Promise.resolve({done:!0,value:void 0});let n=ge();return n.catch(l=>{}),t[H].unshift(n),n},return(n){let l={done:!0,value:void 0};if(t[H]){try{e()}catch{}for(;t[H].length;)t[H].pop().resolve(l);t[_]=t[H]=null}return Promise.resolve(l)},throw(...n){let l={done:!0,value:n[0]};if(t[H]){try{e()}catch{}for(;t[H].length;)t[H].pop().reject(l.value);t[_]=t[H]=null}return Promise.resolve(l)},get length(){return t[_]?t[_].length:-1},push(n){return t[H]?(t[H].length?t[H].pop().resolve({done:!1,value:n}):t[_]?t[_].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var ue=Symbol("inflight");function qe(e=()=>{}){let t=Ne(e);return t[ue]=new Set,t.push=function(n){if(!t[H])return!1;if(t[ue].has(n))return!0;if(t[H].length){t[ue].add(n);let l=t[H].pop();l.finally(()=>t[ue].delete(n)),l.resolve({done:!1,value:n})}else t[_]?t[_].find(l=>l.value===n)||t[_].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ie=Ne,Re=qe,ee=Symbol("_proxiedAsyncIterator");function Te(e,t,n){let l=()=>{l=()=>$;let m=Re(),A=m.multi(),$=A[Symbol.asyncIterator]();return d[Symbol.asyncIterator]=A[Symbol.asyncIterator],a=m.push,he.forEach(k=>d[k]=$[k]),ee in r||fe(r,d),$};function o(m){return{[m]:function(...A){return l(),r[m].apply(this,A)}}[m]}let d={[Symbol.asyncIterator]:l};he.forEach(m=>d[m]=o(m)),typeof n=="object"&&n&&te in n&&n[te]==="shallow"&&(d[te]=n[te]);let a=m=>(l(),a(m)),r=g(n,d),c;return Object.defineProperty(e,t,{get(){return r},set(m){if(m!==r)if(ye(m)){if(c===m)return;c=m;let A=O?new Error:void 0;O&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),je.call(m,$=>{if(m!==c)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:A});a($?.valueOf())}).catch($=>v.info($)).finally(()=>m===c&&(c=void 0));return}else c&&O&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=g(m,d);a(m?.valueOf())},enumerable:!0}),e;function g(m,A){if(m==null)return fe(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),A);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return fe(Object(m),Object.assign(A,{toJSON(){return m.valueOf()}}));case"function":case"object":return j(m,A)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function x(m){return ie(m)&&ee in m}function R(m,A){let $=A.split(".").slice(1);for(let k=0;k<$.length&&(m=m?.[$[k]])!==void 0;k++);return m}function j(m,A){let $,k;return new Proxy(m,re());function re(L=""){return{has(w,E){return E===ee||E===Symbol.toPrimitive||E in w||E in A},set(w,E,oe,D){if(Object.hasOwn(A,E))throw new Error(`Cannot set ${t.toString()}${L}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(w,E,D)!==oe&&a({[ee]:{a:m,path:L}}),Reflect.set(w,E,oe,D)},deleteProperty(w,E){return Reflect.deleteProperty(w,E)?(a({[ee]:{a:m,path:L}}),!0):!1},get(w,E,oe){if(Object.hasOwn(A,E))return L.length?($??($=X(A,Z=>x(Z)?Z[ee]:{a:Z,path:null})),X($,(Z,i)=>{let p=R(Z.a,L);return i!==p||Z.path===null||Z.path.startsWith(L)?p:N},N,R(m,L))[E]):(k??(k=X(A,D=>x(D)?D[ee].a:D)),k[E]);if(E==="valueOf"||E==="toJSON"&&!("toJSON"in w))return()=>R(m,L);if(E===Symbol.toPrimitive)return function(D){return Reflect.has(w,E)?Reflect.get(w,E,w).call(w,D):D==="string"?w.toString():D==="number"?Number(w):w.valueOf()};if(typeof E=="string"&&(!(E in w)||Object.hasOwn(w,E))&&!(te in w&&w[te]==="shallow")){let D=Reflect.get(w,E,oe);return typeof D=="function"||G(D)?D:new Proxy(Object(D),re(L+"."+E))}return Reflect.get(w,E,oe)}}}}}var de=(...e)=>{let t=new Map,n=new Map,l=()=>{l=()=>{};for(let a=0;a<e.length;a++){let r=e[a],c=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r;t.set(a,c),n.set(a,c.next().then(g=>({key:a,result:g})))}},o=new Array(e.length),d={[Symbol.asyncIterator](){return{__proto__:d,next(){return l(),n.size?Promise.race(n.values()).then(({key:a,result:r})=>r.done?(n.delete(a),t.delete(a),o[a]=r.value,this.next()):(n.set(a,t.has(a)?t.get(a).next().then(c=>({key:a,result:c})).catch(c=>({key:a,result:{done:!0,value:c}})):Promise.resolve({key:a,result:{done:!0,value:void 0}})),r)).catch(a=>this.throw(a)):Promise.resolve({done:!0,value:o})},async return(a){for(let r of t.keys())n.has(r)&&(n.delete(r),o[r]=await t.get(r)?.return?.({done:!0,value:a}).then(c=>c.value,c=>c));return{done:!0,value:o}},async throw(a){for(let r of t.keys())n.has(r)&&(n.delete(r),o[r]=await t.get(r)?.throw?.(a).then(c=>c.value,c=>c));return{done:!0,value:o}}}}};return Q(d)},Me=(e,t={})=>{let n=t.initially?t.initially:{},l=new Map,o,d={[Symbol.asyncIterator](){return{__proto__:d,next(){return o===void 0&&(o=new Map(Object.entries(e).map(([a,r])=>{let c=r[Symbol.asyncIterator]();return l.set(a,c),[a,c.next().then(g=>({si:l,k:a,ir:g}))]}))),(function a(){return Promise.race(o.values()).then(({k:r,ir:c})=>c.done?(o.delete(r),l.delete(r),o.size?a():{done:!0,value:void 0}):(n[r]=c.value,o.set(r,l.get(r).next().then(g=>({k:r,ir:g}))),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?a():{done:!1,value:n}))})()},return(a){for(let r of l.values())r.return?.(a);return Promise.resolve({done:!0,value:a})},throw(a){for(let r of l.values())r.throw?.(a);return Promise.resolve({done:!0,value:a})}}}};return Q(d)};function Xe(e){return ye(e)&&he.every(t=>t in e&&e[t]===le[t])}function Q(e){return Xe(e)||fe(e,le),e}function Ye(e){return function(...t){let n=e(...t);return Q(n)}}async function je(e){let t;for await(let n of this)t=e?.(n);await t}var N=Symbol("Ignore");async function*Ze(e){yield e}function Je(e,t,n){if(V(e))return e.then(t,n);try{return t(e)}catch(l){return n(l)}}function X(e,t,n=N,l=N){let o;function d(r){return o=a=null,l=N,{done:!0,value:r?.value}}let a={[Symbol.asyncIterator](){return{__proto__:a,next(...r){if(n!==N)if(V(n)){let c=n.then(g=>({done:!1,value:g}));return n=N,c}else{let c=Promise.resolve({done:!1,value:n});return n=N,c}return new Promise(function c(g,x){o||(o=e[Symbol.asyncIterator]()),o.next(...r).then(R=>R.done?(l=N,g(R)):Je(t(R.value,l),j=>j===N?c(g,x):g({done:!1,value:l=j}),j=>{l=N;let m=o?.throw?.(j)??o?.return?.(j);V(m)?m.then(x,x):x({done:!0,value:j})}),R=>{l=N,x({done:!0,value:R})}).catch(R=>{l=N;let j=o.throw?.(R)??o.return?.(R);V(j)?j.then(x,x):x({done:!0,value:j})})})},throw(r){return Promise.resolve(o?.throw?.(r)??o?.return?.(r)).then(d,d)},return(r){return Promise.resolve(o?.return?.(r)).then(d,d)}}}};return Q(a)}function ze(e){return X(this,e)}function et(e){return X(this,async t=>await e(t)?t:N)}function tt(e){return e?X(this,async(t,n)=>n===N||await e(t,n)?t:N):X(this,(t,n)=>t===n?N:t)}function nt(e){return X(this,t=>t,e)}function rt(e){return X(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function ot(){let e=this,t=new Set,n,l;function o(r){r&&n?.resolve(r),r?.done?n=null:(n=ge(),l?l.next().then(o).catch(c=>{n?.reject({done:!0,value:c}),n=null}):n.resolve({done:!0,value:void 0}))}function d(r){let c={done:!0,value:r?.value};return l=a=n=null,c}let a={[Symbol.asyncIterator](){return{__proto__:a,next(){return l||(l=e[Symbol.asyncIterator](),o()),t.add(this),n},throw(r){if(!t.has(this))throw new Error("AsyncIterator protocol error");return t.delete(this),t.size?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.throw?.(r)??l?.return?.(r)).then(d,d)},return(r){if(!t.has(this))throw new Error("AsyncIterator protocol error");return t.delete(this),t.size?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.return?.(r)).then(d,d)}}}};return Q(a)}function st(){let e=(async function*(){})();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var He=Object.freeze({}),J=new WeakMap;function at(e){J.has(this)||J.set(this,new Map);let t=J.get(this).get(e.type);if(t){let n=e.target;for(;n instanceof Node;){let l=t.get(n);if(l)for(let o of l)try{let{push:d,terminate:a,containerRef:r,selector:c,includeChildren:g}=o,x=r.deref();if(!x||!x.isConnected){let R="Container `#"+x?.id+">"+(c||"")+"` removed from DOM. Removing subscription";l.delete(o),a(new Error(R))}else if(c){let R=x.querySelectorAll(c);for(let j of R)(g?j.contains(e.target):e.target===j)&&x.contains(j)&&d(e)}else(g?x.contains(e.target):e.target===x)&&d(e)}catch(d){v.warn("docEventHandler",d)}if(n===this)break;n=n.parentNode}}}function xe(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function Ue(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Pe(e){let t=e.split(":");if(t.length===1)return xe(t[0])?[Ue(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&xe(t[1])&&!xe(t[0]))return[Ue(t[1]),t[0]]}function it(e){throw new Error(e)}function ve(e,t){let[{includeChildren:n,selector:l},o]=Pe(t)??it("Invalid WhenSelector: "+t);J.has(e.ownerDocument)||J.set(e.ownerDocument,new Map),J.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,at,{passive:!0,capture:!0}),J.get(e.ownerDocument).set(o,new Map));let d=J.get(e.ownerDocument).get(o);d.has(e)||d.set(e,new Set);let a=d.get(e),r=Ie(()=>a.delete(c)),c={push:r.push,terminate(g){r.return?.(g)},containerRef:new WeakRef(e),includeChildren:n,selector:l};return We(e,l?[l]:void 0).then(g=>a.add(c)),r.multi()}async function*Ke(){return void 0}function Ee(e){function t(n){return e.map(n)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function lt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Pe(e)}async function*ct(e){yield e}function Se(e,...t){if(!t||t.length===0)return Ee(ve(e,"change"));let n=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?ve(e,o):o instanceof Element?ve(o,"change"):V(o)?ct(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(o)}if(t.includes("@ready")){let o=t.filter(lt).map(g=>Pe(g)?.[0]),d=g=>typeof g=="string"&&!e.querySelector(g),a=o.map(g=>g?.selector).filter(d),r,c={[Symbol.asyncIterator](){return c},throw(g){return r?.throw?r.throw(g):Promise.resolve({done:!0,value:g})},return(g){return r?.return?r.return(g):Promise.resolve({done:!0,value:g})},next(){return r?r.next():We(e,a).then(()=>(r=(n.length>1?de(...n):n.length===1?n[0]:Ke())[Symbol.asyncIterator](),{done:!1,value:He}))}};return Ee(Q(c))}let l=n.length>1?de(...n):n.length===1?n[0]:Ke();return Ee(Q(l))}function We(e,t){function n(){if(e.isConnected)return Promise.resolve();let o=new Promise((d,a)=>new MutationObserver((r,c)=>{r.some(g=>g.addedNodes?.length)&&e.isConnected&&(c.disconnect(),d()),r.some(g=>[...g.removedNodes].some(x=>x===e||x.contains(e)))&&(c.disconnect(),a(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(O){let d=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),a=setTimeout(()=>{v.warn(d+`
`+e.outerHTML)},Y);o.finally(()=>clearTimeout(a))}return o}function l(o){if(o=o.filter(a=>!e.querySelector(a)),!o.length)return Promise.resolve();let d=new Promise(a=>new MutationObserver((r,c)=>{r.some(g=>g.addedNodes?.length)&&o.every(g=>e.querySelector(g))&&(c.disconnect(),a())}).observe(e,{subtree:!0,childList:!0}));if(O){let a=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(a+o+`
`)},Y);d.finally(()=>clearTimeout(r))}return d}return t?.length?n().then(()=>l(t)):n()}var se=Symbol("callStack");var pe=Symbol("Unique ID"),be=Symbol("trackNodes"),$e=Symbol("onRemovalFromDOM"),Ae="--ai-ui-extended-tag-styles",q=O?(e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e)):e=>{},dt=0,ut=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function ne(){throw new Error("<elt>.ids is a read-only map of Elements")}var Le=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function Fe(e){return e in Le?Le[e]:e}function me(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||V(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var ft=function(e,t,n){let[l,o,d]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,ut,e],a=d?.commonProperties,r=d?.document??globalThis.document,c=r.documentURI==="about:testing",g=d?.ErrorTag||function({error:p}){return r.createComment(p instanceof Error?p.toString():`Error:
`+JSON.stringify(p,null,2))},x=yt(r);function R(i){return r.createComment(i?i.toString():O&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}document.getElementById(Ae)||r.head.appendChild(Object.assign(r.createElement("STYLE"),{id:Ae}));let j=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...i){return Se(this,...i)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(i){if(G(i)){let p=ce(i),f=()=>p.next().then(({done:s,value:I})=>{L(this,I),s||f()},s=>v.warn(s));f()}else L(this,i)}},ids:{configurable:!0,enumerable:!0,set:ne,get(){let i=new Proxy((()=>{}),{apply(p,f,s){try{return f.constructor.definition.ids[s[0].id](...s)}catch(I){throw new Error(`<elt>.ids.${s?.[0]?.id} is not a tag-creating function`,{cause:I})}},construct:ne,defineProperty:ne,deleteProperty:ne,set:ne,setPrototypeOf:ne,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,f){if(this.get(p,f,null))return Reflect.getOwnPropertyDescriptor(p,Fe(f))},has(p,f){return!!this.get(p,f,null)},ownKeys:p=>{let f=[...this.querySelectorAll("[id]")].map(I=>I.id),s=[...new Set(f)];return O&&f.length!==s.length&&v.log("Element contains multiple, shadowed decendant ids",s),s},get:(p,f,s)=>{if(typeof f=="string"){let I=Fe(f);if(I in p){let T=p[I].deref();if(T&&T.id===f&&this.contains(T))return T;delete p[I]}let u;if(O){let T=this.querySelectorAll("#"+CSS.escape(f));T.length>1&&(j.has(f)||(j.add(f),v.log(`Element contains multiple, shadowed decendants with ID "${f}"`))),u=T[0]}else u=this.querySelector("#"+CSS.escape(f))??void 0;return u&&Reflect.set(p,I,new WeakRef(u),p),u}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:ne,get(){return i}}),i}}});d?.enableOnRemovedFromDOM&&Object.defineProperty(m,"onRemovedFromDOM",{configurable:!0,enumerable:!1,set:function(i){x.onRemoval([this],$e,i)},get:function(){x.getRemovalHandler(this,$e)}}),a&&k(m,a);function*A(...i){function p(f){return f==null||f===N}for(let f of i)if(!p(f)){if(V(f)){let s=[R()];f.then(I=>{let u=s;if(u){s=[...A(I)],x.onRemoval(s,be,()=>{s=void 0});for(let T=0;T<u.length;T++)T===0?u[T].replaceWith(...s):u[T].remove()}}),s&&(yield*s);continue}if(f instanceof Node){yield f;continue}if(f&&typeof f=="object"&&Symbol.iterator in f&&!(Symbol.asyncIterator in f)&&f[Symbol.iterator]){for(let s of f)yield*A(s);continue}if(G(f)){let s=O?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",I=ce(f),u=!0,T=(b=!1)=>{if(!I||!P.nodes)return!0;if(b||P.nodes.every(h=>x.has(h))){P.nodes?.forEach(S=>x.add(S));let h="Element(s) have been removed from the document: "+P.nodes.map(q).join(`
`)+s;return P.nodes=null,I.return?.(new Error(h)),I=null,!0}return!1},z=f.valueOf(),P={nodes:z===f?[]:[...A(z)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};P.nodes.length||(P.nodes=[R()]),x.onRemoval(P.nodes,be,T);let y=O?(()=>{let b=Date.now()+Y,h=new Error("Created by").stack,S=()=>{u&&b&&b<Date.now()&&(S=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,h,P.nodes?.map(q)))};return S})():null;(function b(){I.next().then(h=>{if(!h.done){if(!P.nodes){I?.throw?.(new Error("Already ternimated"));return}let S=P.nodes.filter(C=>C.isConnected),B=u?P.nodes:S;if(u&&S.length&&(u=!1),!T(!B.length)){y?.(),x.onRemoval(P.nodes,be),P.nodes=[...A(re(h.value))],P.nodes.length||(P.nodes=[R()]),x.onRemoval(P.nodes,be,T);for(let C=0;C<B.length;C++)C===0?B[0].replaceWith(...P.nodes):P.nodes.includes(B[C])||B[C].remove(),x.add(B[C]);b()}}}).catch(h=>{let S=P.nodes?.filter(B=>!!B?.parentNode);S?.length?(S[0].replaceWith(g({error:h?.value??h})),S.slice(1).forEach(B=>B?.remove())):v.warn("Can't report error",h,P.nodes?.map(q)),P.nodes=null,I=null})})(),P.nodes&&(yield*P);continue}yield r.createTextNode(f.toString())}}l||Object.assign(ft,{nodes:A,UniqueID:pe});let $=Object.getPrototypeOf({});function k(i,p,f){if(!(p==null||typeof p!="object"||p===i))for(let[s,I]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in I){let u=I.value;u&&G(u)?Object.defineProperty(i,s,I):u&&typeof u=="object"&&!V(u)?s in i?u instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${s}' value: ${q(u)} destination: ${i instanceof Node?q(i):i}`),i[s]=u):i[s]!==u&&(Array.isArray(i[s])&&i[s].length!==u.length?u.constructor===Object||u.constructor===Array?k(i[s]=new u.constructor,u):i[s]=u:k(i[s],u)):(f&&(Object.getPrototypeOf(u)===$||!Object.getPrototypeOf(u)?k(I.value={},u):Array.isArray(u)?k(I.value=[],u):v.warn(`Declared propety '${s}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,i,u)),Object.defineProperty(i,s,I)):p[s]!==void 0&&(i[s]=p[s])}else Object.defineProperty(i,s,I)}catch(u){throw v.warn("deepAssign",s,p[s],u),u}}function re(i){if(i===null)return null;let p=i?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,re):p}function L(i,p){se in p||(function f(s,I){if(I==null||typeof I!="object")return;let u=Object.entries(Object.getOwnPropertyDescriptors(I));Array.isArray(I)||u.sort(y=>{let b=Object.getOwnPropertyDescriptor(s,y[0]);if(b){if("value"in b)return-1;if("set"in b||"get"in b)return 1}return 0});let T=c||!(s instanceof Element)||s instanceof HTMLElement?(y,b)=>{s[y]=b}:(y,b)=>{(b===null||typeof b=="number"||typeof b=="boolean"||typeof b=="string")&&(!(y in s)||typeof s[y]!="string")?s.setAttribute(y==="className"?"class":y,String(b)):s[y]=b};for(let[y,b]of u)try{if("value"in b){let h=b.value;G(h)?z(h,y):V(h)?h.then(S=>{x.has(i)||(S&&typeof S=="object"?G(S)?z(S,y):P(S,y):I[y]!==void 0&&T(y,S))},S=>v.log(`Exception in promised attribute '${y}'`,S,q(s))):G(h)||(h&&typeof h=="object"&&!V(h)?P(h,y):I[y]!==void 0&&T(y,I[y]))}else Object.defineProperty(s,y,b)}catch(h){throw v.warn("assignProps",y,I[y],h),h}function z(y,b){let h=ce(y),S=Date.now()+Y,B=O&&new Error("Created by").stack,C=!1,F=U=>{if(!U.done){if(C=C||i.isConnected,x.has(i))return;let M=re(U.value);if(typeof M=="object"&&M!==null){let K=Object.getOwnPropertyDescriptor(s,b);b==="style"||!K?.set?f(s[b],M):T(b,M)}else M!==void 0&&T(b,M);O&&!C&&S<Date.now()&&(S=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${b}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${q(i)}
${B}`)),h.next().then(F).catch(ae)}},ae=U=>{U&&(v.warn("Dynamic attribute termination",U,b,q(s),B,q(i)),i.appendChild(g({error:U})))},W=y.valueOf();W!==void 0&&W!==y&&!G(W)?F({done:!1,value:W}):h.next().then(F).catch(ae),x.onRemoval([i],b,()=>{h.return?.(),h=null})}function P(y,b){if(y instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${b}' value: ${q(y)} destination: ${i instanceof Node?q(i):i}`),T(b,y);else if(!(b in s)||s[b]===y||Array.isArray(s[b])&&s[b].length!==y.length)if(y.constructor===Object||y.constructor===Array){let h=new y.constructor;f(h,y),T(b,h)}else T(b,y);else Object.getOwnPropertyDescriptor(s,b)?.set?T(b,y):f(s[b],y)}})(i,p)}function w(i){for(let p=i.constructor;p;p=p.super)if(p===this)return!0;return!1}function E(i){let p=typeof i!="function"?y=>Object.assign({},i,y):i,f=Date.now().toString(36)+(dt++).toString(36)+Math.random().toString(36).slice(2),s=p({[pe]:f});s.styles&&document.getElementById(Ae)?.appendChild(r.createTextNode(s.styles+`
`));let u=Object.assign((y,...b)=>{let h=me(y),S=[],B={[se]:(h?S:y[se])??S},C=h?this(B,y,...b):this(B,...b);C.constructor=u;let F=p({[pe]:f});if(B[se].push(F),O){let W=(U,M)=>{for(let K=U;K;K=K.super)if(K.definition?.declare&&M in K.definition.declare)return!0;return!1};if(F.declare){let U=Object.keys(F.declare).filter(M=>M in C||W(this,M));U.length&&v.log(`Declared keys '${U}' in ${u.name} already exist in base '${this.valueOf()}'`)}if(F.override){let U=Object.keys(F.override).filter(M=>!(M in C)&&!(a&&M in a)&&!W(this,M));U.length&&v.log(`Overridden keys '${U}' in ${u.name} do not exist in base '${this.valueOf()}'`)}}k(C,F.declare,!0),k(C,F.override);let ae=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(W=>{W in C?(v.log(`Ignoring attempt to re-define iterable property "${W}" as it could already have consumers`),ae.add(W)):Te(C,W,F.iterable[W])}),B[se]===S){h||L(C,y);for(let M of S){let K=M?.constructed?.call(C);me(K)&&C.append(...A(K))}let W={},U=!1;for(let M of S)if(M.iterable)for(let K of Object.keys(M.iterable)){let Ce=!h&&K in y;if(ae.has(K)&&Ce||!(Ce&&(!V(y[K])||!G(y[K])))){let Oe=C[K]?.valueOf();Oe!==void 0&&(W[K]=Oe,U=!0)}}U&&Object.assign(C,W)}return C},{super:this,definition:Object.assign(s,{[pe]:f}),extended:E,valueOf:()=>{let y=[...Object.keys(s.declare||{}),...Object.keys(s.iterable||{})];return`${u.name}: {${y.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(u,Symbol.hasInstance,{value:w,writable:!0,configurable:!0});let T={};(function y(b){b?.super&&y(b.super);let h=b.definition;h&&(k(T,h?.override),k(T,h?.declare))})(this),k(T,s.override),k(T,s.declare),Object.defineProperties(u,Object.getOwnPropertyDescriptors(T));let z=T&&"className"in T&&typeof T.className=="string"?T.className:f,P=O?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(u,"name",{value:"<ai-"+z.replace(/\s+/g,"-")+P+">"}),O){let y=Object.keys(s).filter(b=>!["styles","ids","constructed","declare","override","iterable"].includes(b));y.length&&v.log(`${u.name} defines extraneous keys '${y}', which are unknown`)}return u}let D={createElement:(i,p,...f)=>i instanceof Node?i:typeof i=="string"&&i in D?D[i](p,f):i===D.createElement?[...A(...f)]:typeof i=="function"?i(p,f):g({error:new Error("Illegal type in createElement:"+i)})};function Z(i){if(D[i])return D[i];let p=(s,...I)=>{if(me(s)&&(I.unshift(s),s={}),!me(s)){if(s.debugger){debugger;delete s.debugger}let u=l?r.createElementNS(l,i.toLowerCase()):r.createElement(i);return u.constructor=p,k(u,m),L(u,s),u.append(...A(...I)),u}},f=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${l||""}${l?"::":""}${i}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:w,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+i+">"}),D[i]=f}return o.forEach(Z),D};function yt(e){let t=new WeakSet,n=new WeakMap;function l(o){for(let d of o)if(!d.isConnected){t.add(d),l(d.childNodes);let a=n.get(d);if(a){n.delete(d);for(let[r,c]of a?.entries())try{c.call(d)}catch{v.info("Ignored exception handling node removal",r,c,q(d))}}}}return new MutationObserver(o=>{o.forEach(function(d){d.type==="childList"&&d.removedNodes.length&&l(d.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(o){return t.has(o)},add(o){return t.add(o)},getRemovalHandler(o,d){return n.get(o)?.get(d)},onRemoval(o,d,a){a?o.forEach(r=>{let c=n.get(r)??new Map;n.set(r,c),c.set(d,a)}):o.forEach(r=>{let c=n.get(r);c&&(c.delete(d),c.size||n.delete(r))})}}}export{Be as Iterators,He as Ready,pe as UniqueID,ft as tag,Se as when};
