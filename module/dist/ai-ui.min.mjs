var Ue=Object.defineProperty;var Le=(e,t)=>{for(var n in t)Ue(e,n,{get:t[n],enumerable:!0})};var O=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Z=5e3,v={log(...e){O&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){O&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){O&&console.info("(AI-UI) INFO:",...e)}};var we=e=>{};function ge(){let e=we,t=we,n=new Promise((...l)=>[e,t]=l);if(n.resolve=e,n.reject=t,O){let l=new Error().stack;n.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",l):void 0)}return n}function le(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return le(e)&&"then"in e&&typeof e.then=="function"}var Me={};Le(Me,{Ignore:()=>N,Iterability:()=>re,asyncExtras:()=>ce,asyncIterator:()=>Te,augmentGlobalAsyncGenerators:()=>Je,combine:()=>Ne,debounceQueueIteratableIterator:()=>ke,defineIterableProperty:()=>ve,filterMap:()=>_,generatorHelpers:()=>Ve,isAsyncIter:()=>G,isAsyncIterable:()=>de,isAsyncIterator:()=>ae,iterableHelpers:()=>Q,merge:()=>ue,queueIteratableIterator:()=>Ie});var re=Symbol("Iterability");function ae(e){return le(e)&&"next"in e&&typeof e?.next=="function"}function de(e){return le(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return de(e)||ae(e)}function Te(e){if(ae(e))return e;if(de(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var ce={filterMap(e,t=N){return _(this,e,t)},map:Qe,filter:qe,unique:Xe,waitFor:Ye,multi:Ze,initially:_e,consume:Re,merge(...e){return ue(this,...e)},combine(e){return Ne(Object.assign({_this:this},e))}},he=[...Object.getOwnPropertySymbols(ce),...Object.keys(ce)];function fe(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let l of n)Object.defineProperty(e,l,{...Object.getOwnPropertyDescriptor(t,l),enumerable:!1});return e}var K=Symbol("pending"),V=Symbol("items");function De(e=()=>{}){let t={[K]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[K])return Promise.resolve({done:!0,value:void 0});let n=ge();return n.catch(l=>{}),t[K].unshift(n),n},return(n){let l={done:!0,value:void 0};if(t[K]){try{e()}catch{}for(;t[K].length;)t[K].pop().resolve(l);t[V]=t[K]=null}return Promise.resolve(l)},throw(...n){let l={done:!0,value:n[0]};if(t[K]){try{e()}catch{}for(;t[K].length;)t[K].pop().reject(l);t[V]=t[K]=null}return Promise.reject(l)},get length(){return t[V]?t[V].length:-1},push(n){return t[K]?(t[K].length?t[K].pop().resolve({done:!1,value:n}):t[V]?t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var ye=Symbol("inflight");function Fe(e=()=>{}){let t=De(e);return t[ye]=new Set,t.push=function(n){if(!t[K])return!1;if(t[ye].has(n))return!0;if(t[K].length){t[ye].add(n);let l=t[K].pop();l.finally(()=>t[ye].delete(n)),l.resolve({done:!1,value:n})}else t[V]?t[V].find(l=>l.value===n)||t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ie=De,ke=Fe,ne=Symbol("_proxiedAsyncIterator");function ve(e,t,n){let l=()=>{l=()=>U;let m=ke(),x=m.multi(),U=x[Symbol.asyncIterator]();return y[Symbol.asyncIterator]=x[Symbol.asyncIterator],p=m.push,he.forEach(w=>y[w]=U[w]),ne in r||fe(r,y),U};function o(m){return{[m]:function(...x){return l(),r[m].apply(this,x)}}[m]}let y={[Symbol.asyncIterator]:l};he.forEach(m=>y[m]=o(m)),typeof n=="object"&&n&&re in n&&n[re]==="shallow"&&(y[re]=n[re]);let p=m=>(l(),p(m)),r=d(n,y),s;return Object.defineProperty(e,t,{get(){return r},set(m){if(m!==r)if(de(m)){if(s===m)return;s=m;let x=O?new Error:void 0;O&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Re.call(m,U=>{if(m!==s)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});p(U?.valueOf())}).catch(U=>v.info(U)).finally(()=>m===s&&(s=void 0));return}else s&&O&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=d(m,y);p(m?.valueOf())},enumerable:!0}),e;function d(m,x){if(m==null)return fe(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),x);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return fe(Object(m),Object.assign(x,{toJSON(){return m.valueOf()}}));case"object":return q(m,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function S(m){return le(m)&&ne in m}function R(m,x){let U=x.split(".").slice(1);for(let w=0;w<U.length&&(m=m?.[U[w]])!==void 0;w++);return m}function q(m,x){let U,w;return new Proxy(m,se());function se(L=""){return{has(C,E){return E===ne||E===Symbol.toPrimitive||E in C||E in x},set(C,E,$,j){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${L}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(C,E,j)!==$&&p({[ne]:{a:m,path:L}}),Reflect.set(C,E,$,j)},deleteProperty(C,E){return Reflect.deleteProperty(C,E)?(p({[ne]:{a:m,path:L}}),!0):!1},get(C,E,$){if(Object.hasOwn(x,E))return L.length?(U??(U=_(x,a=>S(a)?a[ne]:{a,path:null})),_(U,(a,b)=>{let c=R(a.a,L);return b!==c||a.path===null||a.path.startsWith(L)?c:N},N,R(m,L))[E]):(w??(w=_(x,j=>S(j)?j[ne].a:j)),w[E]);if(E==="valueOf")return()=>R(m,L);if(E===Symbol.toPrimitive)return function(j){return Reflect.has(C,E)?Reflect.get(C,E,C).call(C,j):j==="string"?C.toString():j==="number"?Number(C):C.valueOf()};if(typeof E=="string"&&(!(E in C)||Object.hasOwn(C,E))&&!(re in C&&C[re]==="shallow")){let j=Reflect.get(C,E,$);return typeof j=="function"||G(j)?j:new Proxy(Object(j),se(L+"."+E))}return Reflect.get(C,E,$)}}}}}var J=new Promise(()=>{}),ue=(...e)=>{let t=new Array(e.length),n=new Array(e.length),l=()=>{l=()=>{};for(let r=0;r<e.length;r++){let s=e[r];n[r]=(t[r]=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s).next().then(d=>({idx:r,result:d}))}},o=[],y=n.length,p={[Symbol.asyncIterator](){return p},next(){return l(),y?Promise.race(n).then(({idx:r,result:s})=>s.done?(y--,n[r]=J,o[r]=s.value,p.next()):(n[r]=t[r]?t[r].next().then(d=>({idx:r,result:d})).catch(d=>({idx:r,result:{done:!0,value:d}})):Promise.resolve({idx:r,result:{done:!0,value:void 0}}),s)).catch(r=>p.throw?.(r)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:o})},async return(r){for(let s=0;s<t.length;s++)n[s]!==J&&(n[s]=J,o[s]=await t[s]?.return?.({done:!0,value:r}).then(d=>d.value,d=>d));return{done:!0,value:o}},async throw(r){for(let s=0;s<t.length;s++)n[s]!==J&&(n[s]=J,o[s]=await t[s]?.throw?.(r).then(d=>d.value,d=>d));return{done:!0,value:o}}};return Q(p)},Ne=(e,t={})=>{let n={},l,o=[],y=0,p={[Symbol.asyncIterator](){return p},next(){return l===void 0&&(l=Object.entries(e).map(([r,s],d)=>(y+=1,o[d]=s[Symbol.asyncIterator](),o[d].next().then(S=>({si:o,idx:d,k:r,ir:S}))))),function r(){return Promise.race(l).then(({idx:s,k:d,ir:S})=>S.done?(l[s]=J,y-=1,y?r():{done:!0,value:void 0}):(n[d]=S.value,l[s]=o[s].next().then(R=>({idx:s,k:d,ir:R})),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?r():{done:!1,value:n}))}()},return(r){return l.forEach((s,d)=>{s!==J&&o[d].return?.(r)}),Promise.resolve({done:!0,value:r})},throw(r){return l.forEach((s,d)=>{s!==J&&o[d].throw?.(r)}),Promise.reject({done:!0,value:r})}};return Q(p)};function $e(e){return de(e)&&he.every(t=>t in e&&e[t]===ce[t])}function Q(e){return $e(e)||fe(e,ce),e}function Ve(e){return function(...t){let n=e(...t);return Q(n)}}async function Re(e){let t;for await(let n of this)t=e?.(n);await t}var N=Symbol("Ignore");function Ge(e,t,n){if(X(e))return e.then(t,n);try{return t(e)}catch(l){return n(l)}}function _(e,t,n=N,l=N){let o;function y(r){return o=p=null,l=N,{done:!0,value:r?.value}}let p={[Symbol.asyncIterator](){return p},next(...r){if(n!==N){let s=Promise.resolve({done:!1,value:n});return n=N,s}return new Promise(function s(d,S){o||(o=e[Symbol.asyncIterator]()),o.next(...r).then(R=>R.done?(l=N,d(R)):Ge(t(R.value,l),q=>q===N?s(d,S):d({done:!1,value:l=q}),q=>{l=N,o.throw?o.throw(q):o.return?.(q),S({done:!0,value:q})}),R=>{l=N,S({done:!0,value:R})}).catch(R=>{l=N,o.throw?o.throw(R):o.return?.(R),S({done:!0,value:R})})})},throw(r){return Promise.resolve(o?.throw?o.throw(r):o?.return?.(r)).then(y)},return(r){return Promise.resolve(o?.return?.(r)).then(y)}};return Q(p)}function Qe(e){return _(this,e)}function qe(e){return _(this,async t=>await e(t)?t:N)}function Xe(e){return e?_(this,async(t,n)=>n===N||await e(t,n)?t:N):_(this,(t,n)=>t===n?N:t)}function _e(e){return _(this,t=>t,e)}function Ye(e){return _(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function Ze(){let e=this,t=0,n,l;function o(r){r&&n.resolve(r),r?.done?n=null:(n=ge(),l.next().then(o).catch(s=>{n.reject({done:!0,value:s}),n=null}))}function y(r){return l=p=n=null,{done:!0,value:r?.value}}let p={[Symbol.asyncIterator](){return t+=1,p},next(){return l||(l=e[Symbol.asyncIterator](),o()),n},throw(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.throw?l.throw(r):l?.return?.(r)).then(y)},return(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.return?.(r)).then(y)}};return Q(p)}function Je(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var z=new WeakMap;function ze(e){setTimeout(()=>et.call(this,e),1)}function et(e){z.has(this)||z.set(this,new Map);let t=z.get(this).get(e.type);if(t)for(let n of t)try{let{push:l,terminate:o,containerRef:y,selector:p,includeChildren:r}=n,s=y.deref();if(!s||!s.isConnected){let d="Container `#"+s?.id+">"+(p||"")+"` removed from DOM. Removing subscription";t.delete(n),o(new Error(d))}else if(e.target instanceof Node)if(p){let d=s.querySelectorAll(p);for(let S of d)(r?S.contains(e.target):e.target===S)&&s.contains(S)&&l(e)}else(r?s.contains(e.target):e.target===s)&&l(e)}catch(l){v.warn("docEventHandler",l)}}function Ee(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function je(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Pe(e){let t=e.split(":");if(t.length===1)return Ee(t[0])?[je(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Ee(t[1])&&!Ee(t[0]))return[je(t[1]),t[0]]}function tt(e){throw new Error(e)}function xe(e,t){let[{includeChildren:n,selector:l},o]=Pe(t)??tt("Invalid WhenSelector: "+t);z.has(e.ownerDocument)||z.set(e.ownerDocument,new Map),z.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,ze,{passive:!0,capture:!0}),z.get(e.ownerDocument).set(o,new Set));let y=z.get(e.ownerDocument).get(o),p=Ie(()=>y.delete(r)),r={push:p.push,terminate(s){p.return?.(s)},containerRef:new WeakRef(e),includeChildren:n,selector:l};return Be(e,l?[l]:void 0).then(s=>y.add(r)),p.multi()}async function*nt(){return void 0}function Ae(e){function t(n){return e.map(n)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function rt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Pe(e)}async function*ot(e){yield e}function Se(e,...t){if(!t||t.length===0)return Ae(xe(e,"change"));let n=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?xe(e,o):o instanceof Element?xe(o,"change"):X(o)?ot(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(o)}if(t.includes("@ready")){let o=t.filter(rt).map(d=>Pe(d)?.[0]),y=d=>typeof d=="string"&&!e.querySelector(d),p=o.map(d=>d?.selector).filter(y),r,s={[Symbol.asyncIterator](){return s},throw(d){return r?.throw?r.throw(d):Promise.resolve({done:!0,value:d})},return(d){return r?.return?r.return(d):Promise.resolve({done:!0,value:d})},next(){return r?r.next():Be(e,p).then(()=>(r=(n.length>1?ue(...n):n.length===1?n[0]:void 0)?.[Symbol.asyncIterator](),r?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Ae(Q(s))}let l=n.length>1?ue(...n):n.length===1?n[0]:nt();return Ae(Q(l))}function Be(e,t){function n(){if(e.isConnected)return Promise.resolve();let o=new Promise((y,p)=>new MutationObserver((r,s)=>{r.some(d=>d.addedNodes?.length)&&e.isConnected&&(s.disconnect(),y()),r.some(d=>[...d.removedNodes].some(S=>S===e||S.contains(e)))&&(s.disconnect(),p(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(O){let y=new Error().stack?.replace(/^Error/,`Element not mounted after ${Z/1e3} seconds:`),p=setTimeout(()=>{v.warn(y+`
`+e.outerHTML)},Z);o.finally(()=>clearTimeout(p))}return o}function l(o){if(o=o.filter(p=>!e.querySelector(p)),!o.length)return Promise.resolve();let y=new Promise(p=>new MutationObserver((r,s)=>{r.some(d=>d.addedNodes?.length)&&o.every(d=>e.querySelector(d))&&(s.disconnect(),p())}).observe(e,{subtree:!0,childList:!0}));if(O){let p=new Error().stack?.replace(/^Error/,`Missing selectors after ${Z/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(p+o+`
`)},Z);y.finally(()=>clearTimeout(r))}return y}return t?.length?n().then(()=>l(t)):n()}var ie=Symbol("callStack");var pe=Symbol("Unique ID"),be=Symbol("trackNodes"),st=Symbol("tracAttributes"),He=Symbol("onRemovalFromDOM"),Y=O?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},at=0,it=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function oe(){throw new Error("<elt>.ids is a read-only map of Elements")}var Ke=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function We(e){return e in Ke?Ke[e]:e}function me(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var lt=function(e,t,n){let[l,o,y]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,it,e],p=y?.commonProperties,r=y?.document??globalThis.document,s=ct(r);function d(a){return r.createComment(a?a.toString():O&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function S({error:a}){return r.createComment(a instanceof Error?a.toString():`Error:
`+JSON.stringify(a,null,2))}let R="--ai-ui-extended-tag-styles";document.getElementById(R)||r.head.appendChild(Object.assign(r.createElement("STYLE"),{id:R}));let q=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...a){return Se(this,...a)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(a){if(G(a)){let b=ae(a)?a:a[Symbol.asyncIterator](),c=()=>b.next().then(({done:i,value:h})=>{L(this,h),i||c()},i=>v.warn(i));c()}else L(this,a)}},ids:{configurable:!0,enumerable:!0,set:oe,get(){let a=new Proxy(()=>{},{apply(b,c,i){try{return c.constructor.definition.ids[i[0].id](...i)}catch(h){throw new Error(`<elt>.ids.${i?.[0]?.id} is not a tag-creating function`,{cause:h})}},construct:oe,defineProperty:oe,deleteProperty:oe,set:oe,setPrototypeOf:oe,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(b,c){if(this.get(b,c,null))return Reflect.getOwnPropertyDescriptor(b,We(c))},has(b,c){return!!this.get(b,c,null)},ownKeys:b=>{let c=[...this.querySelectorAll("[id]")].map(h=>h.id),i=[...new Set(c)];return O&&c.length!==i.length&&v.log("Element contains multiple, shadowed decendant ids",i),i},get:(b,c,i)=>{if(typeof c=="string"){let h=We(c);if(h in b){let P=b[h].deref();if(P&&P.id===c&&this.contains(P))return P;delete b[h]}let f;if(O){let P=this.querySelectorAll("#"+CSS.escape(c));P.length>1&&(q.has(c)||(q.add(c),v.log(`Element contains multiple, shadowed decendants with ID "${c}"`))),f=P[0]}else f=this.querySelector("#"+CSS.escape(c))??void 0;return f&&Reflect.set(b,h,new WeakRef(f),b),f}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:oe,get(){return a}}),a}}});y?.enableOnRemovedFromDOM&&Object.defineProperty(m,"onRemovedFromDOM",{configurable:!0,enumerable:!1,set:function(a){s.onRemoval([this],He,a)},get:function(){s.getRemovalHandler(this,He)}}),p&&w(m,p);function*x(...a){function b(c){return c==null||c===N}for(let c of a)if(!b(c)){if(X(c)){let i=d();c.then(h=>{i.replaceWith(...x(h)),i=void 0}),yield i;continue}if(c instanceof Node){yield c;continue}if(c&&typeof c=="object"&&Symbol.iterator in c&&!(Symbol.asyncIterator in c)&&c[Symbol.iterator]){for(let i of c)yield*x(i);continue}if(G(c)){let i=O?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",h=ae(c)?c:c[Symbol.asyncIterator](),f=!0,P=(T=!1)=>{if(!h||!u.nodes)return!0;if(T||u.nodes.every(I=>s.has(I))){u.nodes?.forEach(D=>s.add(D));let I="Element(s) have been removed from the document: "+u.nodes.map(Y).join(`
`)+i;return u.nodes=null,h.return?.(new Error(I)),h=null,!0}return!1},ee=c.valueOf(),u={nodes:ee===c?[]:[...x(ee)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};u.nodes.length||(u.nodes=[d()]),s.onRemoval(u.nodes,be,P);let g=O?(()=>{let T=Date.now()+Z,I=new Error("Created by").stack,D=()=>{f&&T&&T<Date.now()&&(D=()=>{},v.warn(`Async element not mounted after ${Z/1e3} seconds. If it is never mounted, it will leak.`,I,u.nodes?.map(Y)))};return D})():null;(function T(){h.next().then(I=>{if(!I.done){if(!u.nodes){h?.throw?.(new Error("Already ternimated"));return}let D=u.nodes.filter(A=>A.isConnected),k=f?u.nodes:D;if(f&&D.length&&(f=!1),!P(!k.length)){g?.(),s.onRemoval(u.nodes,be),u.nodes=[...x(se(I.value))],u.nodes.length||(u.nodes=[d()]),s.onRemoval(u.nodes,be,P);for(let A=0;A<k.length;A++)A===0?k[0].replaceWith(...u.nodes):u.nodes.includes(k[A])||k[A].remove(),s.add(k[A]);T()}}}).catch(I=>{let D=u.nodes?.filter(k=>!!k?.parentNode);u.nodes?.forEach(k=>s.add(k)),D?.length?(D[0].replaceWith(S({error:I})),D.slice(1).forEach(k=>k?.remove())):v.warn("Can't report error",I,u.nodes?.map(Y)),u.nodes&&s.onRemoval(u.nodes,be),u.nodes=null,h.return?.(I),h=null})})(),u.nodes&&(yield*u);continue}yield r.createTextNode(c.toString())}}l||Object.assign(lt,{nodes:x,UniqueID:pe});let U=Object.getPrototypeOf({});function w(a,b,c){if(!(b==null||typeof b!="object"||b===a))for(let[i,h]of Object.entries(Object.getOwnPropertyDescriptors(b)))try{if("value"in h){let f=h.value;f&&G(f)?Object.defineProperty(a,i,h):f&&typeof f=="object"&&!X(f)?i in a?f instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${i}' value: ${Y(f)} destination: ${a instanceof Node?Y(a):a}`),a[i]=f):a[i]!==f&&(Array.isArray(a[i])&&a[i].length!==f.length?f.constructor===Object||f.constructor===Array?w(a[i]=new f.constructor,f):a[i]=f:w(a[i],f)):(c&&(Object.getPrototypeOf(f)===U||!Object.getPrototypeOf(f)?w(h.value={},f):Array.isArray(f)?w(h.value=[],f):v.warn(`Declared propety '${i}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,a,f)),Object.defineProperty(a,i,h)):b[i]!==void 0&&(a[i]=b[i])}else Object.defineProperty(a,i,h)}catch(f){throw v.warn("deepAssign",i,b[i],f),f}}function se(a){let b=a?.valueOf();return Array.isArray(b)?Array.prototype.map.call(b,se):b}function L(a,b){ie in b||function c(i,h){if(h==null||typeof h!="object")return;let f=Object.entries(Object.getOwnPropertyDescriptors(h));Array.isArray(h)||f.sort(u=>{let g=Object.getOwnPropertyDescriptor(i,u[0]);if(g){if("value"in g)return-1;if("set"in g||"get"in g)return 1}return 0});for(let[u,g]of f)try{if("value"in g){let T=g.value;G(T)?P(T,u):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?P(I,u):ee(I,u):h[u]!==void 0&&(i[u]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?ee(T,u):h[u]!==void 0&&(i[u]=h[u]))}else Object.defineProperty(i,u,g)}catch(T){throw v.warn("assignProps",u,h[u],T),T}function P(u,g){let T=Te(u),I=!0,D=Date.now()+Z,k=O&&new Error("Created by").stack,A=M=>{if(!M.done){let B=se(M.value);if(typeof B=="object"&&B!==null){let H=Object.getOwnPropertyDescriptor(i,g);g==="style"||!H?.set?c(i[g],B):i[g]=B}else B!==void 0&&(i[g]=B);let W=a.isConnected;if(s.has(a)||!I&&!W){v.info(`Element does not exist in document when setting async attribute '${g}' to:
${Y(a)}`),T.return?.();return}W&&(I=!1),I&&D&&D<Date.now()&&(D=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${g}' not mounted after ${Z/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Y(a)}
${k}`)),T.next().then(A).catch(F)}},F=M=>{T.return?.(M),M&&(v.warn("Dynamic attribute terminartion",M,g,i,k,Y(a)),a.appendChild(S({error:M})))},te=u.valueOf();te!==void 0&&te!==u&&!G(te)?A({done:!1,value:te}):T.next().then(A).catch(F),s.onRemoval([a],st,F)}function ee(u,g){if(u instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${g}' value: ${Y(u)} destination: ${a instanceof Node?Y(a):a}`),i[g]=u;else if(!(g in i)||i[g]===u||Array.isArray(i[g])&&i[g].length!==u.length)if(u.constructor===Object||u.constructor===Array){let T=new u.constructor;c(T,u),i[g]=T}else i[g]=u;else Object.getOwnPropertyDescriptor(i,g)?.set?i[g]=u:c(i[g],u)}}(a,b)}function C(a){for(let b=a.constructor;b;b=b.super)if(b===this)return!0;return!1}function E(a){let b=typeof a!="function"?g=>Object.assign({},a,g):a,c=Date.now().toString(36)+(at++).toString(36)+Math.random().toString(36).slice(2),i=b({[pe]:c});i.styles&&document.getElementById(R)?.appendChild(r.createTextNode(i.styles+`
`));let f=Object.assign((g,...T)=>{let I=me(g),D=[],k={[ie]:(I?D:g[ie])??D},A=I?this(k,g,...T):this(k,...T);A.constructor=f;let F=b({[pe]:c});if(k[ie].push(F),O){let M=(B,W)=>{for(let H=B;H;H=H.super)if(H.definition?.declare&&W in H.definition.declare)return!0;return!1};if(F.declare){let B=Object.keys(F.declare).filter(W=>W in A||M(this,W));B.length&&v.log(`Declared keys '${B}' in ${f.name} already exist in base '${this.valueOf()}'`)}if(F.override){let B=Object.keys(F.override).filter(W=>!(W in A)&&!(p&&W in p)&&!M(this,W));B.length&&v.log(`Overridden keys '${B}' in ${f.name} do not exist in base '${this.valueOf()}'`)}}w(A,F.declare,!0),w(A,F.override);let te=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(M=>{M in A?(v.log(`Ignoring attempt to re-define iterable property "${M}" as it could already have consumers`),te.add(M)):ve(A,M,F.iterable[M])}),k[ie]===D){I||L(A,g);for(let W of D){let H=W?.constructed?.call(A);me(H)&&A.append(...x(H))}let M={},B=!1;for(let W of D)if(W.iterable)for(let H of Object.keys(W.iterable)){let Ce=!I&&H in g;if(te.has(H)&&Ce||!(Ce&&(!X(g[H])||!G(g[H])))){let Oe=A[H]?.valueOf();Oe!==void 0&&(M[H]=Oe,B=!0)}}B&&Object.assign(A,M)}return A},{super:this,definition:Object.assign(i,{[pe]:c}),extended:E,valueOf:()=>{let g=[...Object.keys(i.declare||{}),...Object.keys(i.iterable||{})];return`${f.name}: {${g.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(f,Symbol.hasInstance,{value:C,writable:!0,configurable:!0});let P={};(function g(T){T?.super&&g(T.super);let I=T.definition;I&&(w(P,I?.override),w(P,I?.declare))})(this),w(P,i.override),w(P,i.declare),Object.defineProperties(f,Object.getOwnPropertyDescriptors(P));let ee=P&&"className"in P&&typeof P.className=="string"?P.className:c,u=O?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(f,"name",{value:"<ai-"+ee.replace(/\s+/g,"-")+u+">"}),O){let g=Object.keys(i).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));g.length&&v.log(`${f.name} defines extraneous keys '${g}', which are unknown`)}return f}let $={createElement(a,b,...c){return a===$.createElement?x(...c):typeof a=="function"?a(b,c):typeof a=="string"&&a in $?$[a](b,c):a instanceof Node?a:S({error:new Error("Illegal type in createElement:"+a)})}};function j(a){if($[a])return $[a];let b=(i,...h)=>{if(me(i)&&(h.unshift(i),i={}),!me(i)){if(i.debugger){debugger;delete i.debugger}let f=l?r.createElementNS(l,a.toLowerCase()):r.createElement(a);return f.constructor=b,w(f,m),L(f,i),f.append(...x(...h)),f}},c=Object.assign(b,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${l||""}${l?"::":""}${a}>`}});return Object.defineProperty(b,Symbol.hasInstance,{value:C,writable:!0,configurable:!0}),Object.defineProperty(b,"name",{value:"<"+a+">"}),$[a]=c}return o.forEach(j),$};function ct(e){let t=new WeakSet,n=new WeakMap;function l(o){for(let y of o)if(!y.isConnected){t.add(y),l(y.childNodes);let p=n.get(y);if(p){n.delete(y);for(let[r,s]of p?.entries())try{s.call(y)}catch{v.info("Ignored exception handling node removal",r,s,Y(y))}}}}return new MutationObserver(o=>{o.forEach(function(y){y.type==="childList"&&y.removedNodes.length&&l(y.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(o){return t.has(o)},add(o){return t.add(o)},getRemovalHandler(o,y){return n.get(o)?.get(y)},onRemoval(o,y,p){p?o.forEach(r=>{let s=n.get(r)??new Map;n.set(r,s),s.set(y,p)}):o.forEach(r=>{let s=n.get(r);s&&(s.delete(y),s.size||n.delete(r))})}}}export{Me as Iterators,pe as UniqueID,lt as tag,Se as when};
