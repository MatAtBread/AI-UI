var Fe=Object.defineProperty;var Ve=(e,t)=>{for(var n in t)Fe(e,n,{get:t[n],enumerable:!0})};var O=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){O&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){O&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){O&&console.info("(AI-UI) INFO:",...e)}};var Ge=Symbol("deferredPromiseID"),De=e=>{},Qe=1;function ge(){let e=De,t=De,n=new Promise((...l)=>[e,t]=l);if(n.resolve=e,n.reject=t,O){n[Ge]=Qe++;let l=new Error().stack;n.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",l):void 0)}return n}function le(e){return e&&typeof e=="object"||typeof e=="function"}function V(e){return le(e)&&"then"in e&&typeof e.then=="function"}var Be={};Ve(Be,{Ignore:()=>R,Iterability:()=>te,asyncExtras:()=>ce,asyncIterator:()=>Te,augmentGlobalAsyncGenerators:()=>rt,combine:()=>Me,debounceQueueIteratableIterator:()=>Re,defineIterableProperty:()=>ve,filterMap:()=>_,generatorHelpers:()=>_e,isAsyncIter:()=>Q,isAsyncIterable:()=>de,isAsyncIterator:()=>ae,iterableHelpers:()=>q,merge:()=>ue,queueIteratableIterator:()=>Ie});var te=Symbol("Iterability");function ae(e){return le(e)&&"next"in e&&typeof e?.next=="function"}function de(e){return le(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function Q(e){return de(e)||ae(e)}function Te(e){if(ae(e))return e;if(de(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var ce={filterMap(e,t=R){return _(this,e,t)},map:Ze,filter:Je,unique:ze,waitFor:tt,multi:nt,initially:et,consume:je,merge(...e){return ue(this,...e)},combine(e){return Me(Object.assign({_this:this},e))}},he=[...Object.getOwnPropertySymbols(ce),...Object.keys(ce)],ke=Symbol("IteratorCallSite");function fe(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let l of n)Object.defineProperty(e,l,{...Object.getOwnPropertyDescriptor(t,l),enumerable:!1});return O&&(ke in e||Object.defineProperty(e,ke,{value:new Error().stack})),e}var H=Symbol("pending"),G=Symbol("items");function Ne(e=()=>{}){let t={[H]:[],[G]:[],[Symbol.asyncIterator](){return t},next(){if(t[G]?.length)return Promise.resolve(t[G].shift());if(!t[H])return Promise.resolve({done:!0,value:void 0});let n=ge();return n.catch(l=>{}),t[H].unshift(n),n},return(n){let l={done:!0,value:void 0};if(t[H]){try{e()}catch{}for(;t[H].length;)t[H].pop().resolve(l);t[G]=t[H]=null}return Promise.resolve(l)},throw(...n){let l={done:!0,value:n[0]};if(t[H]){try{e()}catch{}for(;t[H].length;)t[H].pop().reject(l.value);t[G]=t[H]=null}return Promise.resolve(l)},get length(){return t[G]?t[G].length:-1},push(n){return t[H]?(t[H].length?t[H].pop().resolve({done:!1,value:n}):t[G]?t[G].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return q(t)}var ye=Symbol("inflight");function qe(e=()=>{}){let t=Ne(e);return t[ye]=new Set,t.push=function(n){if(!t[H])return!1;if(t[ye].has(n))return!0;if(t[H].length){t[ye].add(n);let l=t[H].pop();l.finally(()=>t[ye].delete(n)),l.resolve({done:!1,value:n})}else t[G]?t[G].find(l=>l.value===n)||t[G].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ie=Ne,Re=qe,ee=Symbol("_proxiedAsyncIterator");function ve(e,t,n){let l=()=>{l=()=>L;let m=Re(),S=m.multi(),L=S[Symbol.asyncIterator]();return d[Symbol.asyncIterator]=S[Symbol.asyncIterator],s=m.push,he.forEach(k=>d[k]=L[k]),ee in r||fe(r,d),L};function o(m){return{[m]:function(...S){return l(),r[m].apply(this,S)}}[m]}let d={[Symbol.asyncIterator]:l};he.forEach(m=>d[m]=o(m)),typeof n=="object"&&n&&te in n&&n[te]==="shallow"&&(d[te]=n[te]);let s=m=>(l(),s(m)),r=h(n,d),c;return Object.defineProperty(e,t,{get(){return r},set(m){if(m!==r)if(de(m)){if(c===m)return;c=m;let S=O?new Error:void 0;O&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),je.call(m,L=>{if(m!==c)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:S});s(L?.valueOf())}).catch(L=>v.info(L)).finally(()=>m===c&&(c=void 0));return}else c&&O&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=h(m,d);s(m?.valueOf())},enumerable:!0}),e;function h(m,S){if(m==null)return fe(Object.create(null,{valueOf:{value(){return m},writable:!0,configurable:!0},toJSON:{value(){return m},writable:!0,configurable:!0}}),S);switch(typeof m){case"bigint":case"boolean":case"number":case"string":return fe(Object(m),Object.assign(S,{toJSON(){return m.valueOf()}}));case"object":return K(m,S)}throw new TypeError('Iterable properties cannot be of type "'+typeof m+'"')}function x(m){return le(m)&&ee in m}function U(m,S){let L=S.split(".").slice(1);for(let k=0;k<L.length&&(m=m?.[L[k]])!==void 0;k++);return m}function K(m,S){let L,k;return new Proxy(m,re());function re($=""){return{has(D,A){return A===ee||A===Symbol.toPrimitive||A in D||A in S},set(D,A,oe,w){if(Object.hasOwn(S,A))throw new Error(`Cannot set ${t.toString()}${$}.${A.toString()} as it is part of asyncIterator`);return Reflect.get(D,A,w)!==oe&&s({[ee]:{a:m,path:$}}),Reflect.set(D,A,oe,w)},deleteProperty(D,A){return Reflect.deleteProperty(D,A)?(s({[ee]:{a:m,path:$}}),!0):!1},get(D,A,oe){if(Object.hasOwn(S,A))return $.length?(L??(L=_(S,Z=>x(Z)?Z[ee]:{a:Z,path:null})),_(L,(Z,i)=>{let p=U(Z.a,$);return i!==p||Z.path===null||Z.path.startsWith($)?p:R},R,U(m,$))[A]):(k??(k=_(S,w=>x(w)?w[ee].a:w)),k[A]);if(A==="valueOf")return()=>U(m,$);if(A===Symbol.toPrimitive)return function(w){return Reflect.has(D,A)?Reflect.get(D,A,D).call(D,w):w==="string"?D.toString():w==="number"?Number(D):D.valueOf()};if(typeof A=="string"&&(!(A in D)||Object.hasOwn(D,A))&&!(te in D&&D[te]==="shallow")){let w=Reflect.get(D,A,oe);return typeof w=="function"||Q(w)?w:new Proxy(Object(w),re($+"."+A))}return Reflect.get(D,A,oe)}}}}}var ue=(...e)=>{let t=new Map,n=new Map,l=()=>{l=()=>{};for(let s=0;s<e.length;s++){let r=e[s],c=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r;t.set(s,c),n.set(s,c.next().then(h=>({key:s,result:h})))}},o=new Array(e.length),d={[Symbol.asyncIterator](){return d},next(){return l(),n.size?Promise.race(n.values()).then(({key:s,result:r})=>r.done?(n.delete(s),t.delete(s),o[s]=r.value,d.next()):(n.set(s,t.has(s)?t.get(s).next().then(c=>({key:s,result:c})).catch(c=>({key:s,result:{done:!0,value:c}})):Promise.resolve({key:s,result:{done:!0,value:void 0}})),r)).catch(s=>d.throw(s)):Promise.resolve({done:!0,value:o})},async return(s){for(let r of t.keys())n.has(r)&&(n.delete(r),o[r]=await t.get(r)?.return?.({done:!0,value:s}).then(c=>c.value,c=>c));return{done:!0,value:o}},async throw(s){for(let r of t.keys())n.has(r)&&(n.delete(r),o[r]=await t.get(r)?.throw?.(s).then(c=>c.value,c=>c));return{done:!0,value:o}}};return q(d)},Me=(e,t={})=>{let n={},l=new Map,o,d={[Symbol.asyncIterator](){return d},next(){return o===void 0&&(o=new Map(Object.entries(e).map(([s,r])=>(l.set(s,r[Symbol.asyncIterator]()),[s,l.get(s).next().then(c=>({si:l,k:s,ir:c}))])))),function s(){return Promise.race(o.values()).then(({k:r,ir:c})=>c.done?(o.delete(r),l.delete(r),o.size?s():{done:!0,value:void 0}):(n[r]=c.value,o.set(r,l.get(r).next().then(h=>({k:r,ir:h}))),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?s():{done:!1,value:n}))}()},return(s){for(let r of l.values())r.return?.(s);return Promise.resolve({done:!0,value:s})},throw(s){for(let r of l.values())r.throw?.(s);return Promise.resolve({done:!0,value:s})}};return q(d)};function Xe(e){return de(e)&&he.every(t=>t in e&&e[t]===ce[t])}function q(e){return Xe(e)||fe(e,ce),e}function _e(e){return function(...t){let n=e(...t);return q(n)}}async function je(e){let t;for await(let n of this)t=e?.(n);await t}var R=Symbol("Ignore");function Ye(e,t,n){if(V(e))return e.then(t,n);try{return t(e)}catch(l){return n(l)}}function _(e,t,n=R,l=R){let o;function d(r){return o=s=null,l=R,{done:!0,value:r?.value}}let s={[Symbol.asyncIterator](){return s},next(...r){if(n!==R){let c=Promise.resolve({done:!1,value:n});return n=R,c}return new Promise(function c(h,x){o||(o=e[Symbol.asyncIterator]()),o.next(...r).then(U=>U.done?(l=R,h(U)):Ye(t(U.value,l),K=>K===R?c(h,x):h({done:!1,value:l=K}),K=>{l=R;let m=o.throw?.(K)??o.return?.(K);V(m)?m.then(x,x):x({done:!0,value:K})}),U=>{l=R,x({done:!0,value:U})}).catch(U=>{l=R;let K=o.throw?.(U)??o.return?.(U);V(K)?K.then(x,x):x({done:!0,value:K})})})},throw(r){return Promise.resolve(o?.throw?.(r)??o?.return?.(r)).then(d,d)},return(r){return Promise.resolve(o?.return?.(r)).then(d,d)}};return q(s)}function Ze(e){return _(this,e)}function Je(e){return _(this,async t=>await e(t)?t:R)}function ze(e){return e?_(this,async(t,n)=>n===R||await e(t,n)?t:R):_(this,(t,n)=>t===n?R:t)}function et(e){return _(this,t=>t,e)}function tt(e){return _(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function nt(){let e=this,t=0,n,l;function o(r){r&&n.resolve(r),r?.done?n=null:(n=ge(),l.next().then(o).catch(c=>{n?.reject({done:!0,value:c}),n=null}))}function d(r){return l=s=n=null,{done:!0,value:r?.value}}let s={[Symbol.asyncIterator](){return t+=1,s},next(){return l||(l=e[Symbol.asyncIterator](),o()),n},throw(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.throw?.(r)??l?.return?.(r)).then(d,d)},return(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(l?.return?.(r)).then(d,d)}};return q(s)}function rt(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var J=new WeakMap;function ot(e){J.has(this)||J.set(this,new Map);let t=J.get(this).get(e.type);if(t)for(let n of t)try{let{push:l,terminate:o,containerRef:d,selector:s,includeChildren:r}=n,c=d.deref();if(!c||!c.isConnected){let h="Container `#"+c?.id+">"+(s||"")+"` removed from DOM. Removing subscription";t.delete(n),o(new Error(h))}else if(e.target instanceof Node)if(s){let h=c.querySelectorAll(s);for(let x of h)(r?x.contains(e.target):e.target===x)&&c.contains(x)&&l(e)}else(r?c.contains(e.target):e.target===c)&&l(e)}catch(l){v.warn("docEventHandler",l)}}function xe(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function He(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Ae(e){let t=e.split(":");if(t.length===1)return xe(t[0])?[He(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&xe(t[1])&&!xe(t[0]))return[He(t[1]),t[0]]}function st(e){throw new Error(e)}function Ee(e,t){let[{includeChildren:n,selector:l},o]=Ae(t)??st("Invalid WhenSelector: "+t);J.has(e.ownerDocument)||J.set(e.ownerDocument,new Map),J.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,ot,{passive:!0,capture:!0}),J.get(e.ownerDocument).set(o,new Set));let d=J.get(e.ownerDocument).get(o),s=Ie(()=>d.delete(r)),r={push:s.push,terminate(c){s.return?.(c)},containerRef:new WeakRef(e),includeChildren:n,selector:l};return We(e,l?[l]:void 0).then(c=>d.add(r)),s.multi()}async function*Ue(){return void 0}function Pe(e){function t(n){return e.map(n)}return Object.assign(q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function at(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Ae(e)}async function*it(e){yield e}function Se(e,...t){if(!t||t.length===0)return Pe(Ee(e,"change"));let n=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?Ee(e,o):o instanceof Element?Ee(o,"change"):V(o)?it(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(o)}if(t.includes("@ready")){let o=t.filter(at).map(h=>Ae(h)?.[0]),d=h=>typeof h=="string"&&!e.querySelector(h),s=o.map(h=>h?.selector).filter(d),r,c={[Symbol.asyncIterator](){return c},throw(h){return r?.throw?r.throw(h):Promise.resolve({done:!0,value:h})},return(h){return r?.return?r.return(h):Promise.resolve({done:!0,value:h})},next(){return r?r.next():We(e,s).then(()=>(r=(n.length>1?ue(...n):n.length===1?n[0]:Ue())[Symbol.asyncIterator](),{done:!1,value:{}}))}};return Pe(q(c))}let l=n.length>1?ue(...n):n.length===1?n[0]:Ue();return Pe(q(l))}function We(e,t){function n(){if(e.isConnected)return Promise.resolve();let o=new Promise((d,s)=>new MutationObserver((r,c)=>{r.some(h=>h.addedNodes?.length)&&e.isConnected&&(c.disconnect(),d()),r.some(h=>[...h.removedNodes].some(x=>x===e||x.contains(e)))&&(c.disconnect(),s(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(O){let d=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),s=setTimeout(()=>{v.warn(d+`
`+e.outerHTML)},Y);o.finally(()=>clearTimeout(s))}return o}function l(o){if(o=o.filter(s=>!e.querySelector(s)),!o.length)return Promise.resolve();let d=new Promise(s=>new MutationObserver((r,c)=>{r.some(h=>h.addedNodes?.length)&&o.every(h=>e.querySelector(h))&&(c.disconnect(),s())}).observe(e,{subtree:!0,childList:!0}));if(O){let s=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(s+o+`
`)},Y);d.finally(()=>clearTimeout(r))}return d}return t?.length?n().then(()=>l(t)):n()}var ie=Symbol("callStack");var pe=Symbol("Unique ID"),be=Symbol("trackNodes"),Ke=Symbol("onRemovalFromDOM"),Ce="--ai-ui-extended-tag-styles",X=O?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},lt=0,ct=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function ne(){throw new Error("<elt>.ids is a read-only map of Elements")}var Le=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function $e(e){return e in Le?Le[e]:e}function me(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||V(e)||Q(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var dt=function(e,t,n){let[l,o,d]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,ct,e],s=d?.commonProperties,r=d?.document??globalThis.document,c=r.documentURI==="about:testing",h=d?.ErrorTag||function({error:p}){return r.createComment(p instanceof Error?p.toString():`Error:
`+JSON.stringify(p,null,2))},x=ut(r);function U(i){return r.createComment(i?i.toString():O&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}document.getElementById(Ce)||r.head.appendChild(Object.assign(r.createElement("STYLE"),{id:Ce}));let K=new Set,m=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...i){return Se(this,...i)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(i){if(Q(i)){let p=ae(i)?i:i[Symbol.asyncIterator](),u=()=>p.next().then(({done:a,value:T})=>{$(this,T),a||u()},a=>v.warn(a));u()}else $(this,i)}},ids:{configurable:!0,enumerable:!0,set:ne,get(){let i=new Proxy(()=>{},{apply(p,u,a){try{return u.constructor.definition.ids[a[0].id](...a)}catch(T){throw new Error(`<elt>.ids.${a?.[0]?.id} is not a tag-creating function`,{cause:T})}},construct:ne,defineProperty:ne,deleteProperty:ne,set:ne,setPrototypeOf:ne,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,u){if(this.get(p,u,null))return Reflect.getOwnPropertyDescriptor(p,$e(u))},has(p,u){return!!this.get(p,u,null)},ownKeys:p=>{let u=[...this.querySelectorAll("[id]")].map(T=>T.id),a=[...new Set(u)];return O&&u.length!==a.length&&v.log("Element contains multiple, shadowed decendant ids",a),a},get:(p,u,a)=>{if(typeof u=="string"){let T=$e(u);if(T in p){let I=p[T].deref();if(I&&I.id===u&&this.contains(I))return I;delete p[T]}let y;if(O){let I=this.querySelectorAll("#"+CSS.escape(u));I.length>1&&(K.has(u)||(K.add(u),v.log(`Element contains multiple, shadowed decendants with ID "${u}"`))),y=I[0]}else y=this.querySelector("#"+CSS.escape(u))??void 0;return y&&Reflect.set(p,T,new WeakRef(y),p),y}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:ne,get(){return i}}),i}}});d?.enableOnRemovedFromDOM&&Object.defineProperty(m,"onRemovedFromDOM",{configurable:!0,enumerable:!1,set:function(i){x.onRemoval([this],Ke,i)},get:function(){x.getRemovalHandler(this,Ke)}}),s&&k(m,s);function*S(...i){function p(u){return u==null||u===R}for(let u of i)if(!p(u)){if(V(u)){let a=[U()];u.then(T=>{let y=a;if(y){a=[...S(T)],x.onRemoval(a,be,()=>{a=void 0});for(let I=0;I<y.length;I++)I===0?y[I].replaceWith(...a):y[I].remove()}}),a&&(yield*a);continue}if(u instanceof Node){yield u;continue}if(u&&typeof u=="object"&&Symbol.iterator in u&&!(Symbol.asyncIterator in u)&&u[Symbol.iterator]){for(let a of u)yield*S(a);continue}if(Q(u)){let a=O?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",T=ae(u)?u:u[Symbol.asyncIterator](),y=!0,I=(b=!1)=>{if(!T||!E.nodes)return!0;if(b||E.nodes.every(g=>x.has(g))){E.nodes?.forEach(P=>x.add(P));let g="Element(s) have been removed from the document: "+E.nodes.map(X).join(`
`)+a;return E.nodes=null,T.return?.(new Error(g)),T=null,!0}return!1},z=u.valueOf(),E={nodes:z===u?[]:[...S(z)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};E.nodes.length||(E.nodes=[U()]),x.onRemoval(E.nodes,be,I);let f=O?(()=>{let b=Date.now()+Y,g=new Error("Created by").stack,P=()=>{y&&b&&b<Date.now()&&(P=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,g,E.nodes?.map(X)))};return P})():null;(function b(){T.next().then(g=>{if(!g.done){if(!E.nodes){T?.throw?.(new Error("Already ternimated"));return}let P=E.nodes.filter(C=>C.isConnected),M=y?E.nodes:P;if(y&&P.length&&(y=!1),!I(!M.length)){f?.(),x.onRemoval(E.nodes,be),E.nodes=[...S(re(g.value))],E.nodes.length||(E.nodes=[U()]),x.onRemoval(E.nodes,be,I);for(let C=0;C<M.length;C++)C===0?M[0].replaceWith(...E.nodes):E.nodes.includes(M[C])||M[C].remove(),x.add(M[C]);b()}}}).catch(g=>{let P=E.nodes?.filter(M=>!!M?.parentNode);P?.length?(P[0].replaceWith(h({error:g?.value??g})),P.slice(1).forEach(M=>M?.remove())):v.warn("Can't report error",g,E.nodes?.map(X)),E.nodes=null,T=null})})(),E.nodes&&(yield*E);continue}yield r.createTextNode(u.toString())}}l||Object.assign(dt,{nodes:S,UniqueID:pe});let L=Object.getPrototypeOf({});function k(i,p,u){if(!(p==null||typeof p!="object"||p===i))for(let[a,T]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in T){let y=T.value;y&&Q(y)?Object.defineProperty(i,a,T):y&&typeof y=="object"&&!V(y)?a in i?y instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${a}' value: ${X(y)} destination: ${i instanceof Node?X(i):i}`),i[a]=y):i[a]!==y&&(Array.isArray(i[a])&&i[a].length!==y.length?y.constructor===Object||y.constructor===Array?k(i[a]=new y.constructor,y):i[a]=y:k(i[a],y)):(u&&(Object.getPrototypeOf(y)===L||!Object.getPrototypeOf(y)?k(T.value={},y):Array.isArray(y)?k(T.value=[],y):v.warn(`Declared propety '${a}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,i,y)),Object.defineProperty(i,a,T)):p[a]!==void 0&&(i[a]=p[a])}else Object.defineProperty(i,a,T)}catch(y){throw v.warn("deepAssign",a,p[a],y),y}}function re(i){let p=i?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,re):p}function $(i,p){ie in p||function u(a,T){if(T==null||typeof T!="object")return;let y=Object.entries(Object.getOwnPropertyDescriptors(T));Array.isArray(T)||y.sort(f=>{let b=Object.getOwnPropertyDescriptor(a,f[0]);if(b){if("value"in b)return-1;if("set"in b||"get"in b)return 1}return 0});function I(f,b){!c&&a instanceof Element&&(b===null||typeof b=="number"||typeof b=="boolean"||typeof b=="string")&&(!(f in a)||typeof a[f]!="string")?a.setAttribute(f==="className"?"class":f,String(b)):a[f]=b}for(let[f,b]of y)try{if("value"in b){let g=b.value;Q(g)?z(g,f):V(g)?g.then(P=>{x.has(i)||(P&&typeof P=="object"?Q(P)?z(P,f):E(P,f):T[f]!==void 0&&I(f,P))},P=>v.log(`Exception in promised attribute '${f}'`,P,X(a))):Q(g)||(g&&typeof g=="object"&&!V(g)?E(g,f):T[f]!==void 0&&I(f,T[f]))}else Object.defineProperty(a,f,b)}catch(g){throw v.warn("assignProps",f,T[f],g),g}function z(f,b){let g=Te(f),P=Date.now()+Y,M=O&&new Error("Created by").stack,C=!1,F=j=>{if(!j.done){if(C=C||i.isConnected,x.has(i)){se("(node removed)"),g.return?.();return}let N=re(j.value);if(typeof N=="object"&&N!==null){let B=Object.getOwnPropertyDescriptor(a,b);b==="style"||!B?.set?u(a[b],N):I(b,N)}else N!==void 0&&I(b,N);O&&!C&&P<Date.now()&&(P=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${b}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${X(i)}
${M}`)),g.next().then(F).catch(se)}},se=j=>{j&&(v.warn("Dynamic attribute termination",j,b,X(a),M,X(i)),i.appendChild(h({error:j})))},W=f.valueOf();W!==void 0&&W!==f&&!Q(W)?F({done:!1,value:W}):g.next().then(F).catch(se),x.onRemoval([i],b,()=>g.return?.())}function E(f,b){if(f instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${b}' value: ${X(f)} destination: ${i instanceof Node?X(i):i}`),I(b,f);else if(!(b in a)||a[b]===f||Array.isArray(a[b])&&a[b].length!==f.length)if(f.constructor===Object||f.constructor===Array){let g=new f.constructor;u(g,f),I(b,g)}else I(b,f);else Object.getOwnPropertyDescriptor(a,b)?.set?I(b,f):u(a[b],f)}}(i,p)}function D(i){for(let p=i.constructor;p;p=p.super)if(p===this)return!0;return!1}function A(i){let p=typeof i!="function"?f=>Object.assign({},i,f):i,u=Date.now().toString(36)+(lt++).toString(36)+Math.random().toString(36).slice(2),a=p({[pe]:u});a.styles&&document.getElementById(Ce)?.appendChild(r.createTextNode(a.styles+`
`));let y=Object.assign((f,...b)=>{let g=me(f),P=[],M={[ie]:(g?P:f[ie])??P},C=g?this(M,f,...b):this(M,...b);C.constructor=y;let F=p({[pe]:u});if(M[ie].push(F),O){let W=(j,N)=>{for(let B=j;B;B=B.super)if(B.definition?.declare&&N in B.definition.declare)return!0;return!1};if(F.declare){let j=Object.keys(F.declare).filter(N=>N in C||W(this,N));j.length&&v.log(`Declared keys '${j}' in ${y.name} already exist in base '${this.valueOf()}'`)}if(F.override){let j=Object.keys(F.override).filter(N=>!(N in C)&&!(s&&N in s)&&!W(this,N));j.length&&v.log(`Overridden keys '${j}' in ${y.name} do not exist in base '${this.valueOf()}'`)}}k(C,F.declare,!0),k(C,F.override);let se=new Set;if(F.iterable&&Object.keys(F.iterable).forEach(W=>{W in C?(v.log(`Ignoring attempt to re-define iterable property "${W}" as it could already have consumers`),se.add(W)):ve(C,W,F.iterable[W])}),M[ie]===P){g||$(C,f);for(let N of P){let B=N?.constructed?.call(C);me(B)&&C.append(...S(B))}let W={},j=!1;for(let N of P)if(N.iterable)for(let B of Object.keys(N.iterable)){let Oe=!g&&B in f;if(se.has(B)&&Oe||!(Oe&&(!V(f[B])||!Q(f[B])))){let we=C[B]?.valueOf();we!==void 0&&(W[B]=we,j=!0)}}j&&Object.assign(C,W)}return C},{super:this,definition:Object.assign(a,{[pe]:u}),extended:A,valueOf:()=>{let f=[...Object.keys(a.declare||{}),...Object.keys(a.iterable||{})];return`${y.name}: {${f.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(y,Symbol.hasInstance,{value:D,writable:!0,configurable:!0});let I={};(function f(b){b?.super&&f(b.super);let g=b.definition;g&&(k(I,g?.override),k(I,g?.declare))})(this),k(I,a.override),k(I,a.declare),Object.defineProperties(y,Object.getOwnPropertyDescriptors(I));let z=I&&"className"in I&&typeof I.className=="string"?I.className:u,E=O?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(y,"name",{value:"<ai-"+z.replace(/\s+/g,"-")+E+">"}),O){let f=Object.keys(a).filter(b=>!["styles","ids","constructed","declare","override","iterable"].includes(b));f.length&&v.log(`${y.name} defines extraneous keys '${f}', which are unknown`)}return y}let w={createElement:(i,p,...u)=>i instanceof Node?i:typeof i=="string"&&i in w?w[i](p,u):i===w.createElement?[...S(...u)]:typeof i=="function"?i(p,u):h({error:new Error("Illegal type in createElement:"+i)})};function Z(i){if(w[i])return w[i];let p=(a,...T)=>{if(me(a)&&(T.unshift(a),a={}),!me(a)){if(a.debugger){debugger;delete a.debugger}let y=l?r.createElementNS(l,i.toLowerCase()):r.createElement(i);return y.constructor=p,k(y,m),$(y,a),y.append(...S(...T)),y}},u=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:A,valueOf(){return`TagCreator: <${l||""}${l?"::":""}${i}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:D,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+i+">"}),w[i]=u}return o.forEach(Z),w};function ut(e){let t=new WeakSet,n=new WeakMap;function l(o){for(let d of o)if(!d.isConnected){t.add(d),l(d.childNodes);let s=n.get(d);if(s){n.delete(d);for(let[r,c]of s?.entries())try{c.call(d)}catch{v.info("Ignored exception handling node removal",r,c,X(d))}}}}return new MutationObserver(o=>{o.forEach(function(d){d.type==="childList"&&d.removedNodes.length&&l(d.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(o){return t.has(o)},add(o){return t.add(o)},getRemovalHandler(o,d){return n.get(o)?.get(d)},onRemoval(o,d,s){s?o.forEach(r=>{let c=n.get(r)??new Map;n.set(r,c),c.set(d,s)}):o.forEach(r=>{let c=n.get(r);c&&(c.delete(d),c.size||n.delete(r))})}}}export{Be as Iterators,pe as UniqueID,dt as tag,Se as when};
