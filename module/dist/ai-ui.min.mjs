var We=Object.defineProperty;var Ue=(e,t)=>{for(var n in t)We(e,n,{get:t[n],enumerable:!0})};var S=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){S&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){S&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){S&&console.info("(AI-UI) INFO:",...e)}};var we=e=>{};function ge(){let e=we,t=we,n=new Promise((...a)=>[e,t]=a);if(n.resolve=e,n.reject=t,S){let a=new Error().stack;n.catch(i=>i instanceof Error||i?.value instanceof Error?v.log("Deferred rejection",i,"allocated at ",a):void 0)}return n}function ce(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return ce(e)&&"then"in e&&typeof e.then=="function"}var Ne={};Ue(Ne,{Ignore:()=>R,Iterability:()=>oe,asyncExtras:()=>de,asyncIterator:()=>Te,augmentGlobalAsyncGenerators:()=>Ze,combine:()=>Re,debounceQueueIteratableIterator:()=>ke,defineIterableProperty:()=>ve,filterMap:()=>_,generatorHelpers:()=>$e,isAsyncIter:()=>G,isAsyncIterable:()=>ue,isAsyncIterator:()=>ie,iterableHelpers:()=>Q,merge:()=>ye,queueIteratableIterator:()=>Ie});var oe=Symbol("Iterability");function ie(e){return ce(e)&&"next"in e&&typeof e?.next=="function"}function ue(e){return ce(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return ue(e)||ie(e)}function Te(e){if(ie(e))return e;if(ue(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var de={filterMap(e,t=R){return _(this,e,t)},map:Ge,filter:Qe,unique:qe,waitFor:_e,multi:Ye,initially:Xe,consume:Me,merge(...e){return ye(this,...e)},combine(e){return Re(Object.assign({_this:this},e))}},he=[...Object.getOwnPropertySymbols(de),...Object.keys(de)];function pe(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let a of n)Object.defineProperty(e,a,{...Object.getOwnPropertyDescriptor(t,a),enumerable:!1});return e}var B=Symbol("pending"),V=Symbol("items");function De(e=()=>{}){let t={[B]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[B])return Promise.resolve({done:!0,value:void 0});let n=ge();return n.catch(a=>{}),t[B].unshift(n),n},return(n){let a={done:!0,value:void 0};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().resolve(a);t[V]=t[B]=null}return Promise.resolve(a)},throw(...n){let a={done:!0,value:n[0]};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().reject(a);t[V]=t[B]=null}return Promise.reject(a)},get length(){return t[V]?t[V].length:-1},push(n){return t[B]?(t[B].length?t[B].pop().resolve({done:!1,value:n}):t[V]?t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var fe=Symbol("inflight");function Le(e=()=>{}){let t=De(e);return t[fe]=new Set,t.push=function(n){if(!t[B])return!1;if(t[fe].has(n))return!0;if(t[B].length){t[fe].add(n);let a=t[B].pop();a.finally(()=>t[fe].delete(n)),a.resolve({done:!1,value:n})}else t[V]?t[V].find(a=>a.value===n)||t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ie=De,ke=Le,re=Symbol("_proxiedAsyncIterator");function ve(e,t,n){let a=()=>{a=()=>H;let g=ke(),x=g.multi(),H=x[Symbol.asyncIterator]();return b[Symbol.asyncIterator]=x[Symbol.asyncIterator],u=g.push,he.forEach(w=>b[w]=H[w]),re in r||pe(r,b),H};function i(g){return{[g]:function(...x){return a(),r[g].apply(this,x)}}[g]}let b={[Symbol.asyncIterator]:a};he.forEach(g=>b[g]=i(g)),typeof n=="object"&&n&&oe in n&&n[oe]==="shallow"&&(b[oe]=n[oe]);let u=g=>(a(),u(g)),r=c(n,b),o;return Object.defineProperty(e,t,{get(){return r},set(g){if(g!==r)if(ue(g)){if(o===g)return;o=g;let x=S?new Error:void 0;S&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Me.call(g,H=>{if(g!==o)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});u(H?.valueOf())}).catch(H=>v.info(H)).finally(()=>g===o&&(o=void 0));return}else o&&S&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=c(g,b);u(g?.valueOf())},enumerable:!0}),e;function c(g,x){if(g==null)return pe(Object.create(null,{valueOf:{value(){return g},writable:!0,configurable:!0},toJSON:{value(){return g},writable:!0,configurable:!0}}),x);switch(typeof g){case"bigint":case"boolean":case"number":case"string":return pe(Object(g),Object.assign(x,{toJSON(){return g.valueOf()}}));case"object":return q(g,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof g+'"')}function C(g){return ce(g)&&re in g}function M(g,x){let H=x.split(".").slice(1);for(let w=0;w<H.length&&(g=g?.[H[w]])!==void 0;w++);return g}function q(g,x){let H,w;return new Proxy(g,ae());function ae(U=""){return{has(O,E){return E===re||E===Symbol.toPrimitive||E in O||E in x},set(O,E,F,j){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${U}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(O,E,j)!==F&&u({[re]:{a:g,path:U}}),Reflect.set(O,E,F,j)},deleteProperty(O,E){return Reflect.deleteProperty(O,E)?(u({[re]:{a:g,path:U}}),!0):!1},get(O,E,F){if(Object.hasOwn(x,E))return U.length?(H??(H=_(x,s=>C(s)?s[re]:{a:s,path:null})),_(H,(s,p)=>{let d=M(s.a,U);return p!==d||s.path===null||s.path.startsWith(U)?d:R},R,M(g,U))[E]):(w??(w=_(x,j=>C(j)?j[re].a:j)),w[E]);if(E==="valueOf")return()=>M(g,U);if(E===Symbol.toPrimitive)return function(j){return Reflect.has(O,E)?Reflect.get(O,E,O).call(O,j):j==="string"?O.toString():j==="number"?Number(O):O.valueOf()};if(typeof E=="string"&&(!(E in O)||Object.hasOwn(O,E))&&!(oe in O&&O[oe]==="shallow")){let j=Reflect.get(O,E,F);return typeof j=="function"||G(j)?j:new Proxy(Object(j),ae(U+"."+E))}return Reflect.get(O,E,F)}}}}}var z=new Promise(()=>{}),ye=(...e)=>{let t=new Array(e.length),n=new Array(e.length),a=()=>{a=()=>{};for(let r=0;r<e.length;r++){let o=e[r];n[r]=(t[r]=Symbol.asyncIterator in o?o[Symbol.asyncIterator]():o).next().then(c=>({idx:r,result:c}))}},i=[],b=n.length,u={[Symbol.asyncIterator](){return u},next(){return a(),b?Promise.race(n).then(({idx:r,result:o})=>o.done?(b--,n[r]=z,i[r]=o.value,u.next()):(n[r]=t[r]?t[r].next().then(c=>({idx:r,result:c})).catch(c=>({idx:r,result:{done:!0,value:c}})):Promise.resolve({idx:r,result:{done:!0,value:void 0}}),o)).catch(r=>u.throw?.(r)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:i})},async return(r){for(let o=0;o<t.length;o++)n[o]!==z&&(n[o]=z,i[o]=await t[o]?.return?.({done:!0,value:r}).then(c=>c.value,c=>c));return{done:!0,value:i}},async throw(r){for(let o=0;o<t.length;o++)n[o]!==z&&(n[o]=z,i[o]=await t[o]?.throw?.(r).then(c=>c.value,c=>c));return{done:!0,value:i}}};return Q(u)},Re=(e,t={})=>{let n={},a,i=[],b=0,u={[Symbol.asyncIterator](){return u},next(){return a===void 0&&(a=Object.entries(e).map(([r,o],c)=>(b+=1,i[c]=o[Symbol.asyncIterator](),i[c].next().then(C=>({si:i,idx:c,k:r,ir:C}))))),function r(){return Promise.race(a).then(({idx:o,k:c,ir:C})=>C.done?(a[o]=z,b-=1,b?r():{done:!0,value:void 0}):(n[c]=C.value,a[o]=i[o].next().then(M=>({idx:o,k:c,ir:M})),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?r():{done:!1,value:n}))}()},return(r){return a.forEach((o,c)=>{o!==z&&i[c].return?.(r)}),Promise.resolve({done:!0,value:r})},throw(r){return a.forEach((o,c)=>{o!==z&&i[c].throw?.(r)}),Promise.reject({done:!0,value:r})}};return Q(u)};function Fe(e){return ue(e)&&he.every(t=>t in e&&e[t]===de[t])}function Q(e){return Fe(e)||pe(e,de),e}function $e(e){return function(...t){let n=e(...t);return Q(n)}}async function Me(e){let t;for await(let n of this)t=e?.(n);await t}var R=Symbol("Ignore");function Ve(e,t,n){if(X(e))return e.then(t,n);try{return t(e)}catch(a){return n(a)}}function _(e,t,n=R,a=R){let i;function b(r){return i=u=null,a=R,{done:!0,value:r?.value}}let u={[Symbol.asyncIterator](){return u},next(...r){if(n!==R){let o=Promise.resolve({done:!1,value:n});return n=R,o}return new Promise(function o(c,C){i||(i=e[Symbol.asyncIterator]()),i.next(...r).then(M=>M.done?(a=R,c(M)):Ve(t(M.value,a),q=>q===R?o(c,C):c({done:!1,value:a=q}),q=>{a=R,i.throw?i.throw(q):i.return?.(q),C({done:!0,value:q})}),M=>{a=R,C({done:!0,value:M})}).catch(M=>{a=R,i.throw?i.throw(M):i.return?.(M),C({done:!0,value:M})})})},throw(r){return Promise.resolve(i?.throw?i.throw(r):i?.return?.(r)).then(b)},return(r){return Promise.resolve(i?.return?.(r)).then(b)}};return Q(u)}function Ge(e){return _(this,e)}function Qe(e){return _(this,async t=>await e(t)?t:R)}function qe(e){return e?_(this,async(t,n)=>n===R||await e(t,n)?t:R):_(this,(t,n)=>t===n?R:t)}function Xe(e){return _(this,t=>t,e)}function _e(e){return _(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function Ye(){let e=this,t=0,n,a;function i(r){r&&n.resolve(r),r?.done?n=null:(n=ge(),a.next().then(i).catch(o=>{n.reject({done:!0,value:o}),n=null}))}function b(r){return a=u=n=null,{done:!0,value:r?.value}}let u={[Symbol.asyncIterator](){return t+=1,u},next(){return a||(a=e[Symbol.asyncIterator](),i()),n},throw(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(a?.throw?a.throw(r):a?.return?.(r)).then(b)},return(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(a?.return?.(r)).then(b)}};return Q(u)}function Ze(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var ee=new WeakMap;function Je(e){setTimeout(()=>ze.call(this,e),1)}function ze(e){ee.has(this)||ee.set(this,new Map);let t=ee.get(this).get(e.type);if(t)for(let n of t)try{let{push:a,terminate:i,containerRef:b,selector:u,includeChildren:r}=n,o=b.deref();if(!o||!o.isConnected){let c="Container `#"+o?.id+">"+(u||"")+"` removed from DOM. Removing subscription";t.delete(n),i(new Error(c))}else if(e.target instanceof Node)if(u){let c=o.querySelectorAll(u);for(let C of c)(r?C.contains(e.target):e.target===C)&&o.contains(C)&&a(e)}else(r?o.contains(e.target):e.target===o)&&a(e)}catch(a){v.warn("docEventHandler",a)}}function Ee(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function je(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Ae(e){let t=e.split(":");if(t.length===1)return Ee(t[0])?[je(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Ee(t[1])&&!Ee(t[0]))return[je(t[1]),t[0]]}function et(e){throw new Error(e)}function xe(e,t){let[{includeChildren:n,selector:a},i]=Ae(t)??et("Invalid WhenSelector: "+t);ee.has(e.ownerDocument)||ee.set(e.ownerDocument,new Map),ee.get(e.ownerDocument).has(i)||(e.ownerDocument.addEventListener(i,Je,{passive:!0,capture:!0}),ee.get(e.ownerDocument).set(i,new Set));let b=ee.get(e.ownerDocument).get(i),u=Ie(()=>b.delete(r)),r={push:u.push,terminate(o){u.return?.(o)},containerRef:new WeakRef(e),includeChildren:n,selector:a};return Be(e,a?[a]:void 0).then(o=>b.add(r)),u.multi()}async function*tt(){return void 0}function Pe(e){function t(n){return e.map(n)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function nt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Ae(e)}async function*rt(e){yield e}function Ce(e,...t){if(!t||t.length===0)return Pe(xe(e,"change"));let n=t.filter(i=>typeof i!="string"||i[0]!=="@").map(i=>typeof i=="string"?xe(e,i):i instanceof Element?xe(i,"change"):X(i)?rt(i):i);if(t.includes("@start")){let i={[Symbol.asyncIterator]:()=>i,next(){return i.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(i)}if(t.includes("@ready")){let i=t.filter(nt).map(c=>Ae(c)?.[0]),b=c=>typeof c=="string"&&!e.querySelector(c),u=i.map(c=>c?.selector).filter(b),r,o={[Symbol.asyncIterator](){return o},throw(c){return r?.throw?r.throw(c):Promise.resolve({done:!0,value:c})},return(c){return r?.return?r.return(c):Promise.resolve({done:!0,value:c})},next(){return r?r.next():Be(e,u).then(()=>(r=(n.length>1?ye(...n):n.length===1?n[0]:void 0)?.[Symbol.asyncIterator](),r?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Pe(Q(o))}let a=n.length>1?ye(...n):n.length===1?n[0]:tt();return Pe(Q(a))}function Be(e,t){function n(){if(e.isConnected)return Promise.resolve();let i=new Promise((b,u)=>new MutationObserver((r,o)=>{r.some(c=>c.addedNodes?.length)&&e.isConnected&&(o.disconnect(),b()),r.some(c=>[...c.removedNodes].some(C=>C===e||C.contains(e)))&&(o.disconnect(),u(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(S){let b=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),u=setTimeout(()=>{v.warn(b+`
`+e.outerHTML)},Y);i.finally(()=>clearTimeout(u))}return i}function a(i){if(i=i.filter(u=>!e.querySelector(u)),!i.length)return Promise.resolve();let b=new Promise(u=>new MutationObserver((r,o)=>{r.some(c=>c.addedNodes?.length)&&i.every(c=>e.querySelector(c))&&(o.disconnect(),u())}).observe(e,{subtree:!0,childList:!0}));if(S){let u=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(u+i+`
`)},Y);b.finally(()=>clearTimeout(r))}return b}return t?.length?n().then(()=>a(t)):n()}var le=Symbol("callStack");var be=Symbol("Unique ID"),Z=S?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},ot=0,st=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function se(){throw new Error("<elt>.ids is a read-only map of Elements")}var He=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function Ke(e){return e in He?He[e]:e}function me(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var at=function(e,t,n){let[a,i,b]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,st,e],u=b?.commonProperties,r=b?.document??globalThis.document,o=it(r,b?.enableOnRemovedFromDOM);function c(s){return r.createComment(s?s.toString():S&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function C({error:s}){return r.createComment(s instanceof Error?s.toString():`Error:
`+JSON.stringify(s,null,2))}let M=r.createElement("STYLE");M.id="--ai-ui-extended-tag-styles-"+Date.now(),r.head.appendChild(M);let q=new Set,g=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...s){return Ce(this,...s)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(s){if(G(s)){let p=ie(s)?s:s[Symbol.asyncIterator](),d=()=>p.next().then(({done:l,value:h})=>{U(this,h),l||d()},l=>v.warn(l));d()}else U(this,s)}},ids:{configurable:!0,enumerable:!0,set:se,get(){let s=new Proxy(()=>{},{apply(p,d,l){try{return d.constructor.definition.ids[l[0].id](...l)}catch(h){throw new Error(`<elt>.ids.${l?.[0]?.id} is not a tag-creating function`,{cause:h})}},construct:se,defineProperty:se,deleteProperty:se,set:se,setPrototypeOf:se,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,d){if(this.get(p,d,null))return Reflect.getOwnPropertyDescriptor(p,Ke(d))},has(p,d){return!!this.get(p,d,null)},ownKeys:p=>{let d=[...this.querySelectorAll("[id]")].map(h=>h.id),l=[...new Set(d)];return S&&d.length!==l.length&&v.log("Element contains multiple, shadowed decendant ids",l),l},get:(p,d,l)=>{if(typeof d=="string"){let h=Ke(d);if(h in p){let A=p[h].deref();if(A&&A.id===d&&this.contains(A))return A;delete p[h]}let f;if(S){let A=this.querySelectorAll("#"+CSS.escape(d));A.length>1&&(q.has(d)||(q.add(d),v.log(`Element contains multiple, shadowed decendants with ID "${d}"`))),f=A[0]}else f=this.querySelector("#"+CSS.escape(d))??void 0;return f&&Reflect.set(p,h,new WeakRef(f),p),f}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:se,get(){return s}}),s}}});u&&w(g,u);function*x(...s){function p(d){return d==null||d===R}for(let d of s)if(!p(d)){if(X(d)){let l=c();d.then(h=>{l.replaceWith(...x(h)),l=void 0}),yield l;continue}if(d instanceof Node){yield d;continue}if(d&&typeof d=="object"&&Symbol.iterator in d&&!(Symbol.asyncIterator in d)&&d[Symbol.iterator]){for(let l of d)yield*x(l);continue}if(G(d)){let l=S?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",h=ie(d)?d:d[Symbol.asyncIterator](),f=!0,A=(T=!1)=>{if(!h||!y.nodes)return!0;if(T||y.nodes.every(I=>o.has(I))){y.nodes?.forEach(D=>o.add(D));let I="Element(s) have been removed from the document: "+y.nodes.map(Z).join(`
`)+l;return y.nodes=null,h.return?.(new Error(I)),h=null,!0}return!1},te=d.valueOf(),y={nodes:te===d||p(d)?[c()]:[...x(te)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};o.onRemoval(y.nodes,"nodes",A);let m=S?(()=>{let T=Date.now()+Y,I=new Error("Created by").stack,D=()=>{f&&T&&T<Date.now()&&(D=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,I,y.nodes?.map(Z)))};return D})():null;(function T(){h.next().then(I=>{if(!I.done){if(!y.nodes){h?.throw?.(new Error("Already ternimated"));return}let D=y.nodes.filter(P=>P.isConnected),k=f?y.nodes:D;if(f&&D.length&&(f=!1),!A(!k.length)){m?.(),o.onRemoval(y.nodes,"nodes"),y.nodes=[...x(ae(I.value))],o.onRemoval(y.nodes,"nodes",A);for(let P=0;P<k.length;P++)P===0?k[0].replaceWith(...y.nodes):y.nodes.includes(k[P])||k[P].remove(),o.add(k[P]);T()}}}).catch(I=>{let D=y.nodes?.filter(k=>!!k?.parentNode);y.nodes?.forEach(k=>o.add(k)),D?.length?(D[0].replaceWith(C({error:I})),D.slice(1).forEach(k=>k?.remove())):v.warn("Can't report error",I,y.nodes?.map(Z)),y.nodes&&o.onRemoval(y.nodes,"nodes"),y.nodes=null,h.return?.(I),h=null})})(),y.nodes&&(yield*y);continue}yield r.createTextNode(d.toString())}}a||Object.assign(at,{nodes:x,UniqueID:be});let H=Object.getPrototypeOf({});function w(s,p,d){if(!(p==null||typeof p!="object"||p===s))for(let[l,h]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in h){let f=h.value;f&&G(f)?Object.defineProperty(s,l,h):f&&typeof f=="object"&&!X(f)?l in s?f instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${l}' value: ${Z(f)} destination: ${s instanceof Node?Z(s):s}`),s[l]=f):s[l]!==f&&(Array.isArray(s[l])&&s[l].length!==f.length?f.constructor===Object||f.constructor===Array?w(s[l]=new f.constructor,f):s[l]=f:w(s[l],f)):(d&&(Object.getPrototypeOf(f)===H||!Object.getPrototypeOf(f)?w(h.value={},f):Array.isArray(f)?w(h.value=[],f):v.warn(`Declared propety '${l}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,s,f)),Object.defineProperty(s,l,h)):p[l]!==void 0&&(s[l]=p[l])}else Object.defineProperty(s,l,h)}catch(f){throw v.warn("deepAssign",l,p[l],f),f}}function ae(s){let p=s?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,ae):p}function U(s,p){le in p||function d(l,h){if(h==null||typeof h!="object")return;let f=Object.entries(Object.getOwnPropertyDescriptors(h));Array.isArray(h)||f.sort(y=>{let m=Object.getOwnPropertyDescriptor(l,y[0]);if(m){if("value"in m)return-1;if("set"in m||"get"in m)return 1}return 0});for(let[y,m]of f)try{if("value"in m){let T=m.value;G(T)?A(T,y):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?A(I,y):te(I,y):h[y]!==void 0&&(l[y]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?te(T,y):h[y]!==void 0&&(l[y]=h[y]))}else Object.defineProperty(l,y,m)}catch(T){throw v.warn("assignProps",y,h[y],T),T}function A(y,m){let T=Te(y),I=!0,D=Date.now()+Y,k=S&&new Error("Created by").stack,P=J=>{if(!J.done){let N=ae(J.value);if(typeof N=="object"&&N!==null){let K=Object.getOwnPropertyDescriptor(l,m);m==="style"||!K?.set?d(l[m],N):l[m]=N}else N!==void 0&&(l[m]=N);let $=s.isConnected;if(o.has(s)||!I&&!$){v.info(`Element does not exist in document when setting async attribute '${m}' to:
${Z(s)}`),T.return?.();return}$&&(I=!1),I&&D&&D<Date.now()&&(D=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${m}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Z(s)}
${k}`)),T.next().then(P).catch(L)}},L=J=>{T.return?.(J),J&&(v.warn("Dynamic attribute terminartion",J,m,l,k,Z(s)),s.appendChild(C({error:J})))},ne=y.valueOf();ne!==void 0&&ne!==y&&!G(ne)?P({done:!1,value:ne}):T.next().then(P).catch(L),o.onRemoval([s],"assignIterable",L)}function te(y,m){if(y instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${m}' value: ${Z(y)} destination: ${s instanceof Node?Z(s):s}`),l[m]=y;else if(!(m in l)||l[m]===y||Array.isArray(l[m])&&l[m].length!==y.length)if(y.constructor===Object||y.constructor===Array){let T=new y.constructor;d(T,y),l[m]=T}else l[m]=y;else Object.getOwnPropertyDescriptor(l,m)?.set?l[m]=y:d(l[m],y)}}(s,p)}function O(s){for(let p=s.constructor;p;p=p.super)if(p===this)return!0;return!1}function E(s){let p=typeof s!="function"?m=>Object.assign({},s,m):s,d=Date.now().toString(36)+(ot++).toString(36)+Math.random().toString(36).slice(2),l=p({[be]:d});l.styles&&M.appendChild(r.createTextNode(l.styles+`
`));let f=Object.assign((m,...T)=>{let I=me(m),D=[],k={[le]:(I?D:m[le])??D},P=I?this(k,m,...T):this(k,...T);P.constructor=f;let L=p({[be]:d});if(k[le].push(L),S){let N=function($,K){for(let W=$;W;W=W.super)if(W.definition?.declare&&K in W.definition.declare)return!0;return!1};var J=N;if(L.declare){let $=Object.keys(L.declare).filter(K=>K in P||N(this,K));$.length&&v.log(`Declared keys '${$}' in ${f.name} already exist in base '${this.valueOf()}'`)}if(L.override){let $=Object.keys(L.override).filter(K=>!(K in P)&&!(u&&K in u)&&!N(this,K));$.length&&v.log(`Overridden keys '${$}' in ${f.name} do not exist in base '${this.valueOf()}'`)}}w(P,L.declare,!0),w(P,L.override);let ne=new Set;if(L.iterable&&Object.keys(L.iterable).forEach(N=>{N in P?(v.log(`Ignoring attempt to re-define iterable property "${N}" as it could already have consumers`),ne.add(N)):ve(P,N,L.iterable[N])}),k[le]===D){I||U(P,m);for(let K of D){let W=K?.constructed?.call(P);me(W)&&P.append(...x(W))}let N={},$=!1;for(let K of D)if(K.iterable)for(let W of Object.keys(K.iterable)){let Oe=!I&&W in m;if(ne.has(W)&&Oe||!(Oe&&(!X(m[W])||!G(m[W])))){let Se=P[W]?.valueOf();Se!==void 0&&(N[W]=Se,$=!0)}}$&&Object.assign(P,N)}return P},{super:this,definition:Object.assign(l,{[be]:d}),extended:E,valueOf:()=>{let m=[...Object.keys(l.declare||{}),...Object.keys(l.iterable||{})];return`${f.name}: {${m.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(f,Symbol.hasInstance,{value:O,writable:!0,configurable:!0});let A={};(function m(T){T?.super&&m(T.super);let I=T.definition;I&&(w(A,I?.override),w(A,I?.declare))})(this),w(A,l.override),w(A,l.declare),Object.defineProperties(f,Object.getOwnPropertyDescriptors(A));let te=A&&"className"in A&&typeof A.className=="string"?A.className:d,y=S?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(f,"name",{value:"<ai-"+te.replace(/\s+/g,"-")+y+">"}),S){let m=Object.keys(l).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));m.length&&v.log(`${f.name} defines extraneous keys '${m}', which are unknown`)}return f}let F={createElement(s,p,...d){return s===F.createElement?x(...d):typeof s=="function"?s(p,d):typeof s=="string"&&s in F?F[s](p,d):s instanceof Node?s:C({error:new Error("Illegal type in createElement:"+s)})}};function j(s){if(F[s])return F[s];let p=(l,...h)=>{if(me(l)&&(h.unshift(l),l={}),!me(l)){if(l.debugger){debugger;delete l.debugger}let f=a?r.createElementNS(a,s.toLowerCase()):r.createElement(s);return f.constructor=p,w(f,g),U(f,l),f.append(...x(...h)),f}},d=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${a||""}${a?"::":""}${s}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:O,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+s+">"}),F[s]=d}return i.forEach(j),F};function it(e,t){let n=new WeakSet,a=new WeakMap;function i(b){for(let u of b)if(!u.isConnected){n.add(u),i(u.childNodes);let r=a.get(u);if(r){a.delete(u);for(let o of r?.values())o()}t&&"onRemovedFromDOM"in u&&typeof u.onRemovedFromDOM=="function"&&u.onRemovedFromDOM()}}return new MutationObserver(b=>{b.forEach(function(u){u.type==="childList"&&u.removedNodes.length&&i(u.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(b){return n.has(b)},add(b){return n.add(b)},onRemoval(b,u,r){r?b.forEach(o=>{let c=a.get(o)??new Map;a.set(o,c),c.set(u,r)}):b.forEach(o=>{let c=a.get(o);c&&(c.delete(u),c.size||a.delete(o))})}}}export{Ne as Iterators,be as UniqueID,at as tag,Ce as when};
