var AIUI;(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Iterators:()=>n,enableOnRemovedFromDOM:()=>V,getElementIdMap:()=>X,tag:()=>G,when:()=>F});var n={};e.r(n),e.d(n,{asyncExtras:()=>d,broadcastIterator:()=>h,defineIterableProperty:()=>m,generatorHelpers:()=>v,isAsyncIter:()=>a,isAsyncIterable:()=>c,isAsyncIterator:()=>i,iterableHelpers:()=>g,merge:()=>b,pushIterator:()=>y});const r=e=>{};function o(){let e=r,t=r;const n=new Promise(((...n)=>[e,t]=n));return n.resolve=e,n.reject=t,n}function s(e){return null!=e&&"function"==typeof e.then}function i(e){return"function"==typeof e?.next}function c(e){return e&&e[Symbol.asyncIterator]&&"function"==typeof e[Symbol.asyncIterator]}function a(e){return c(e)||i(e)}function l(e){return function(...t){return g(e.call(this,...t))}}const u={map:w,filter:O,throttle:S,debounce:I,waitFor:E,count:x,retain:N,broadcast:D,initially:j},d={map:l(w),filter:l(O),throttle:l(S),debounce:l(I),waitFor:l(E),count:l(x),retain:l(N),broadcast:l(D),initially:l(j),consume:async function(e){let t;for await(const n of this)t=e?.(n);await t}};class f{constructor(e=(()=>{})){this.stop=e,this._pending=[],this._items=[]}[Symbol.asyncIterator](){return this}next(){if(this._items.length)return Promise.resolve({done:!1,value:this._items.shift()});const e=o();return this._pending.push(e),e}return(){const e={done:!0,value:void 0};if(this._pending){try{this.stop()}catch(e){}for(;this._pending.length;)this._pending.shift().reject(e);this._items=this._pending=null}return Promise.resolve(e)}throw(...e){const t={done:!0,value:e[0]};if(this._pending){try{this.stop()}catch(e){}for(;this._pending.length;)this._pending.shift().reject(t);this._items=this._pending=null}return Promise.resolve(t)}push(e){return!!this._pending&&(this._pending.length?this._pending.shift().resolve({done:!1,value:e}):this._items.push(e),!0)}}function y(e=(()=>{}),t=!1){let n=0,r=new f((()=>{if(n-=1,0===n&&!t){try{e()}catch(e){}r=null}}));return Object.assign(Object.create(d),{[Symbol.asyncIterator]:()=>(n+=1,r),push:e=>!(!t&&0===n)&&r.push(e),close(e){e?r.throw?.(e):r.return?.(),r=null}})}function h(e=(()=>{})){let t=new Set;return Object.assign(Object.create(d),{[Symbol.asyncIterator](){const n=new f((()=>{if(t.delete(n),0===t.size){try{e()}catch(e){}t=null}}));return t.add(n),g(n)},push(e){if(!t?.size)return!1;for(const n of t.values())n.push(e);return!0},close(e){for(const n of t.values())e?n.throw?.(e):n.return?.();t=null}})}const p=Symbol("iterableProperty");function m(e,t,n){const r=h(),o=Object.fromEntries(Object.entries(u).map((([e,t])=>[e,{value:r[Symbol.asyncIterator]()[e],enumerable:!1,writable:!1}]))),s=Object.getOwnPropertyDescriptors(r);for(const e of[...Object.keys(s),...Object.getOwnPropertySymbols(s)])o[e]=s[e],o[e].writable=o[e].enumerable=!1;o[p]={value:p,enumerable:!1,writable:!1};let i=Object.defineProperties(Object.assign(n),o);return Object.defineProperty(e,t,{get:()=>i,set(e){e[p]!==p&&(i=Object.defineProperties(Object.assign(e),o)),r.push(e)},enumerable:!0}),e}const b=(...e)=>{const t=e.map((e=>Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e)),n=t.map(((e,t)=>e.next().then((e=>({idx:t,result:e}))))),r=[],o=new Promise((()=>{}));let s=n.length;return g({[Symbol.asyncIterator](){return this},next(){return s?Promise.race(n).then((({idx:e,result:i})=>i.done?(s--,n[e]=o,r[e]=i.value,{done:0===s,value:i.value}):(n[e]=t[e].next().then((t=>({idx:e,result:t}))),i))).catch((e=>this.throw?.(e)??Promise.reject({done:!0,value:new Error("Iterator merge exception")}))):Promise.reject({done:!0,value:new Error("Iterator merge complete")})},return(){const e=new Error("Merge terminated");for(let r=0;r<t.length;r++)n[r]!==o&&(n[r]=o,t[r].return?.({done:!0,value:e}));return Promise.resolve({done:!0,value:e})},throw(e){for(let r=0;r<t.length;r++)n[r]!==o&&(n[r]=o,t[r].throw?.(e));return Promise.reject(e)}})};function g(e){var t;return c(t=e)&&Object.keys(d).every((e=>e in t&&t[e]===d[e]))||Object.assign(e,d),e}function v(e){return function(...t){return g(e(...t))}}async function*w(...e){const t=this[Symbol.asyncIterator]();try{for(;;){const n=await t.next();if(n.done)return t.return?.(n.value);for(const t of e)yield t(n.value)}}catch(e){t.throw?.(e)}finally{t.return?.()}}async function*O(e){const t=this[Symbol.asyncIterator]();try{for(;;){const n=await t.next();if(n.done)return t.return?.(n.value);await e(n.value)&&(yield n.value)}}catch(e){t.throw?.(e)}finally{t.return?.()}}async function*j(e){yield e;for await(const e of this)yield e}async function*S(e){const t=this[Symbol.asyncIterator]();let n=0;try{for(;;){const r=await t.next();if(r.done)return t.return?.(r.value);const o=Date.now();n<o&&(n=o+e,yield r.value)}}catch(e){t.throw?.(e)}finally{t.return?.()}}const P=new Promise((()=>{}));async function*I(e){const t=this[Symbol.asyncIterator]();let n=P,r=-1;try{for(;;){const o=await Promise.race([t.next(),n]);if("done"in o&&o.done)return t.return?.(o.value);"debounced"in o&&o.debounced?o.debounced===r&&(yield o.value):(clearTimeout(r),n=new Promise((t=>{r=setTimeout((()=>{t({debounced:r,value:o.value})}),e)})))}}catch(e){t.throw?.(e)}finally{t.return?.()}}async function*E(e){const t=this[Symbol.asyncIterator]();try{for(;;){const n=await t.next();if(n.done)return t.return?.(n.value);await new Promise((t=>e(t))),yield n.value}}catch(e){t.throw?.(e)}finally{t.return?.()}}async function*x(e){const t=this[Symbol.asyncIterator]();let n=0;try{for await(const t of this){const r={...t,[e]:n++};yield r}}catch(e){t.throw?.(e)}finally{t.return?.()}}function N(){const e=this[Symbol.asyncIterator]();let t;return{[Symbol.asyncIterator](){return this},next(){const n=e.next();return n.then((e=>t=e)),n},return:t=>e.return?.(t)??Promise.resolve({done:!0,value:t}),throw:(...t)=>e.throw?.(t)??Promise.resolve({done:!0,value:t[0]}),get value(){return t.value},get done(){return Boolean(t.done)}}}function D(e=(e=>e)){const t=this[Symbol.asyncIterator](),n=h((()=>t.return?.()));return function e(){t.next().then((t=>{t.done||(n.push(t.value),e())})).catch((e=>n.close(e)))}(),{[Symbol.asyncIterator]:()=>e(n)[Symbol.asyncIterator]()}}const A=new Map;function _(e){const t=A.get(e.type);if(t)for(const n of t)try{const{push:r,container:o,selector:s}=n;if(document.body.contains(o)){if(e.target instanceof Node)if(s){const t=o.querySelectorAll(s);for(const n of t)(e.target===n||n.contains(e.target))&&o.contains(n)&&r.push(e)}else(e.target===o||o.contains(e.target))&&r.push(e)}else{const e="Container `#"+o.id+">"+(s||"")+"` removed from DOM. Removing subscription";t.delete(n),r[Symbol.asyncIterator]().throw?.(new Error(e))}}catch(e){console.warn("docEventHandler",e)}}function M(e){return Boolean(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function k(e){const t=e.split(":");return 1===t.length?M(t[0])?[t[0],"change"]:[null,t[0]]:2===t.length&&M(t[1])&&!M(t[0])?[t[1],t[0]]:void 0}function C(e,t){const[n,r]=k(t)??function(e){throw new Error(e)}("Invalid WhenSelector: "+t);A.has(r)||(document.addEventListener(r,_,{passive:!0,capture:!0}),A.set(r,new Set));const o=y((()=>A.get(r)?.delete(s))),s={push:o,container:e,selector:n||null};return A.get(r).add(s),o}async function*T(){try{await new Promise((()=>{})),yield}catch(e){console.warn("neverGonnaHappen",e)}}function L(e){return Object.assign(g((function(t){return d.map.call(e,t)})),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function q(e){if(!e)throw new Error("Falsy async source will never be ready\n\n"+JSON.stringify(e));return"string"==typeof e&&"@"!==e[0]&&Boolean(k(e))}function F(e,...t){if(!t||0===t.length)return L(C(e,"change"));const n=t.filter((e=>"string"!=typeof e||"@"!==e[0])).map((t=>"string"==typeof t?C(e,t):t instanceof Element?C(t,"change"):s(t)?async function*(e){yield e}(t):t));if(t.includes("@start")){const r={[Symbol.asyncIterator]:()=>r,next(){const e=o();return requestAnimationFrame((()=>e.resolve({done:!0,value:{}}))),e}};n.push(r)}if(t.includes("@ready")){function i(t){return Boolean("string"==typeof t&&!e.querySelector(t))}const c=t.filter(q).map((e=>k(e)?.[0])).filter(i),a={[Symbol.asyncIterator]:()=>a,async next(){await Promise.all([H(e,c),B(e)]);const t=(n.length>1?b(...n):1===n.length?n[0]:T())[Symbol.asyncIterator]();return a.next=()=>t.next(),a.return=e=>t.return?.(e)??Promise.resolve({done:!0,value:e}),a.throw=(...e)=>t.throw?.(e)??Promise.reject({done:!0,value:e[0]}),{done:!1,value:{}}}};return L(a)}return L(n.length>1?b(...n):1===n.length?n[0]:T())}function B(e){if(document.body.contains(e))return Promise.resolve();const t=o();return new MutationObserver(((n,r)=>{for(const o of n)if(o.addedNodes?.length&&document.body.contains(e))return r.disconnect(),void t.resolve()})).observe(document.body,{subtree:!0,childList:!0}),t}function H(e,t){if(!t.length)return Promise.resolve();const n=o();return new MutationObserver(((r,o)=>{for(const s of r)if(s.addedNodes?.length&&!(t=t.filter((t=>!e.querySelector(t)))).length)return o.disconnect(),void n.resolve()})).observe(e,{subtree:!0,childList:!0}),n}const $=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"],R={get ids(){return X(this)},set ids(e){throw new Error("Cannot set ids on "+this.valueOf())},when:function(...e){return F(this,...e)}},W=document.createElement("STYLE");function z(e){if(c(e))return e[Symbol.asyncIterator]();if(i(e))return e;throw new Error("Not as async provider")}function U(e){return"string"==typeof e||"number"==typeof e||"function"==typeof e||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||null==e||Array.isArray(e)||s(e)||a(e)||"function"==typeof e[Symbol.iterator]}W.id="--ai-ui-extended-tag-styles";const Y=Symbol("callStack"),G=function(e,t,n){const[r,o,i]="string"==typeof e||null===e?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,$,e],l=Object.create(null,Object.getOwnPropertyDescriptors(R));function u(...e){const t=[];return function e(n){if(null!=n){if(s(n)){let e=[K()];return t.push(e[0]),void n.then((t=>{const n=u(t),r=e;r[0].parentElement&&(d(r[0].parentElement,r[0])(n),r.forEach((e=>e.parentElement?.removeChild(e)))),e=n}),(t=>{console.warn(t),d(e[0])(Q(t.toString()))}))}if(n instanceof Node)t.push(n);else if(a(n)){const e="",r=c(n)?n[Symbol.asyncIterator]():n,o=K();t.push(o);let s=[o];const i=e=>{r.return?.(e);const t=(Array.isArray(s)?s:[s]).filter((e=>Boolean(e)));t[0].parentNode?(s=d(t[0].parentNode,t[0])(Q(e.toString())),t.forEach((e=>e.parentNode?.removeChild(e)))):console.warn("Can't report error",e,s)},a=t=>{if(!t.done){const n=(Array.isArray(s)?s:[s]).filter((e=>e.ownerDocument?.body.contains(e)));if(!n.length||!n[0].parentNode)throw new Error("Element(s) no longer exist in document"+e);s=d(n[0].parentNode,n[0])(t.value?.valueOf()??K()),n.forEach((e=>e.parentNode?.removeChild(e))),r.next().then(a).catch(i)}};r.next().then(a).catch(i)}else if("object"==typeof n&&n?.[Symbol.iterator])for(const t of n)e(t);else t.push(document.createTextNode(n.toString()))}}(e),t}function d(e,t){return void 0===t&&(t=null),function(n){const r=u(n);if(t)if(t instanceof Element)Element.prototype.before.call(t,...r);else{const n=t.parentElement;if(!n)throw new Error("Parent is null");n!==e&&console.warn("Container mismatch??");for(let e=0;e<r.length;e++)n.insertBefore(r[e],t)}else Element.prototype.append.call(e,...r);return r}}function f(e,t){if(null!=t&&"object"==typeof t&&t!==e)for(const[n,r]of Object.entries(Object.getOwnPropertyDescriptors(t)))try{if("value"in r){const o=r.value;o&&a(o)?Object.defineProperty(e,n,r):o&&"object"==typeof o&&!s(o)?n in e?o instanceof Node?(console.warn("Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or as a child",n,o),e[n]=o):e[n]!==o&&(Array.isArray(e[n])&&e[n].length!==o.length?o.constructor===Object||o.constructor===Array?f(e[n]=new o.constructor,o):e[n]=o:f(e[n],o)):Object.defineProperty(e,n,r):void 0!==t[n]&&(e[n]=t[n])}else Object.defineProperty(e,n,r)}catch(e){throw console.warn("deepAssign",n,t[n],e),e}}function y(e,t){Y in t||function t(n,r){if(null!=r&&"object"==typeof r)for(const[o,i]of Object.entries(Object.getOwnPropertyDescriptors(r)))try{if("value"in i){const c=i.value;if(a(c)){const r=z(c),s=c=>{if(e.ownerDocument.contains(e)){if(!c.done){const e=c.value?.valueOf();if("object"==typeof e&&null!==e){const r=Object.getOwnPropertyDescriptor(n,o);"style"!==o&&r?.set?n[o]=e:t(n[o],e)}else void 0!==e&&(n[o]=e);r.next().then(s).catch(i)}}else r.return?.(new Error("Element no longer exists in document (update "+o+")"))},i=t=>{r.return?.(t),console.warn("Dynamic attribute error",t,o,n,e),d(e)(Q(t.toString()))};r.next().then(s).catch(i)}a(c)||(c&&"object"==typeof c&&!s(c)?c instanceof Node?(console.warn("Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or as a child",o,c),n[o]=c):!(o in n)||n[o]===c||Array.isArray(n[o])&&n[o].length!==c.length?c.constructor===Object||c.constructor===Array?(n[o]=new c.constructor,t(n[o],c)):n[o]=c:Object.getOwnPropertyDescriptor(n,o)?.set?n[o]=c:t(n[o],c):void 0!==r[o]&&(n[o]=r[o]))}else Object.defineProperty(n,o,i)}catch(e){throw console.warn("assignProps",o,r[o],e),e}}(e,t)}function h(e){const t="function"!=typeof e?t=>e:e,n={};let r=t(n);r.styles&&(W.appendChild(document.createTextNode(r.styles)),document.head.contains(W)||document.head.appendChild(W));const o=Object.assign(((e,...n)=>{const r=U(e),s=[],i={[Y]:(r?s:e[Y])??s},c=r?this(i,e,...n):this(i,...n);c.constructor=o;const a=t({});i[Y].push(a),f(c,a.prototype);const l=a.iterable&&Object.keys(a.iterable);if(l?.forEach((e=>{m(c,e,a.iterable[e])})),i[Y]===s){for(r||y(c,e);s.length;){const e=s.shift(),t=e?.constructed?.call(c);U(t)&&d(c)(t)}l?.forEach((e=>c[e]=c[e].valueOf()))}return c}),{super:this,overrides:t,extended:h,valueOf:()=>{const e=Object.keys(r.prototype||{});return`${o.name}: {${e.join(", ")}}\n ↪ ${this.valueOf()}`}}),s={};!function e(t){t?.super&&e(t.super);const r=t.overrides?.(n)?.prototype;r&&f(s,r)}(this),f(s,r.prototype),Object.defineProperties(o,Object.getOwnPropertyDescriptors(s));const i=r.prototype&&"className"in r.prototype&&"string"==typeof r.prototype.className?r.prototype.className:"?";return Object.defineProperty(o,"name",{value:"<ai-"+i.replace(/\s+/g,"-")+">"}),o}i&&f(l,i),r||(G.appender=d,G.nodes=u);const p={};return o.forEach((function(e){if(p[e])return p[e];const t=(n,...o)=>{let s=document;if(U(n)&&(o.unshift(n),n={prototype:{}}),!U(n)){n.debugger&&delete n.debugger,n.document&&(s=n.document,delete n.document);const i=r?s.createElementNS(r,e.toLowerCase()):s.createElement(e);return i.constructor=t,f(i,l),y(i,n),d(i)(o),i}},n=Object.assign(t,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:h,valueOf:()=>`TagCreator: <${r||""}${r?"::":""}${e}>`});return Object.defineProperty(t,"name",{value:"<"+e+">"}),p[e]=n})),p},{"ai-ui-container":J}=G("",["ai-ui-container"]),K=J.extended({styles:'\n  ai-ui-container.promise {\n    display: none;\n    color: #888;\n    font-size: 0.75em;\n  }\n  ai-ui-container.promise:after {\n    content: "⋯";\n  }',prototype:{className:"promise"},constructed:()=>J({style:{display:"none"}},void 0)}),Q=J.extended({styles:"\n  ai-ui-container.error {\n    display: block;\n    color: #b33;\n  }",prototype:{className:"error"}});let V=function(){V=function(){},new MutationObserver((function(e){e.forEach((function(e){"childList"===e.type&&e.removedNodes.forEach((e=>e&&e instanceof Element&&[...e.getElementsByTagName("*"),e].filter((e=>!e.ownerDocument.contains(e))).forEach((e=>{"onRemovedFromDOM"in e&&"function"==typeof e.onRemovedFromDOM&&e.onRemovedFromDOM()}))))}))})).observe(document.body,{subtree:!0,childList:!0})};function X(e,t){return e=e||document,t=t||{},e.querySelectorAll&&e.querySelectorAll("[id]").forEach((function(e){e.id&&(t[e.id]||(t[e.id]=e))})),t}AIUI=t})();