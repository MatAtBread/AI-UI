"use strict";var AIUI=(()=>{var he=Object.defineProperty;var Fe=Object.getOwnPropertyDescriptor;var $e=Object.getOwnPropertyNames;var Ve=Object.prototype.hasOwnProperty;var ke=(e,t)=>{for(var n in t)he(e,n,{get:t[n],enumerable:!0})},Ge=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of $e(t))!Ve.call(e,o)&&o!==n&&he(e,o,{get:()=>t[o],enumerable:!(i=Fe(t,o))||i.enumerable});return e};var Qe=e=>Ge(he({},"__esModule",{value:!0}),e);var ft={};ke(ft,{Iterators:()=>Pe,UniqueID:()=>fe,tag:()=>Le,when:()=>me});var S=globalThis.DEBUG=="*"||globalThis.DEBUG==!0||!!globalThis.DEBUG?.match(/(^|\W)AI-UI(\W|$)/)||!1;var Y=5e3,v={log(...e){S&&console.log("(AI-UI) LOG:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},warn(...e){S&&console.warn("(AI-UI) WARN:",...e,new Error().stack?.replace(/Error\n\s*.*\n/,`
`))},info(...e){S&&console.info("(AI-UI) INFO:",...e)}};var Re=e=>{};function Te(){let e=Re,t=Re,n=new Promise((...i)=>[e,t]=i);if(n.resolve=e,n.reject=t,S){let i=new Error().stack;n.catch(o=>o instanceof Error||o?.value instanceof Error?v.log("Deferred rejection",o,"allocated at ",i):void 0)}return n}function ce(e){return e&&typeof e=="object"||typeof e=="function"}function X(e){return ce(e)&&"then"in e&&typeof e.then=="function"}var Pe={};ke(Pe,{Ignore:()=>R,Iterability:()=>oe,asyncExtras:()=>de,asyncIterator:()=>ve,augmentGlobalAsyncGenerators:()=>rt,combine:()=>je,debounceQueueIteratableIterator:()=>Ne,defineIterableProperty:()=>xe,filterMap:()=>_,generatorHelpers:()=>_e,isAsyncIter:()=>G,isAsyncIterable:()=>ue,isAsyncIterator:()=>ie,iterableHelpers:()=>Q,merge:()=>ye,queueIteratableIterator:()=>Ee});var oe=Symbol("Iterability");function ie(e){return ce(e)&&"next"in e&&typeof e?.next=="function"}function ue(e){return ce(e)&&Symbol.asyncIterator in e&&typeof e[Symbol.asyncIterator]=="function"}function G(e){return ue(e)||ie(e)}function ve(e){if(ie(e))return e;if(ue(e))return e[Symbol.asyncIterator]();throw new Error("Not an async provider")}var de={filterMap(e,t=R){return _(this,e,t)},map:Ze,filter:Je,unique:ze,waitFor:tt,multi:nt,initially:et,consume:Be,merge(...e){return ye(this,...e)},combine(e){return je(Object.assign({_this:this},e))}},Ie=[...Object.getOwnPropertySymbols(de),...Object.keys(de)];function be(e,t){let n=[...Object.getOwnPropertyNames(t),...Object.getOwnPropertySymbols(t)];for(let i of n)Object.defineProperty(e,i,{...Object.getOwnPropertyDescriptor(t,i),enumerable:!1});return e}var B=Symbol("pending"),V=Symbol("items");function Me(e=()=>{}){let t={[B]:[],[V]:[],[Symbol.asyncIterator](){return t},next(){if(t[V]?.length)return Promise.resolve(t[V].shift());if(!t[B])return Promise.resolve({done:!0,value:void 0});let n=Te();return n.catch(i=>{}),t[B].unshift(n),n},return(n){let i={done:!0,value:void 0};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().resolve(i);t[V]=t[B]=null}return Promise.resolve(i)},throw(...n){let i={done:!0,value:n[0]};if(t[B]){try{e()}catch{}for(;t[B].length;)t[B].pop().reject(i);t[V]=t[B]=null}return Promise.reject(i)},get length(){return t[V]?t[V].length:-1},push(n){return t[B]?(t[B].length?t[B].pop().resolve({done:!1,value:n}):t[V]?t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers"),!0):!1}};return Q(t)}var pe=Symbol("inflight");function qe(e=()=>{}){let t=Me(e);return t[pe]=new Set,t.push=function(n){if(!t[B])return!1;if(t[pe].has(n))return!0;if(t[B].length){t[pe].add(n);let i=t[B].pop();i.finally(()=>t[pe].delete(n)),i.resolve({done:!1,value:n})}else t[V]?t[V].find(i=>i.value===n)||t[V].push({done:!1,value:n}):v.log("Discarding queue push as there are no consumers");return!0},t}var Ee=Me,Ne=qe,re=Symbol("_proxiedAsyncIterator");function xe(e,t,n){let i=()=>{i=()=>H;let g=Ne(),x=g.multi(),H=x[Symbol.asyncIterator]();return b[Symbol.asyncIterator]=x[Symbol.asyncIterator],u=g.push,Ie.forEach(w=>b[w]=H[w]),re in r||be(r,b),H};function o(g){return{[g]:function(...x){return i(),r[g].apply(this,x)}}[g]}let b={[Symbol.asyncIterator]:i};Ie.forEach(g=>b[g]=o(g)),typeof n=="object"&&n&&oe in n&&n[oe]==="shallow"&&(b[oe]=n[oe]);let u=g=>(i(),u(g)),r=c(n,b),s;return Object.defineProperty(e,t,{get(){return r},set(g){if(g!==r)if(ue(g)){if(s===g)return;s=g;let x=S?new Error:void 0;S&&v.info(new Error(`Iterable "${t.toString()}" has been assigned to consume another iterator. Did you mean to declare it?`)),Be.call(g,H=>{if(g!==s)throw new Error(`Piped iterable "${t.toString()}" has been replaced by another iterator`,{cause:x});u(H?.valueOf())}).catch(H=>v.info(H)).finally(()=>g===s&&(s=void 0));return}else s&&S&&v.log(`Iterable "${t.toString()}" is already piped from another iterator, and might be overrwitten later`),r=c(g,b);u(g?.valueOf())},enumerable:!0}),e;function c(g,x){if(g==null)return be(Object.create(null,{valueOf:{value(){return g},writable:!0,configurable:!0},toJSON:{value(){return g},writable:!0,configurable:!0}}),x);switch(typeof g){case"bigint":case"boolean":case"number":case"string":return be(Object(g),Object.assign(x,{toJSON(){return g.valueOf()}}));case"object":return q(g,x)}throw new TypeError('Iterable properties cannot be of type "'+typeof g+'"')}function C(g){return ce(g)&&re in g}function M(g,x){let H=x.split(".").slice(1);for(let w=0;w<H.length&&(g=g?.[H[w]])!==void 0;w++);return g}function q(g,x){let H,w;return new Proxy(g,ae());function ae(U=""){return{has(O,E){return E===re||E===Symbol.toPrimitive||E in O||E in x},set(O,E,F,j){if(Object.hasOwn(x,E))throw new Error(`Cannot set ${t.toString()}${U}.${E.toString()} as it is part of asyncIterator`);return Reflect.get(O,E,j)!==F&&u({[re]:{a:g,path:U}}),Reflect.set(O,E,F,j)},deleteProperty(O,E){return Reflect.deleteProperty(O,E)?(u({[re]:{a:g,path:U}}),!0):!1},get(O,E,F){if(Object.hasOwn(x,E))return U.length?(H??(H=_(x,a=>C(a)?a[re]:{a,path:null})),_(H,(a,p)=>{let d=M(a.a,U);return p!==d||a.path===null||a.path.startsWith(U)?d:R},R,M(g,U))[E]):(w??(w=_(x,j=>C(j)?j[re].a:j)),w[E]);if(E==="valueOf")return()=>M(g,U);if(E===Symbol.toPrimitive)return function(j){return Reflect.has(O,E)?Reflect.get(O,E,O).call(O,j):j==="string"?O.toString():j==="number"?Number(O):O.valueOf()};if(typeof E=="string"&&(!(E in O)||Object.hasOwn(O,E))&&!(oe in O&&O[oe]==="shallow")){let j=Reflect.get(O,E,F);return typeof j=="function"||G(j)?j:new Proxy(Object(j),ae(U+"."+E))}return Reflect.get(O,E,F)}}}}}var z=new Promise(()=>{}),ye=(...e)=>{let t=new Array(e.length),n=new Array(e.length),i=()=>{i=()=>{};for(let r=0;r<e.length;r++){let s=e[r];n[r]=(t[r]=Symbol.asyncIterator in s?s[Symbol.asyncIterator]():s).next().then(c=>({idx:r,result:c}))}},o=[],b=n.length,u={[Symbol.asyncIterator](){return u},next(){return i(),b?Promise.race(n).then(({idx:r,result:s})=>s.done?(b--,n[r]=z,o[r]=s.value,u.next()):(n[r]=t[r]?t[r].next().then(c=>({idx:r,result:c})).catch(c=>({idx:r,result:{done:!0,value:c}})):Promise.resolve({idx:r,result:{done:!0,value:void 0}}),s)).catch(r=>u.throw?.(r)??Promise.reject({done:!0,value:new Error("Iterator merge exception")})):Promise.resolve({done:!0,value:o})},async return(r){for(let s=0;s<t.length;s++)n[s]!==z&&(n[s]=z,o[s]=await t[s]?.return?.({done:!0,value:r}).then(c=>c.value,c=>c));return{done:!0,value:o}},async throw(r){for(let s=0;s<t.length;s++)n[s]!==z&&(n[s]=z,o[s]=await t[s]?.throw?.(r).then(c=>c.value,c=>c));return{done:!0,value:o}}};return Q(u)},je=(e,t={})=>{let n={},i,o=[],b=0,u={[Symbol.asyncIterator](){return u},next(){return i===void 0&&(i=Object.entries(e).map(([r,s],c)=>(b+=1,o[c]=s[Symbol.asyncIterator](),o[c].next().then(C=>({si:o,idx:c,k:r,ir:C}))))),function r(){return Promise.race(i).then(({idx:s,k:c,ir:C})=>C.done?(i[s]=z,b-=1,b?r():{done:!0,value:void 0}):(n[c]=C.value,i[s]=o[s].next().then(M=>({idx:s,k:c,ir:M})),t.ignorePartial&&Object.keys(n).length<Object.keys(e).length?r():{done:!1,value:n}))}()},return(r){return i.forEach((s,c)=>{s!==z&&o[c].return?.(r)}),Promise.resolve({done:!0,value:r})},throw(r){return i.forEach((s,c)=>{s!==z&&o[c].throw?.(r)}),Promise.reject({done:!0,value:r})}};return Q(u)};function Xe(e){return ue(e)&&Ie.every(t=>t in e&&e[t]===de[t])}function Q(e){return Xe(e)||be(e,de),e}function _e(e){return function(...t){let n=e(...t);return Q(n)}}async function Be(e){let t;for await(let n of this)t=e?.(n);await t}var R=Symbol("Ignore");function Ye(e,t,n){if(X(e))return e.then(t,n);try{return t(e)}catch(i){return n(i)}}function _(e,t,n=R,i=R){let o;function b(r){return o=u=null,i=R,{done:!0,value:r?.value}}let u={[Symbol.asyncIterator](){return u},next(...r){if(n!==R){let s=Promise.resolve({done:!1,value:n});return n=R,s}return new Promise(function s(c,C){o||(o=e[Symbol.asyncIterator]()),o.next(...r).then(M=>M.done?(i=R,c(M)):Ye(t(M.value,i),q=>q===R?s(c,C):c({done:!1,value:i=q}),q=>{i=R,o.throw?o.throw(q):o.return?.(q),C({done:!0,value:q})}),M=>{i=R,C({done:!0,value:M})}).catch(M=>{i=R,o.throw?o.throw(M):o.return?.(M),C({done:!0,value:M})})})},throw(r){return Promise.resolve(o?.throw?o.throw(r):o?.return?.(r)).then(b)},return(r){return Promise.resolve(o?.return?.(r)).then(b)}};return Q(u)}function Ze(e){return _(this,e)}function Je(e){return _(this,async t=>await e(t)?t:R)}function ze(e){return e?_(this,async(t,n)=>n===R||await e(t,n)?t:R):_(this,(t,n)=>t===n?R:t)}function et(e){return _(this,t=>t,e)}function tt(e){return _(this,t=>new Promise(n=>(e(()=>n(t)),t)))}function nt(){let e=this,t=0,n,i;function o(r){r&&n.resolve(r),r?.done?n=null:(n=Te(),i.next().then(o).catch(s=>{n.reject({done:!0,value:s}),n=null}))}function b(r){return i=u=n=null,{done:!0,value:r?.value}}let u={[Symbol.asyncIterator](){return t+=1,u},next(){return i||(i=e[Symbol.asyncIterator](),o()),n},throw(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(i?.throw?i.throw(r):i?.return?.(r)).then(b)},return(r){if(t<1)throw new Error("AsyncIterator protocol error");return t-=1,t?Promise.resolve({done:!0,value:r}):Promise.resolve(i?.return?.(r)).then(b)}};return Q(u)}function rt(){let e=async function*(){}();for(;e;){if(Object.getOwnPropertyDescriptor(e,Symbol.asyncIterator)){Q(e);break}e=Object.getPrototypeOf(e)}e||v.warn("Failed to augment the prototype of `(async function*())()`")}var ee=new WeakMap;function ot(e){setTimeout(()=>st.call(this,e),1)}function st(e){ee.has(this)||ee.set(this,new Map);let t=ee.get(this).get(e.type);if(t)for(let n of t)try{let{push:i,terminate:o,containerRef:b,selector:u,includeChildren:r}=n,s=b.deref();if(!s||!s.isConnected){let c="Container `#"+s?.id+">"+(u||"")+"` removed from DOM. Removing subscription";t.delete(n),o(new Error(c))}else if(e.target instanceof Node)if(u){let c=s.querySelectorAll(u);for(let C of c)(r?C.contains(e.target):e.target===C)&&s.contains(C)&&i(e)}else(r?s.contains(e.target):e.target===s)&&i(e)}catch(i){v.warn("docEventHandler",i)}}function Ae(e){return!!(e&&(e.startsWith("#")||e.startsWith(".")||e.startsWith("[")&&e.endsWith("]")))}function He(e){let t=!e||!e.endsWith(">");return{includeChildren:t,selector:t?e:e.slice(0,-1)}}function Se(e){let t=e.split(":");if(t.length===1)return Ae(t[0])?[He(t[0]),"change"]:[{includeChildren:!0,selector:null},t[0]];if(t.length===2&&Ae(t[1])&&!Ae(t[0]))return[He(t[1]),t[0]]}function at(e){throw new Error(e)}function Ce(e,t){let[{includeChildren:n,selector:i},o]=Se(t)??at("Invalid WhenSelector: "+t);ee.has(e.ownerDocument)||ee.set(e.ownerDocument,new Map),ee.get(e.ownerDocument).has(o)||(e.ownerDocument.addEventListener(o,ot,{passive:!0,capture:!0}),ee.get(e.ownerDocument).set(o,new Set));let b=ee.get(e.ownerDocument).get(o),u=Ee(()=>b.delete(r)),r={push:u.push,terminate(s){u.return?.(s)},containerRef:new WeakRef(e),includeChildren:n,selector:i};return Ke(e,i?[i]:void 0).then(s=>b.add(r)),u.multi()}async function*it(){return void 0}function Oe(e){function t(n){return e.map(n)}return Object.assign(Q(t),{[Symbol.asyncIterator]:()=>e[Symbol.asyncIterator]()})}function lt(e){if(!e)throw new Error(`Falsy async source will never be ready

`+JSON.stringify(e));return typeof e=="string"&&e[0]!=="@"&&!!Se(e)}async function*ct(e){yield e}function me(e,...t){if(!t||t.length===0)return Oe(Ce(e,"change"));let n=t.filter(o=>typeof o!="string"||o[0]!=="@").map(o=>typeof o=="string"?Ce(e,o):o instanceof Element?Ce(o,"change"):X(o)?ct(o):o);if(t.includes("@start")){let o={[Symbol.asyncIterator]:()=>o,next(){return o.next=()=>Promise.resolve({done:!0,value:void 0}),Promise.resolve({done:!1,value:{}})}};n.push(o)}if(t.includes("@ready")){let o=t.filter(lt).map(c=>Se(c)?.[0]),b=c=>typeof c=="string"&&!e.querySelector(c),u=o.map(c=>c?.selector).filter(b),r,s={[Symbol.asyncIterator](){return s},throw(c){return r?.throw?r.throw(c):Promise.resolve({done:!0,value:c})},return(c){return r?.return?r.return(c):Promise.resolve({done:!0,value:c})},next(){return r?r.next():Ke(e,u).then(()=>(r=(n.length>1?ye(...n):n.length===1?n[0]:void 0)?.[Symbol.asyncIterator](),r?{done:!1,value:{}}:{done:!0,value:void 0}))}};return Oe(Q(s))}let i=n.length>1?ye(...n):n.length===1?n[0]:it();return Oe(Q(i))}function Ke(e,t){function n(){if(e.isConnected)return Promise.resolve();let o=new Promise((b,u)=>new MutationObserver((r,s)=>{r.some(c=>c.addedNodes?.length)&&e.isConnected&&(s.disconnect(),b()),r.some(c=>[...c.removedNodes].some(C=>C===e||C.contains(e)))&&(s.disconnect(),u(new Error("Removed from DOM")))}).observe(e.ownerDocument.body,{subtree:!0,childList:!0}));if(S){let b=new Error().stack?.replace(/^Error/,`Element not mounted after ${Y/1e3} seconds:`),u=setTimeout(()=>{v.warn(b+`
`+e.outerHTML)},Y);o.finally(()=>clearTimeout(u))}return o}function i(o){if(o=o.filter(u=>!e.querySelector(u)),!o.length)return Promise.resolve();let b=new Promise(u=>new MutationObserver((r,s)=>{r.some(c=>c.addedNodes?.length)&&o.every(c=>e.querySelector(c))&&(s.disconnect(),u())}).observe(e,{subtree:!0,childList:!0}));if(S){let u=new Error().stack?.replace(/^Error/,`Missing selectors after ${Y/1e3} seconds: `)??"??",r=setTimeout(()=>{v.warn(u+o+`
`)},Y);b.finally(()=>clearTimeout(r))}return b}return t?.length?n().then(()=>i(t)):n()}var le=Symbol("callStack");var fe=Symbol("Unique ID"),Z=S?e=>e instanceof Node?"outerHTML"in e?e.outerHTML:`${e.textContent} ${e.nodeName}`:String(e):e=>{},dt=0,ut=["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","label","legend","li","link","main","map","mark","menu","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","script","search","section","select","slot","small","source","span","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr"];function se(){throw new Error("<elt>.ids is a read-only map of Elements")}var We=[...Object.keys(Object.getOwnPropertyDescriptors(Function.prototype))].reduce((e,t)=>(e[t]=Symbol(t),e),{});function Ue(e){return e in We?We[e]:e}function ge(e){return typeof e=="string"||typeof e=="number"||typeof e=="boolean"||e instanceof Node||e instanceof NodeList||e instanceof HTMLCollection||e===null||e===void 0||Array.isArray(e)||X(e)||G(e)||typeof e=="object"&&Symbol.iterator in e&&typeof e[Symbol.iterator]=="function"}var Le=function(e,t,n){let[i,o,b]=typeof e=="string"||e===null?[e,t,n]:Array.isArray(e)?[null,e,t]:[null,ut,e],u=b?.commonProperties,r=b?.document??globalThis.document,s=yt(r,b?.enableOnRemovedFromDOM);function c(a){return r.createComment(a?a.toString():S&&new Error("promise").stack?.replace(/^Error: /,"")||"promise")}function C({error:a}){return r.createComment(a instanceof Error?a.toString():`Error:
`+JSON.stringify(a,null,2))}let M=r.createElement("STYLE");M.id="--ai-ui-extended-tag-styles-"+Date.now(),r.head.appendChild(M);let q=new Set,g=Object.create(null,{when:{writable:!1,configurable:!0,enumerable:!1,value:function(...a){return me(this,...a)}},attributes:{...Object.getOwnPropertyDescriptor(Element.prototype,"attributes"),set(a){if(G(a)){let p=ie(a)?a:a[Symbol.asyncIterator](),d=()=>p.next().then(({done:l,value:h})=>{U(this,h),l||d()},l=>v.warn(l));d()}else U(this,a)}},ids:{configurable:!0,enumerable:!0,set:se,get(){let a=new Proxy(()=>{},{apply(p,d,l){try{return d.constructor.definition.ids[l[0].id](...l)}catch(h){throw new Error(`<elt>.ids.${l?.[0]?.id} is not a tag-creating function`,{cause:h})}},construct:se,defineProperty:se,deleteProperty:se,set:se,setPrototypeOf:se,getPrototypeOf(){return null},isExtensible(){return!1},preventExtensions(){return!0},getOwnPropertyDescriptor(p,d){if(this.get(p,d,null))return Reflect.getOwnPropertyDescriptor(p,Ue(d))},has(p,d){return!!this.get(p,d,null)},ownKeys:p=>{let d=[...this.querySelectorAll("[id]")].map(h=>h.id),l=[...new Set(d)];return S&&d.length!==l.length&&v.log("Element contains multiple, shadowed decendant ids",l),l},get:(p,d,l)=>{if(typeof d=="string"){let h=Ue(d);if(h in p){let A=p[h].deref();if(A&&A.id===d&&this.contains(A))return A;delete p[h]}let f;if(S){let A=this.querySelectorAll("#"+CSS.escape(d));A.length>1&&(q.has(d)||(q.add(d),v.log(`Element contains multiple, shadowed decendants with ID "${d}"`))),f=A[0]}else f=this.querySelector("#"+CSS.escape(d))??void 0;return f&&Reflect.set(p,h,new WeakRef(f),p),f}}});return Object.defineProperty(this,"ids",{configurable:!0,enumerable:!0,set:se,get(){return a}}),a}}});u&&w(g,u);function*x(...a){function p(d){return d==null||d===R}for(let d of a)if(!p(d)){if(X(d)){let l=c();d.then(h=>{l.replaceWith(...x(h)),l=void 0}),yield l;continue}if(d instanceof Node){yield d;continue}if(d&&typeof d=="object"&&Symbol.iterator in d&&!(Symbol.asyncIterator in d)&&d[Symbol.iterator]){for(let l of d)yield*x(l);continue}if(G(d)){let l=S?`
`+new Error().stack?.replace(/^Error: /,"Insertion :"):"",h=ie(d)?d:d[Symbol.asyncIterator](),f=!0,A=(T=!1)=>{if(!h||!y.nodes)return!0;if(T||y.nodes.every(I=>s.has(I))){y.nodes?.forEach(D=>s.add(D));let I="Element(s) have been removed from the document: "+y.nodes.map(Z).join(`
`)+l;return y.nodes=null,h.return?.(new Error(I)),h=null,!0}return!1},te=d.valueOf(),y={nodes:te===d?[]:[...x(te)],[Symbol.iterator](){return this.nodes?.[Symbol.iterator]()??{next(){return{done:!0,value:void 0}}}}};y.nodes.length||(y.nodes=[c()]),s.onRemoval(y.nodes,"nodes",A);let m=S?(()=>{let T=Date.now()+Y,I=new Error("Created by").stack,D=()=>{f&&T&&T<Date.now()&&(D=()=>{},v.warn(`Async element not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.`,I,y.nodes?.map(Z)))};return D})():null;(function T(){h.next().then(I=>{if(!I.done){if(!y.nodes){h?.throw?.(new Error("Already ternimated"));return}let D=y.nodes.filter(P=>P.isConnected),k=f?y.nodes:D;if(f&&D.length&&(f=!1),!A(!k.length)){m?.(),s.onRemoval(y.nodes,"nodes"),y.nodes=[...x(ae(I.value))],y.nodes.length||(y.nodes=[c()]),s.onRemoval(y.nodes,"nodes",A);for(let P=0;P<k.length;P++)P===0?k[0].replaceWith(...y.nodes):y.nodes.includes(k[P])||k[P].remove(),s.add(k[P]);T()}}}).catch(I=>{let D=y.nodes?.filter(k=>!!k?.parentNode);y.nodes?.forEach(k=>s.add(k)),D?.length?(D[0].replaceWith(C({error:I})),D.slice(1).forEach(k=>k?.remove())):v.warn("Can't report error",I,y.nodes?.map(Z)),y.nodes&&s.onRemoval(y.nodes,"nodes"),y.nodes=null,h.return?.(I),h=null})})(),y.nodes&&(yield*y);continue}yield r.createTextNode(d.toString())}}i||Object.assign(Le,{nodes:x,UniqueID:fe});let H=Object.getPrototypeOf({});function w(a,p,d){if(!(p==null||typeof p!="object"||p===a))for(let[l,h]of Object.entries(Object.getOwnPropertyDescriptors(p)))try{if("value"in h){let f=h.value;f&&G(f)?Object.defineProperty(a,l,h):f&&typeof f=="object"&&!X(f)?l in a?f instanceof Node?(v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${l}' value: ${Z(f)} destination: ${a instanceof Node?Z(a):a}`),a[l]=f):a[l]!==f&&(Array.isArray(a[l])&&a[l].length!==f.length?f.constructor===Object||f.constructor===Array?w(a[l]=new f.constructor,f):a[l]=f:w(a[l],f)):(d&&(Object.getPrototypeOf(f)===H||!Object.getPrototypeOf(f)?w(h.value={},f):Array.isArray(f)?w(h.value=[],f):v.warn(`Declared propety '${l}' is not a plain object and must be assigned by reference, possibly polluting other instances of this tag`,a,f)),Object.defineProperty(a,l,h)):p[l]!==void 0&&(a[l]=p[l])}else Object.defineProperty(a,l,h)}catch(f){throw v.warn("deepAssign",l,p[l],f),f}}function ae(a){let p=a?.valueOf();return Array.isArray(p)?Array.prototype.map.call(p,ae):p}function U(a,p){le in p||function d(l,h){if(h==null||typeof h!="object")return;let f=Object.entries(Object.getOwnPropertyDescriptors(h));Array.isArray(h)||f.sort(y=>{let m=Object.getOwnPropertyDescriptor(l,y[0]);if(m){if("value"in m)return-1;if("set"in m||"get"in m)return 1}return 0});for(let[y,m]of f)try{if("value"in m){let T=m.value;G(T)?A(T,y):X(T)?T.then(I=>{I&&typeof I=="object"?G(I)?A(I,y):te(I,y):h[y]!==void 0&&(l[y]=I)},I=>v.log("Failed to set attribute",I)):G(T)||(T&&typeof T=="object"&&!X(T)?te(T,y):h[y]!==void 0&&(l[y]=h[y]))}else Object.defineProperty(l,y,m)}catch(T){throw v.warn("assignProps",y,h[y],T),T}function A(y,m){let T=ve(y),I=!0,D=Date.now()+Y,k=S&&new Error("Created by").stack,P=J=>{if(!J.done){let N=ae(J.value);if(typeof N=="object"&&N!==null){let K=Object.getOwnPropertyDescriptor(l,m);m==="style"||!K?.set?d(l[m],N):l[m]=N}else N!==void 0&&(l[m]=N);let $=a.isConnected;if(s.has(a)||!I&&!$){v.info(`Element does not exist in document when setting async attribute '${m}' to:
${Z(a)}`),T.return?.();return}$&&(I=!1),I&&D&&D<Date.now()&&(D=Number.MAX_SAFE_INTEGER,v.warn(`Element with async attribute '${m}' not mounted after ${Y/1e3} seconds. If it is never mounted, it will leak.
Element contains: ${Z(a)}
${k}`)),T.next().then(P).catch(L)}},L=J=>{T.return?.(J),J&&(v.warn("Dynamic attribute terminartion",J,m,l,k,Z(a)),a.appendChild(C({error:J})))},ne=y.valueOf();ne!==void 0&&ne!==y&&!G(ne)?P({done:!1,value:ne}):T.next().then(P).catch(L),s.onRemoval([a],"assignIterable",L)}function te(y,m){if(y instanceof Node)v.info(`Having DOM Nodes as properties of other DOM Nodes is a bad idea as it makes the DOM tree into a cyclic graph. You should reference nodes by ID or via a collection such as .childNodes. Propety: '${m}' value: ${Z(y)} destination: ${a instanceof Node?Z(a):a}`),l[m]=y;else if(!(m in l)||l[m]===y||Array.isArray(l[m])&&l[m].length!==y.length)if(y.constructor===Object||y.constructor===Array){let T=new y.constructor;d(T,y),l[m]=T}else l[m]=y;else Object.getOwnPropertyDescriptor(l,m)?.set?l[m]=y:d(l[m],y)}}(a,p)}function O(a){for(let p=a.constructor;p;p=p.super)if(p===this)return!0;return!1}function E(a){let p=typeof a!="function"?m=>Object.assign({},a,m):a,d=Date.now().toString(36)+(dt++).toString(36)+Math.random().toString(36).slice(2),l=p({[fe]:d});l.styles&&M.appendChild(r.createTextNode(l.styles+`
`));let f=Object.assign((m,...T)=>{let I=ge(m),D=[],k={[le]:(I?D:m[le])??D},P=I?this(k,m,...T):this(k,...T);P.constructor=f;let L=p({[fe]:d});if(k[le].push(L),S){let N=function($,K){for(let W=$;W;W=W.super)if(W.definition?.declare&&K in W.definition.declare)return!0;return!1};var J=N;if(L.declare){let $=Object.keys(L.declare).filter(K=>K in P||N(this,K));$.length&&v.log(`Declared keys '${$}' in ${f.name} already exist in base '${this.valueOf()}'`)}if(L.override){let $=Object.keys(L.override).filter(K=>!(K in P)&&!(u&&K in u)&&!N(this,K));$.length&&v.log(`Overridden keys '${$}' in ${f.name} do not exist in base '${this.valueOf()}'`)}}w(P,L.declare,!0),w(P,L.override);let ne=new Set;if(L.iterable&&Object.keys(L.iterable).forEach(N=>{N in P?(v.log(`Ignoring attempt to re-define iterable property "${N}" as it could already have consumers`),ne.add(N)):xe(P,N,L.iterable[N])}),k[le]===D){I||U(P,m);for(let K of D){let W=K?.constructed?.call(P);ge(W)&&P.append(...x(W))}let N={},$=!1;for(let K of D)if(K.iterable)for(let W of Object.keys(K.iterable)){let we=!I&&W in m;if(ne.has(W)&&we||!(we&&(!X(m[W])||!G(m[W])))){let De=P[W]?.valueOf();De!==void 0&&(N[W]=De,$=!0)}}$&&Object.assign(P,N)}return P},{super:this,definition:Object.assign(l,{[fe]:d}),extended:E,valueOf:()=>{let m=[...Object.keys(l.declare||{}),...Object.keys(l.iterable||{})];return`${f.name}: {${m.join(", ")}}
 \u21AA ${this.valueOf()}`}});Object.defineProperty(f,Symbol.hasInstance,{value:O,writable:!0,configurable:!0});let A={};(function m(T){T?.super&&m(T.super);let I=T.definition;I&&(w(A,I?.override),w(A,I?.declare))})(this),w(A,l.override),w(A,l.declare),Object.defineProperties(f,Object.getOwnPropertyDescriptors(A));let te=A&&"className"in A&&typeof A.className=="string"?A.className:d,y=S?new Error().stack?.split(`
`)[2]??"":"";if(Object.defineProperty(f,"name",{value:"<ai-"+te.replace(/\s+/g,"-")+y+">"}),S){let m=Object.keys(l).filter(T=>!["styles","ids","constructed","declare","override","iterable"].includes(T));m.length&&v.log(`${f.name} defines extraneous keys '${m}', which are unknown`)}return f}let F={createElement(a,p,...d){return a===F.createElement?x(...d):typeof a=="function"?a(p,d):typeof a=="string"&&a in F?F[a](p,d):a instanceof Node?a:C({error:new Error("Illegal type in createElement:"+a)})}};function j(a){if(F[a])return F[a];let p=(l,...h)=>{if(ge(l)&&(h.unshift(l),l={}),!ge(l)){if(l.debugger){debugger;delete l.debugger}let f=i?r.createElementNS(i,a.toLowerCase()):r.createElement(a);return f.constructor=p,w(f,g),U(f,l),f.append(...x(...h)),f}},d=Object.assign(p,{super:()=>{throw new Error("Can't invoke native elemenet constructors directly. Use document.createElement().")},extended:E,valueOf(){return`TagCreator: <${i||""}${i?"::":""}${a}>`}});return Object.defineProperty(p,Symbol.hasInstance,{value:O,writable:!0,configurable:!0}),Object.defineProperty(p,"name",{value:"<"+a+">"}),F[a]=d}return o.forEach(j),F};function yt(e,t){let n=new WeakSet,i=new WeakMap;function o(b){for(let u of b)if(!u.isConnected){n.add(u),o(u.childNodes);let r=i.get(u);if(r){i.delete(u);for(let s of r?.values())s()}t&&"onRemovedFromDOM"in u&&typeof u.onRemovedFromDOM=="function"&&u.onRemovedFromDOM()}}return new MutationObserver(b=>{b.forEach(function(u){u.type==="childList"&&u.removedNodes.length&&o(u.removedNodes)})}).observe(e,{subtree:!0,childList:!0}),{has(b){return n.has(b)},add(b){return n.add(b)},onRemoval(b,u,r){r?b.forEach(s=>{let c=i.get(s)??new Map;i.set(s,c),c.set(u,r)}):b.forEach(s=>{let c=i.get(s);c&&(c.delete(u),c.size||i.delete(s))})}}}return Qe(ft);})();
